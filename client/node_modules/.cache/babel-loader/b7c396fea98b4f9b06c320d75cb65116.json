{"ast":null,"code":"/**\r\n * DevExtreme (data/odata/store.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _config = require(\"../../core/config\");\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _utils = require(\"./utils\");\n\nvar _proxy_url_formatter = require(\"../proxy_url_formatter\");\n\nvar _proxy_url_formatter2 = _interopRequireDefault(_proxy_url_formatter);\n\nvar _errors = require(\"../errors\");\n\nvar _query = require(\"../query\");\n\nvar _query2 = _interopRequireDefault(_query);\n\nvar _abstract_store = require(\"../abstract_store\");\n\nvar _abstract_store2 = _interopRequireDefault(_abstract_store);\n\nvar _request_dispatcher = require(\"./request_dispatcher\");\n\nvar _request_dispatcher2 = _interopRequireDefault(_request_dispatcher);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nrequire(\"./query_adapter\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar ANONYMOUS_KEY_NAME = \"5d46402c-7899-4ea9-bd81-8b73c47c7683\";\n\nvar expandKeyType = function (key, keyType) {\n  return _defineProperty({}, key, keyType);\n};\n\nvar mergeFieldTypesWithKeyType = function (fieldTypes, keyType) {\n  var result = {};\n\n  for (var field in fieldTypes) {\n    result[field] = fieldTypes[field];\n  }\n\n  for (var keyName in keyType) {\n    if (keyName in result) {\n      if (result[keyName] !== keyType[keyName]) {\n        _errors.errors.log(\"W4001\", keyName);\n      }\n    } else {\n      result[keyName] = keyType[keyName];\n    }\n  }\n\n  return result;\n};\n\nvar ODataStore = _abstract_store2.default.inherit({\n  ctor: function (options) {\n    this.callBase(options);\n    this._requestDispatcher = new _request_dispatcher2.default(options);\n    var key = this.key();\n    var fieldTypes = options.fieldTypes;\n    var keyType = options.keyType;\n\n    if (keyType) {\n      var keyTypeIsString = \"string\" === typeof keyType;\n\n      if (!key) {\n        key = keyTypeIsString ? ANONYMOUS_KEY_NAME : Object.keys(keyType);\n        this._legacyAnonymousKey = key;\n      }\n\n      if (keyTypeIsString) {\n        keyType = expandKeyType(key, keyType);\n      }\n\n      fieldTypes = mergeFieldTypesWithKeyType(fieldTypes, keyType);\n    }\n\n    this._fieldTypes = fieldTypes || {};\n\n    if (2 === this.version()) {\n      this._updateMethod = \"MERGE\";\n    } else {\n      this._updateMethod = \"PATCH\";\n    }\n  },\n  _customLoadOptions: function () {\n    return [\"expand\", \"customQueryParams\"];\n  },\n  _byKeyImpl: function (key, extraOptions) {\n    var params = {};\n\n    if (extraOptions) {\n      params.$expand = (0, _utils.generateExpand)(this.version(), extraOptions.expand, extraOptions.select) || void 0;\n      params.$select = (0, _utils.generateSelect)(this.version(), extraOptions.select) || void 0;\n    }\n\n    return this._requestDispatcher.sendRequest(this._byKeyUrl(key), \"GET\", params);\n  },\n  createQuery: function (loadOptions) {\n    var _loadOptions$urlOverr;\n\n    var url;\n    var queryOptions = {\n      adapter: \"odata\",\n      beforeSend: this._requestDispatcher.beforeSend,\n      errorHandler: this._errorHandler,\n      jsonp: this._requestDispatcher.jsonp,\n      version: this._requestDispatcher.version,\n      withCredentials: this._requestDispatcher._withCredentials,\n      expand: null === loadOptions || void 0 === loadOptions ? void 0 : loadOptions.expand,\n      requireTotalCount: null === loadOptions || void 0 === loadOptions ? void 0 : loadOptions.requireTotalCount,\n      deserializeDates: this._requestDispatcher._deserializeDates,\n      fieldTypes: this._fieldTypes\n    };\n    url = null !== (_loadOptions$urlOverr = null === loadOptions || void 0 === loadOptions ? void 0 : loadOptions.urlOverride) && void 0 !== _loadOptions$urlOverr ? _loadOptions$urlOverr : this._requestDispatcher.url;\n\n    if ((0, _type.isDefined)(this._requestDispatcher.filterToLower)) {\n      queryOptions.filterToLower = this._requestDispatcher.filterToLower;\n    }\n\n    if (null === loadOptions || void 0 === loadOptions ? void 0 : loadOptions.customQueryParams) {\n      var params = (0, _utils.escapeServiceOperationParams)(null === loadOptions || void 0 === loadOptions ? void 0 : loadOptions.customQueryParams, this.version());\n\n      if (4 === this.version()) {\n        url = (0, _utils.formatFunctionInvocationUrl)(url, params);\n      } else {\n        queryOptions.params = params;\n      }\n    }\n\n    return (0, _query2.default)(url, queryOptions);\n  },\n  _insertImpl: function (values) {\n    var _this = this;\n\n    this._requireKey();\n\n    var d = new _deferred.Deferred();\n    (0, _deferred.when)(this._requestDispatcher.sendRequest(this._requestDispatcher.url, \"POST\", null, values)).done(function (serverResponse) {\n      return d.resolve(serverResponse && !(0, _config2.default)().useLegacyStoreResult ? serverResponse : values, _this.keyOf(serverResponse));\n    }).fail(d.reject);\n    return d.promise();\n  },\n  _updateImpl: function (key, values) {\n    var d = new _deferred.Deferred();\n    (0, _deferred.when)(this._requestDispatcher.sendRequest(this._byKeyUrl(key), this._updateMethod, null, values)).done(function (serverResponse) {\n      return (0, _config2.default)().useLegacyStoreResult ? d.resolve(key, values) : d.resolve(serverResponse || values, key);\n    }).fail(d.reject);\n    return d.promise();\n  },\n  _removeImpl: function (key) {\n    var d = new _deferred.Deferred();\n    (0, _deferred.when)(this._requestDispatcher.sendRequest(this._byKeyUrl(key), \"DELETE\")).done(function () {\n      return d.resolve(key);\n    }).fail(d.reject);\n    return d.promise();\n  },\n  _convertKey: function (value) {\n    var result = value;\n    var fieldTypes = this._fieldTypes;\n\n    var key = this.key() || this._legacyAnonymousKey;\n\n    if (Array.isArray(key)) {\n      result = {};\n\n      for (var i = 0; i < key.length; i++) {\n        var keyName = key[i];\n        result[keyName] = (0, _utils.convertPrimitiveValue)(fieldTypes[keyName], value[keyName]);\n      }\n    } else {\n      if (fieldTypes[key]) {\n        result = (0, _utils.convertPrimitiveValue)(fieldTypes[key], value);\n      }\n    }\n\n    return result;\n  },\n  _byKeyUrl: function (value, useOriginalHost) {\n    var baseUrl = useOriginalHost ? _proxy_url_formatter2.default.formatLocalUrl(this._requestDispatcher.url) : this._requestDispatcher.url;\n\n    var convertedKey = this._convertKey(value);\n\n    return \"\".concat(baseUrl, \"(\").concat(encodeURIComponent((0, _utils.serializeKey)(convertedKey, this.version())), \")\");\n  },\n  version: function () {\n    return this._requestDispatcher.version;\n  }\n}, \"odata\");\n\nmodule.exports = ODataStore;\nmodule.exports.default = module.exports;","map":{"version":3,"sources":["/Users/tracyvy/Desktop/calendar/client/node_modules/devextreme/data/odata/store.js"],"names":["_type","require","_config","_config2","_interopRequireDefault","_utils","_proxy_url_formatter","_proxy_url_formatter2","_errors","_query","_query2","_abstract_store","_abstract_store2","_request_dispatcher","_request_dispatcher2","_deferred","obj","__esModule","_defineProperty","key","value","Object","defineProperty","enumerable","configurable","writable","ANONYMOUS_KEY_NAME","expandKeyType","keyType","mergeFieldTypesWithKeyType","fieldTypes","result","field","keyName","errors","log","ODataStore","default","inherit","ctor","options","callBase","_requestDispatcher","keyTypeIsString","keys","_legacyAnonymousKey","_fieldTypes","version","_updateMethod","_customLoadOptions","_byKeyImpl","extraOptions","params","$expand","generateExpand","expand","select","$select","generateSelect","sendRequest","_byKeyUrl","createQuery","loadOptions","_loadOptions$urlOverr","url","queryOptions","adapter","beforeSend","errorHandler","_errorHandler","jsonp","withCredentials","_withCredentials","requireTotalCount","deserializeDates","_deserializeDates","urlOverride","isDefined","filterToLower","customQueryParams","escapeServiceOperationParams","formatFunctionInvocationUrl","_insertImpl","values","_this","_requireKey","d","Deferred","when","done","serverResponse","resolve","useLegacyStoreResult","keyOf","fail","reject","promise","_updateImpl","_removeImpl","_convertKey","Array","isArray","i","length","convertPrimitiveValue","useOriginalHost","baseUrl","formatLocalUrl","convertedKey","concat","encodeURIComponent","serializeKey","module","exports"],"mappings":"AAAA;;;;;;;;AAQA;;AACA,IAAIA,KAAK,GAAGC,OAAO,CAAC,uBAAD,CAAnB;;AACA,IAAIC,OAAO,GAAGD,OAAO,CAAC,mBAAD,CAArB;;AACA,IAAIE,QAAQ,GAAGC,sBAAsB,CAACF,OAAD,CAArC;;AACA,IAAIG,MAAM,GAAGJ,OAAO,CAAC,SAAD,CAApB;;AACA,IAAIK,oBAAoB,GAAGL,OAAO,CAAC,wBAAD,CAAlC;;AACA,IAAIM,qBAAqB,GAAGH,sBAAsB,CAACE,oBAAD,CAAlD;;AACA,IAAIE,OAAO,GAAGP,OAAO,CAAC,WAAD,CAArB;;AACA,IAAIQ,MAAM,GAAGR,OAAO,CAAC,UAAD,CAApB;;AACA,IAAIS,OAAO,GAAGN,sBAAsB,CAACK,MAAD,CAApC;;AACA,IAAIE,eAAe,GAAGV,OAAO,CAAC,mBAAD,CAA7B;;AACA,IAAIW,gBAAgB,GAAGR,sBAAsB,CAACO,eAAD,CAA7C;;AACA,IAAIE,mBAAmB,GAAGZ,OAAO,CAAC,sBAAD,CAAjC;;AACA,IAAIa,oBAAoB,GAAGV,sBAAsB,CAACS,mBAAD,CAAjD;;AACA,IAAIE,SAAS,GAAGd,OAAO,CAAC,2BAAD,CAAvB;;AACAA,OAAO,CAAC,iBAAD,CAAP;;AAEA,SAASG,sBAAT,CAAgCY,GAAhC,EAAqC;AACjC,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AACjC,eAAWA;AADsB,GAArC;AAGH;;AAED,SAASE,eAAT,CAAyBF,GAAzB,EAA8BG,GAA9B,EAAmCC,KAAnC,EAA0C;AACtC,MAAID,GAAG,IAAIH,GAAX,EAAgB;AACZK,IAAAA,MAAM,CAACC,cAAP,CAAsBN,GAAtB,EAA2BG,GAA3B,EAAgC;AAC5BC,MAAAA,KAAK,EAAEA,KADqB;AAE5BG,MAAAA,UAAU,EAAE,IAFgB;AAG5BC,MAAAA,YAAY,EAAE,IAHc;AAI5BC,MAAAA,QAAQ,EAAE;AAJkB,KAAhC;AAMH,GAPD,MAOO;AACHT,IAAAA,GAAG,CAACG,GAAD,CAAH,GAAWC,KAAX;AACH;;AACD,SAAOJ,GAAP;AACH;;AACD,IAAIU,kBAAkB,GAAG,sCAAzB;;AACA,IAAIC,aAAa,GAAG,UAASR,GAAT,EAAcS,OAAd,EAAuB;AACvC,SAAOV,eAAe,CAAC,EAAD,EAAKC,GAAL,EAAUS,OAAV,CAAtB;AACH,CAFD;;AAGA,IAAIC,0BAA0B,GAAG,UAASC,UAAT,EAAqBF,OAArB,EAA8B;AAC3D,MAAIG,MAAM,GAAG,EAAb;;AACA,OAAK,IAAIC,KAAT,IAAkBF,UAAlB,EAA8B;AAC1BC,IAAAA,MAAM,CAACC,KAAD,CAAN,GAAgBF,UAAU,CAACE,KAAD,CAA1B;AACH;;AACD,OAAK,IAAIC,OAAT,IAAoBL,OAApB,EAA6B;AACzB,QAAIK,OAAO,IAAIF,MAAf,EAAuB;AACnB,UAAIA,MAAM,CAACE,OAAD,CAAN,KAAoBL,OAAO,CAACK,OAAD,CAA/B,EAA0C;AACtCzB,QAAAA,OAAO,CAAC0B,MAAR,CAAeC,GAAf,CAAmB,OAAnB,EAA4BF,OAA5B;AACH;AACJ,KAJD,MAIO;AACHF,MAAAA,MAAM,CAACE,OAAD,CAAN,GAAkBL,OAAO,CAACK,OAAD,CAAzB;AACH;AACJ;;AACD,SAAOF,MAAP;AACH,CAfD;;AAgBA,IAAIK,UAAU,GAAGxB,gBAAgB,CAACyB,OAAjB,CAAyBC,OAAzB,CAAiC;AAC9CC,EAAAA,IAAI,EAAE,UAASC,OAAT,EAAkB;AACpB,SAAKC,QAAL,CAAcD,OAAd;AACA,SAAKE,kBAAL,GAA0B,IAAI5B,oBAAoB,CAACuB,OAAzB,CAAiCG,OAAjC,CAA1B;AACA,QAAIrB,GAAG,GAAG,KAAKA,GAAL,EAAV;AACA,QAAIW,UAAU,GAAGU,OAAO,CAACV,UAAzB;AACA,QAAIF,OAAO,GAAGY,OAAO,CAACZ,OAAtB;;AACA,QAAIA,OAAJ,EAAa;AACT,UAAIe,eAAe,GAAG,aAAa,OAAOf,OAA1C;;AACA,UAAI,CAACT,GAAL,EAAU;AACNA,QAAAA,GAAG,GAAGwB,eAAe,GAAGjB,kBAAH,GAAwBL,MAAM,CAACuB,IAAP,CAAYhB,OAAZ,CAA7C;AACA,aAAKiB,mBAAL,GAA2B1B,GAA3B;AACH;;AACD,UAAIwB,eAAJ,EAAqB;AACjBf,QAAAA,OAAO,GAAGD,aAAa,CAACR,GAAD,EAAMS,OAAN,CAAvB;AACH;;AACDE,MAAAA,UAAU,GAAGD,0BAA0B,CAACC,UAAD,EAAaF,OAAb,CAAvC;AACH;;AACD,SAAKkB,WAAL,GAAmBhB,UAAU,IAAI,EAAjC;;AACA,QAAI,MAAM,KAAKiB,OAAL,EAAV,EAA0B;AACtB,WAAKC,aAAL,GAAqB,OAArB;AACH,KAFD,MAEO;AACH,WAAKA,aAAL,GAAqB,OAArB;AACH;AACJ,GAxB6C;AAyB9CC,EAAAA,kBAAkB,EAAE,YAAW;AAC3B,WAAO,CAAC,QAAD,EAAW,mBAAX,CAAP;AACH,GA3B6C;AA4B9CC,EAAAA,UAAU,EAAE,UAAS/B,GAAT,EAAcgC,YAAd,EAA4B;AACpC,QAAIC,MAAM,GAAG,EAAb;;AACA,QAAID,YAAJ,EAAkB;AACdC,MAAAA,MAAM,CAACC,OAAP,GAAiB,CAAC,GAAGhD,MAAM,CAACiD,cAAX,EAA2B,KAAKP,OAAL,EAA3B,EAA2CI,YAAY,CAACI,MAAxD,EAAgEJ,YAAY,CAACK,MAA7E,KAAwF,KAAK,CAA9G;AACAJ,MAAAA,MAAM,CAACK,OAAP,GAAiB,CAAC,GAAGpD,MAAM,CAACqD,cAAX,EAA2B,KAAKX,OAAL,EAA3B,EAA2CI,YAAY,CAACK,MAAxD,KAAmE,KAAK,CAAzF;AACH;;AACD,WAAO,KAAKd,kBAAL,CAAwBiB,WAAxB,CAAoC,KAAKC,SAAL,CAAezC,GAAf,CAApC,EAAyD,KAAzD,EAAgEiC,MAAhE,CAAP;AACH,GAnC6C;AAoC9CS,EAAAA,WAAW,EAAE,UAASC,WAAT,EAAsB;AAC/B,QAAIC,qBAAJ;;AACA,QAAIC,GAAJ;AACA,QAAIC,YAAY,GAAG;AACfC,MAAAA,OAAO,EAAE,OADM;AAEfC,MAAAA,UAAU,EAAE,KAAKzB,kBAAL,CAAwByB,UAFrB;AAGfC,MAAAA,YAAY,EAAE,KAAKC,aAHJ;AAIfC,MAAAA,KAAK,EAAE,KAAK5B,kBAAL,CAAwB4B,KAJhB;AAKfvB,MAAAA,OAAO,EAAE,KAAKL,kBAAL,CAAwBK,OALlB;AAMfwB,MAAAA,eAAe,EAAE,KAAK7B,kBAAL,CAAwB8B,gBAN1B;AAOfjB,MAAAA,MAAM,EAAE,SAASO,WAAT,IAAwB,KAAK,CAAL,KAAWA,WAAnC,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACP,MAP/D;AAQfkB,MAAAA,iBAAiB,EAAE,SAASX,WAAT,IAAwB,KAAK,CAAL,KAAWA,WAAnC,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACW,iBAR1E;AASfC,MAAAA,gBAAgB,EAAE,KAAKhC,kBAAL,CAAwBiC,iBAT3B;AAUf7C,MAAAA,UAAU,EAAE,KAAKgB;AAVF,KAAnB;AAYAkB,IAAAA,GAAG,GAAG,UAAUD,qBAAqB,GAAG,SAASD,WAAT,IAAwB,KAAK,CAAL,KAAWA,WAAnC,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACc,WAAxG,KAAwH,KAAK,CAAL,KAAWb,qBAAnI,GAA2JA,qBAA3J,GAAmL,KAAKrB,kBAAL,CAAwBsB,GAAjN;;AACA,QAAI,CAAC,GAAGhE,KAAK,CAAC6E,SAAV,EAAqB,KAAKnC,kBAAL,CAAwBoC,aAA7C,CAAJ,EAAiE;AAC7Db,MAAAA,YAAY,CAACa,aAAb,GAA6B,KAAKpC,kBAAL,CAAwBoC,aAArD;AACH;;AACD,QAAI,SAAShB,WAAT,IAAwB,KAAK,CAAL,KAAWA,WAAnC,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACiB,iBAA1E,EAA6F;AACzF,UAAI3B,MAAM,GAAG,CAAC,GAAG/C,MAAM,CAAC2E,4BAAX,EAAyC,SAASlB,WAAT,IAAwB,KAAK,CAAL,KAAWA,WAAnC,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACiB,iBAA/G,EAAkI,KAAKhC,OAAL,EAAlI,CAAb;;AACA,UAAI,MAAM,KAAKA,OAAL,EAAV,EAA0B;AACtBiB,QAAAA,GAAG,GAAG,CAAC,GAAG3D,MAAM,CAAC4E,2BAAX,EAAwCjB,GAAxC,EAA6CZ,MAA7C,CAAN;AACH,OAFD,MAEO;AACHa,QAAAA,YAAY,CAACb,MAAb,GAAsBA,MAAtB;AACH;AACJ;;AACD,WAAO,CAAC,GAAG1C,OAAO,CAAC2B,OAAZ,EAAqB2B,GAArB,EAA0BC,YAA1B,CAAP;AACH,GAhE6C;AAiE9CiB,EAAAA,WAAW,EAAE,UAASC,MAAT,EAAiB;AAC1B,QAAIC,KAAK,GAAG,IAAZ;;AACA,SAAKC,WAAL;;AACA,QAAIC,CAAC,GAAG,IAAIvE,SAAS,CAACwE,QAAd,EAAR;AACA,KAAC,GAAGxE,SAAS,CAACyE,IAAd,EAAoB,KAAK9C,kBAAL,CAAwBiB,WAAxB,CAAoC,KAAKjB,kBAAL,CAAwBsB,GAA5D,EAAiE,MAAjE,EAAyE,IAAzE,EAA+EmB,MAA/E,CAApB,EAA4GM,IAA5G,CAAiH,UAASC,cAAT,EAAyB;AACtI,aAAOJ,CAAC,CAACK,OAAF,CAAUD,cAAc,IAAI,CAAC,CAAC,GAAGvF,QAAQ,CAACkC,OAAb,IAAwBuD,oBAA3C,GAAkEF,cAAlE,GAAmFP,MAA7F,EAAqGC,KAAK,CAACS,KAAN,CAAYH,cAAZ,CAArG,CAAP;AACH,KAFD,EAEGI,IAFH,CAEQR,CAAC,CAACS,MAFV;AAGA,WAAOT,CAAC,CAACU,OAAF,EAAP;AACH,GAzE6C;AA0E9CC,EAAAA,WAAW,EAAE,UAAS9E,GAAT,EAAcgE,MAAd,EAAsB;AAC/B,QAAIG,CAAC,GAAG,IAAIvE,SAAS,CAACwE,QAAd,EAAR;AACA,KAAC,GAAGxE,SAAS,CAACyE,IAAd,EAAoB,KAAK9C,kBAAL,CAAwBiB,WAAxB,CAAoC,KAAKC,SAAL,CAAezC,GAAf,CAApC,EAAyD,KAAK6B,aAA9D,EAA6E,IAA7E,EAAmFmC,MAAnF,CAApB,EAAgHM,IAAhH,CAAqH,UAASC,cAAT,EAAyB;AAC1I,aAAO,CAAC,GAAGvF,QAAQ,CAACkC,OAAb,IAAwBuD,oBAAxB,GAA+CN,CAAC,CAACK,OAAF,CAAUxE,GAAV,EAAegE,MAAf,CAA/C,GAAwEG,CAAC,CAACK,OAAF,CAAUD,cAAc,IAAIP,MAA5B,EAAoChE,GAApC,CAA/E;AACH,KAFD,EAEG2E,IAFH,CAEQR,CAAC,CAACS,MAFV;AAGA,WAAOT,CAAC,CAACU,OAAF,EAAP;AACH,GAhF6C;AAiF9CE,EAAAA,WAAW,EAAE,UAAS/E,GAAT,EAAc;AACvB,QAAImE,CAAC,GAAG,IAAIvE,SAAS,CAACwE,QAAd,EAAR;AACA,KAAC,GAAGxE,SAAS,CAACyE,IAAd,EAAoB,KAAK9C,kBAAL,CAAwBiB,WAAxB,CAAoC,KAAKC,SAAL,CAAezC,GAAf,CAApC,EAAyD,QAAzD,CAApB,EAAwFsE,IAAxF,CAA6F,YAAW;AACpG,aAAOH,CAAC,CAACK,OAAF,CAAUxE,GAAV,CAAP;AACH,KAFD,EAEG2E,IAFH,CAEQR,CAAC,CAACS,MAFV;AAGA,WAAOT,CAAC,CAACU,OAAF,EAAP;AACH,GAvF6C;AAwF9CG,EAAAA,WAAW,EAAE,UAAS/E,KAAT,EAAgB;AACzB,QAAIW,MAAM,GAAGX,KAAb;AACA,QAAIU,UAAU,GAAG,KAAKgB,WAAtB;;AACA,QAAI3B,GAAG,GAAG,KAAKA,GAAL,MAAc,KAAK0B,mBAA7B;;AACA,QAAIuD,KAAK,CAACC,OAAN,CAAclF,GAAd,CAAJ,EAAwB;AACpBY,MAAAA,MAAM,GAAG,EAAT;;AACA,WAAK,IAAIuE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnF,GAAG,CAACoF,MAAxB,EAAgCD,CAAC,EAAjC,EAAqC;AACjC,YAAIrE,OAAO,GAAGd,GAAG,CAACmF,CAAD,CAAjB;AACAvE,QAAAA,MAAM,CAACE,OAAD,CAAN,GAAkB,CAAC,GAAG5B,MAAM,CAACmG,qBAAX,EAAkC1E,UAAU,CAACG,OAAD,CAA5C,EAAuDb,KAAK,CAACa,OAAD,CAA5D,CAAlB;AACH;AACJ,KAND,MAMO;AACH,UAAIH,UAAU,CAACX,GAAD,CAAd,EAAqB;AACjBY,QAAAA,MAAM,GAAG,CAAC,GAAG1B,MAAM,CAACmG,qBAAX,EAAkC1E,UAAU,CAACX,GAAD,CAA5C,EAAmDC,KAAnD,CAAT;AACH;AACJ;;AACD,WAAOW,MAAP;AACH,GAxG6C;AAyG9C6B,EAAAA,SAAS,EAAE,UAASxC,KAAT,EAAgBqF,eAAhB,EAAiC;AACxC,QAAIC,OAAO,GAAGD,eAAe,GAAGlG,qBAAqB,CAAC8B,OAAtB,CAA8BsE,cAA9B,CAA6C,KAAKjE,kBAAL,CAAwBsB,GAArE,CAAH,GAA+E,KAAKtB,kBAAL,CAAwBsB,GAApI;;AACA,QAAI4C,YAAY,GAAG,KAAKT,WAAL,CAAiB/E,KAAjB,CAAnB;;AACA,WAAO,GAAGyF,MAAH,CAAUH,OAAV,EAAmB,GAAnB,EAAwBG,MAAxB,CAA+BC,kBAAkB,CAAC,CAAC,GAAGzG,MAAM,CAAC0G,YAAX,EAAyBH,YAAzB,EAAuC,KAAK7D,OAAL,EAAvC,CAAD,CAAjD,EAA2G,GAA3G,CAAP;AACH,GA7G6C;AA8G9CA,EAAAA,OAAO,EAAE,YAAW;AAChB,WAAO,KAAKL,kBAAL,CAAwBK,OAA/B;AACH;AAhH6C,CAAjC,EAiHd,OAjHc,CAAjB;;AAkHAiE,MAAM,CAACC,OAAP,GAAiB7E,UAAjB;AACA4E,MAAM,CAACC,OAAP,CAAe5E,OAAf,GAAyB2E,MAAM,CAACC,OAAhC","sourcesContent":["/**\r\n * DevExtreme (data/odata/store.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _config = require(\"../../core/config\");\r\nvar _config2 = _interopRequireDefault(_config);\r\nvar _utils = require(\"./utils\");\r\nvar _proxy_url_formatter = require(\"../proxy_url_formatter\");\r\nvar _proxy_url_formatter2 = _interopRequireDefault(_proxy_url_formatter);\r\nvar _errors = require(\"../errors\");\r\nvar _query = require(\"../query\");\r\nvar _query2 = _interopRequireDefault(_query);\r\nvar _abstract_store = require(\"../abstract_store\");\r\nvar _abstract_store2 = _interopRequireDefault(_abstract_store);\r\nvar _request_dispatcher = require(\"./request_dispatcher\");\r\nvar _request_dispatcher2 = _interopRequireDefault(_request_dispatcher);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nrequire(\"./query_adapter\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _defineProperty(obj, key, value) {\r\n    if (key in obj) {\r\n        Object.defineProperty(obj, key, {\r\n            value: value,\r\n            enumerable: true,\r\n            configurable: true,\r\n            writable: true\r\n        })\r\n    } else {\r\n        obj[key] = value\r\n    }\r\n    return obj\r\n}\r\nvar ANONYMOUS_KEY_NAME = \"5d46402c-7899-4ea9-bd81-8b73c47c7683\";\r\nvar expandKeyType = function(key, keyType) {\r\n    return _defineProperty({}, key, keyType)\r\n};\r\nvar mergeFieldTypesWithKeyType = function(fieldTypes, keyType) {\r\n    var result = {};\r\n    for (var field in fieldTypes) {\r\n        result[field] = fieldTypes[field]\r\n    }\r\n    for (var keyName in keyType) {\r\n        if (keyName in result) {\r\n            if (result[keyName] !== keyType[keyName]) {\r\n                _errors.errors.log(\"W4001\", keyName)\r\n            }\r\n        } else {\r\n            result[keyName] = keyType[keyName]\r\n        }\r\n    }\r\n    return result\r\n};\r\nvar ODataStore = _abstract_store2.default.inherit({\r\n    ctor: function(options) {\r\n        this.callBase(options);\r\n        this._requestDispatcher = new _request_dispatcher2.default(options);\r\n        var key = this.key();\r\n        var fieldTypes = options.fieldTypes;\r\n        var keyType = options.keyType;\r\n        if (keyType) {\r\n            var keyTypeIsString = \"string\" === typeof keyType;\r\n            if (!key) {\r\n                key = keyTypeIsString ? ANONYMOUS_KEY_NAME : Object.keys(keyType);\r\n                this._legacyAnonymousKey = key\r\n            }\r\n            if (keyTypeIsString) {\r\n                keyType = expandKeyType(key, keyType)\r\n            }\r\n            fieldTypes = mergeFieldTypesWithKeyType(fieldTypes, keyType)\r\n        }\r\n        this._fieldTypes = fieldTypes || {};\r\n        if (2 === this.version()) {\r\n            this._updateMethod = \"MERGE\"\r\n        } else {\r\n            this._updateMethod = \"PATCH\"\r\n        }\r\n    },\r\n    _customLoadOptions: function() {\r\n        return [\"expand\", \"customQueryParams\"]\r\n    },\r\n    _byKeyImpl: function(key, extraOptions) {\r\n        var params = {};\r\n        if (extraOptions) {\r\n            params.$expand = (0, _utils.generateExpand)(this.version(), extraOptions.expand, extraOptions.select) || void 0;\r\n            params.$select = (0, _utils.generateSelect)(this.version(), extraOptions.select) || void 0\r\n        }\r\n        return this._requestDispatcher.sendRequest(this._byKeyUrl(key), \"GET\", params)\r\n    },\r\n    createQuery: function(loadOptions) {\r\n        var _loadOptions$urlOverr;\r\n        var url;\r\n        var queryOptions = {\r\n            adapter: \"odata\",\r\n            beforeSend: this._requestDispatcher.beforeSend,\r\n            errorHandler: this._errorHandler,\r\n            jsonp: this._requestDispatcher.jsonp,\r\n            version: this._requestDispatcher.version,\r\n            withCredentials: this._requestDispatcher._withCredentials,\r\n            expand: null === loadOptions || void 0 === loadOptions ? void 0 : loadOptions.expand,\r\n            requireTotalCount: null === loadOptions || void 0 === loadOptions ? void 0 : loadOptions.requireTotalCount,\r\n            deserializeDates: this._requestDispatcher._deserializeDates,\r\n            fieldTypes: this._fieldTypes\r\n        };\r\n        url = null !== (_loadOptions$urlOverr = null === loadOptions || void 0 === loadOptions ? void 0 : loadOptions.urlOverride) && void 0 !== _loadOptions$urlOverr ? _loadOptions$urlOverr : this._requestDispatcher.url;\r\n        if ((0, _type.isDefined)(this._requestDispatcher.filterToLower)) {\r\n            queryOptions.filterToLower = this._requestDispatcher.filterToLower\r\n        }\r\n        if (null === loadOptions || void 0 === loadOptions ? void 0 : loadOptions.customQueryParams) {\r\n            var params = (0, _utils.escapeServiceOperationParams)(null === loadOptions || void 0 === loadOptions ? void 0 : loadOptions.customQueryParams, this.version());\r\n            if (4 === this.version()) {\r\n                url = (0, _utils.formatFunctionInvocationUrl)(url, params)\r\n            } else {\r\n                queryOptions.params = params\r\n            }\r\n        }\r\n        return (0, _query2.default)(url, queryOptions)\r\n    },\r\n    _insertImpl: function(values) {\r\n        var _this = this;\r\n        this._requireKey();\r\n        var d = new _deferred.Deferred;\r\n        (0, _deferred.when)(this._requestDispatcher.sendRequest(this._requestDispatcher.url, \"POST\", null, values)).done(function(serverResponse) {\r\n            return d.resolve(serverResponse && !(0, _config2.default)().useLegacyStoreResult ? serverResponse : values, _this.keyOf(serverResponse))\r\n        }).fail(d.reject);\r\n        return d.promise()\r\n    },\r\n    _updateImpl: function(key, values) {\r\n        var d = new _deferred.Deferred;\r\n        (0, _deferred.when)(this._requestDispatcher.sendRequest(this._byKeyUrl(key), this._updateMethod, null, values)).done(function(serverResponse) {\r\n            return (0, _config2.default)().useLegacyStoreResult ? d.resolve(key, values) : d.resolve(serverResponse || values, key)\r\n        }).fail(d.reject);\r\n        return d.promise()\r\n    },\r\n    _removeImpl: function(key) {\r\n        var d = new _deferred.Deferred;\r\n        (0, _deferred.when)(this._requestDispatcher.sendRequest(this._byKeyUrl(key), \"DELETE\")).done(function() {\r\n            return d.resolve(key)\r\n        }).fail(d.reject);\r\n        return d.promise()\r\n    },\r\n    _convertKey: function(value) {\r\n        var result = value;\r\n        var fieldTypes = this._fieldTypes;\r\n        var key = this.key() || this._legacyAnonymousKey;\r\n        if (Array.isArray(key)) {\r\n            result = {};\r\n            for (var i = 0; i < key.length; i++) {\r\n                var keyName = key[i];\r\n                result[keyName] = (0, _utils.convertPrimitiveValue)(fieldTypes[keyName], value[keyName])\r\n            }\r\n        } else {\r\n            if (fieldTypes[key]) {\r\n                result = (0, _utils.convertPrimitiveValue)(fieldTypes[key], value)\r\n            }\r\n        }\r\n        return result\r\n    },\r\n    _byKeyUrl: function(value, useOriginalHost) {\r\n        var baseUrl = useOriginalHost ? _proxy_url_formatter2.default.formatLocalUrl(this._requestDispatcher.url) : this._requestDispatcher.url;\r\n        var convertedKey = this._convertKey(value);\r\n        return \"\".concat(baseUrl, \"(\").concat(encodeURIComponent((0, _utils.serializeKey)(convertedKey, this.version())), \")\")\r\n    },\r\n    version: function() {\r\n        return this._requestDispatcher.version\r\n    }\r\n}, \"odata\");\r\nmodule.exports = ODataStore;\r\nmodule.exports.default = module.exports;\r\n"]},"metadata":{},"sourceType":"script"}