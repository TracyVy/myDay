{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.editing.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _dom_adapter = require(\"../../core/dom_adapter\");\n\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\n\nvar _window = require(\"../../core/utils/window\");\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _guid = require(\"../../core/guid\");\n\nvar _guid2 = _interopRequireDefault(_guid);\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _type2 = _interopRequireDefault(_type);\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _click = require(\"../../events/click\");\n\nvar _click2 = _interopRequireDefault(_click);\n\nvar _double_click = require(\"../../events/double_click\");\n\nvar _double_click2 = _interopRequireDefault(_double_click);\n\nvar _pointer = require(\"../../events/pointer\");\n\nvar _pointer2 = _interopRequireDefault(_pointer);\n\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\n\nvar _utils = require(\"../../events/utils\");\n\nvar _dialog = require(\"../dialog\");\n\nvar _dialog2 = _interopRequireDefault(_dialog);\n\nvar _message = require(\"../../localization/message\");\n\nvar _message2 = _interopRequireDefault(_message);\n\nvar _button = require(\"../button\");\n\nvar _button2 = _interopRequireDefault(_button);\n\nvar _popup = require(\"../popup\");\n\nvar _popup2 = _interopRequireDefault(_popup);\n\nvar _ui = require(\"../widget/ui.errors\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _devices = require(\"../../core/devices\");\n\nvar _devices2 = _interopRequireDefault(_devices);\n\nvar _form = require(\"../form\");\n\nvar _form2 = _interopRequireDefault(_form);\n\nvar _hold = require(\"../../events/hold\");\n\nvar _hold2 = _interopRequireDefault(_hold);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _deferred2 = _interopRequireDefault(_deferred);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _common2 = _interopRequireDefault(_common);\n\nvar _icon = require(\"../../core/utils/icon\");\n\nvar _icon2 = _interopRequireDefault(_icon);\n\nvar _ui3 = require(\"../scroll_view/ui.scrollable\");\n\nvar _ui4 = _interopRequireDefault(_ui3);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) {\n    return;\n  }\n\n  if (\"string\" === typeof o) {\n    return _arrayLikeToArray(o, minLen);\n  }\n\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n\n  if (\"Object\" === n && o.constructor) {\n    n = o.constructor.name;\n  }\n\n  if (\"Map\" === n || \"Set\" === n) {\n    return Array.from(o);\n  }\n\n  if (\"Arguments\" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) {\n    return _arrayLikeToArray(o, minLen);\n  }\n}\n\nfunction _iterableToArray(iter) {\n  if (\"undefined\" !== typeof Symbol && Symbol.iterator in Object(iter)) {\n    return Array.from(iter);\n  }\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    return _arrayLikeToArray(arr);\n  }\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (null == len || len > arr.length) {\n    len = arr.length;\n  }\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nvar EDIT_FORM_CLASS = \"edit-form\";\nvar EDIT_FORM_ITEM_CLASS = \"edit-form-item\";\nvar FOCUS_OVERLAY_CLASS = \"focus-overlay\";\nvar READONLY_CLASS = \"readonly\";\nvar EDIT_POPUP_CLASS = \"edit-popup\";\nvar FORM_BUTTONS_CONTAINER_CLASS = \"form-buttons-container\";\nvar ADD_ROW_BUTTON_CLASS = \"addrow-button\";\nvar DROPDOWN_EDITOR_OVERLAY_CLASS = \"dx-dropdowneditor-overlay\";\nvar LINK_CLASS = \"dx-link\";\nvar EDITOR_CELL_CLASS = \"dx-editor-cell\";\nvar ROW_SELECTED = \"dx-selection\";\nvar EDIT_ROW = \"dx-edit-row\";\nvar EDIT_BUTTON_CLASS = \"dx-edit-button\";\nvar COMMAND_EDIT_CLASS = \"dx-command-edit\";\nvar COMMAND_EDIT_WITH_ICONS_CLASS = COMMAND_EDIT_CLASS + \"-with-icons\";\nvar SCROLLABLE_CONTAINER_CLASS = \"dx-scrollable-container\";\nvar BUTTON_CLASS = \"dx-button\";\nvar INSERT_INDEX = \"__DX_INSERT_INDEX__\";\nvar ROW_CLASS = \"dx-row\";\nvar ROW_REMOVED = \"dx-row-removed\";\nvar ROW_INSERTED = \"dx-row-inserted\";\nvar ROW_MODIFIED = \"dx-row-modified\";\nvar CELL_MODIFIED = \"dx-cell-modified\";\nvar CELL_HIGHLIGHT_OUTLINE = \"dx-highlight-outline\";\nvar EDITING_NAMESPACE = \"dxDataGridEditing\";\nvar DATA_ROW_CLASS = \"dx-data-row\";\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\nvar EDITORS_INPUT_SELECTOR = \"input:not([type='hidden'])\";\nvar FOCUSABLE_ELEMENT_SELECTOR = \"[tabindex], \" + EDITORS_INPUT_SELECTOR;\nvar EDIT_MODE_BATCH = \"batch\";\nvar EDIT_MODE_ROW = \"row\";\nvar EDIT_MODE_CELL = \"cell\";\nvar EDIT_MODE_FORM = \"form\";\nvar EDIT_MODE_POPUP = \"popup\";\nvar DATA_EDIT_DATA_INSERT_TYPE = \"insert\";\nvar DATA_EDIT_DATA_UPDATE_TYPE = \"update\";\nvar DATA_EDIT_DATA_REMOVE_TYPE = \"remove\";\nvar POINTER_EVENTS_TARGET_CLASS = \"dx-pointer-events-target\";\nvar DEFAULT_START_EDIT_ACTION = \"click\";\nvar EDIT_MODES = [EDIT_MODE_BATCH, EDIT_MODE_ROW, EDIT_MODE_CELL, EDIT_MODE_FORM, EDIT_MODE_POPUP];\nvar ROW_BASED_MODES = [EDIT_MODE_ROW, EDIT_MODE_FORM, EDIT_MODE_POPUP];\nvar CELL_BASED_MODES = [EDIT_MODE_BATCH, EDIT_MODE_CELL];\nvar FORM_BASED_MODES = [EDIT_MODE_FORM, EDIT_MODE_POPUP];\nvar MODES_WITH_DELAYED_FOCUS = [EDIT_MODE_ROW, EDIT_MODE_FORM];\nvar TARGET_COMPONENT_NAME = \"targetComponent\";\nvar EDIT_LINK_CLASS = {\n  save: \"dx-link-save\",\n  cancel: \"dx-link-cancel\",\n  edit: \"dx-link-edit\",\n  undelete: \"dx-link-undelete\",\n  \"delete\": \"dx-link-delete\",\n  add: \"dx-link-add\"\n};\nvar EDIT_ICON_CLASS = {\n  save: \"save\",\n  cancel: \"revert\",\n  edit: \"edit\",\n  undelete: \"revert\",\n  \"delete\": \"trash\",\n  add: \"add\"\n};\nvar METHOD_NAMES = {\n  edit: \"editRow\",\n  \"delete\": \"deleteRow\",\n  undelete: \"undeleteRow\",\n  save: \"saveEditData\",\n  cancel: \"cancelEditData\",\n  add: \"addRowByRowIndex\"\n};\nvar ACTION_OPTION_NAMES = {\n  add: \"allowAdding\",\n  edit: \"allowUpdating\",\n  \"delete\": \"allowDeleting\"\n};\nvar BUTTON_NAMES = [\"edit\", \"save\", \"cancel\", \"delete\", \"undelete\"];\nvar EDITING_POPUP_OPTION_NAME = \"editing.popup\";\n\nvar createFailureHandler = function (deferred) {\n  return function (arg) {\n    var error = arg instanceof Error ? arg : new Error(arg && String(arg) || \"Unknown error\");\n    deferred.reject(error);\n  };\n};\n\nvar _getEditMode = function (that) {\n  var editMode = that.option(\"editing.mode\");\n\n  if (EDIT_MODES.indexOf(editMode) !== -1) {\n    return editMode;\n  }\n\n  return EDIT_MODE_ROW;\n};\n\nvar _isRowEditMode = function (that) {\n  var editMode = _getEditMode(that);\n\n  return ROW_BASED_MODES.indexOf(editMode) !== -1;\n};\n\nvar EditingController = _uiGrid_core2.default.ViewController.inherit(function () {\n  var getDefaultEditorTemplate = function (that) {\n    return function (container, options) {\n      var $editor = (0, _renderer2.default)(\"<div>\").appendTo(container);\n      that.getController(\"editorFactory\").createEditor($editor, (0, _extend.extend)({}, options.column, {\n        value: options.value,\n        setValue: options.setValue,\n        row: options.row,\n        parentType: \"dataRow\",\n        width: null,\n        readOnly: !options.setValue,\n        isOnForm: options.isOnForm,\n        id: options.id\n      }));\n    };\n  };\n\n  var getEditingTexts = function (options) {\n    var editingTexts = options.component.option(\"editing.texts\") || {};\n    return {\n      save: editingTexts.saveRowChanges,\n      cancel: editingTexts.cancelRowChanges,\n      edit: editingTexts.editRow,\n      undelete: editingTexts.undeleteRow,\n      \"delete\": editingTexts.deleteRow,\n      add: editingTexts.addRowToNode\n    };\n  };\n\n  var getButtonIndex = function (buttons, name) {\n    var result = -1;\n    buttons.some(function (button, index) {\n      if (getButtonName(button) === name) {\n        result = index;\n        return true;\n      }\n    });\n    return result;\n  };\n\n  function getButtonName(button) {\n    return _type2.default.isObject(button) ? button.name : button;\n  }\n\n  var getEditorType = function (item) {\n    var column = item.column;\n    return item.isCustomEditorType ? item.editorType : column.formItem && column.formItem.editorType;\n  };\n\n  var forEachFormItems = function forEachFormItems(items, callBack) {\n    items.forEach(function (item) {\n      if (item.items || item.tabs) {\n        forEachFormItems(item.items || item.tabs, callBack);\n      } else {\n        callBack(item);\n      }\n    });\n  };\n\n  return {\n    init: function () {\n      var that = this;\n      that._editRowIndex = -1;\n      that._editData = [];\n      that._editColumnIndex = -1;\n      that._columnsController = that.getController(\"columns\");\n      that._dataController = that.getController(\"data\");\n      that._rowsView = that.getView(\"rowsView\");\n      that._editForm = null;\n      that._updateEditFormDeferred = null;\n      that._lastOperation = null;\n\n      if (that._deferreds) {\n        that._deferreds.forEach(function (d) {\n          return d.reject(\"cancel\");\n        });\n      }\n\n      that._deferreds = [];\n\n      if (!that._dataChangedHandler) {\n        that._dataChangedHandler = that._handleDataChanged.bind(that);\n\n        that._dataController.changed.add(that._dataChangedHandler);\n      }\n\n      if (!that._saveEditorHandler) {\n        that.createAction(\"onInitNewRow\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowInserting\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowInserted\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onEditingStart\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowUpdating\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowUpdated\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowRemoving\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        that.createAction(\"onRowRemoved\", {\n          excludeValidators: [\"disabled\", \"readOnly\"]\n        });\n        var $pointerDownTarget;\n\n        that._pointerDownEditorHandler = function (e) {\n          return $pointerDownTarget = (0, _renderer2.default)(e.target);\n        };\n\n        that._saveEditorHandler = that.createAction(function (e) {\n          var event = e.event;\n          var $target = (0, _renderer2.default)(event.target);\n          var targetComponent = event[TARGET_COMPONENT_NAME];\n\n          if ($pointerDownTarget && $pointerDownTarget.is(\"input\") && !$pointerDownTarget.is($target)) {\n            return;\n          }\n\n          function checkEditorPopup($element) {\n            return $element && !!$element.closest(\".\".concat(DROPDOWN_EDITOR_OVERLAY_CLASS)).length;\n          }\n\n          if (!_isRowEditMode(that) && !that._editCellInProgress) {\n            var isEditorPopup = checkEditorPopup($target) || checkEditorPopup(null === targetComponent || void 0 === targetComponent ? void 0 : targetComponent.$element());\n            var isDomElement = !!$target.closest((0, _window.getWindow)().document).length;\n            var isAnotherComponent = targetComponent && !targetComponent._disposed && targetComponent !== that.component;\n            var isAddRowButton = !!$target.closest(\".\".concat(that.addWidgetPrefix(ADD_ROW_BUTTON_CLASS))).length;\n            var isFocusOverlay = $target.hasClass(that.addWidgetPrefix(FOCUS_OVERLAY_CLASS));\n            var isCellEditMode = _getEditMode(that) === EDIT_MODE_CELL;\n\n            if (!isEditorPopup && !isFocusOverlay && !(isAddRowButton && isCellEditMode && that.isEditing()) && (isDomElement || isAnotherComponent)) {\n              that._closeEditItem.bind(that)($target);\n            }\n          }\n        });\n\n        _events_engine2.default.on(_dom_adapter2.default.getDocument(), _pointer2.default.down, that._pointerDownEditorHandler);\n\n        _events_engine2.default.on(_dom_adapter2.default.getDocument(), _click2.default.name, that._saveEditorHandler);\n      }\n\n      that._updateEditColumn();\n\n      that._updateEditButtons();\n    },\n    getUpdatedData: function (data) {\n      var key = this._dataController.keyOf(data);\n\n      var editData = this._editData;\n      var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, editData);\n\n      if (editData[editIndex]) {\n        return (0, _uiGrid_core3.createObjectWithChanges)(data, editData[editIndex].data);\n      }\n\n      return data;\n    },\n    getInsertedData: function () {\n      return this._editData.filter(function (editData) {\n        return editData.data && editData.type === DATA_EDIT_DATA_INSERT_TYPE;\n      }).map(function (editData) {\n        return editData.data;\n      });\n    },\n    getRemovedData: function () {\n      return this._editData.filter(function (editData) {\n        return editData.oldData && editData.type === DATA_EDIT_DATA_REMOVE_TYPE;\n      }).map(function (editData) {\n        return editData.oldData;\n      });\n    },\n    _fireDataErrorOccurred: function (arg) {\n      if (\"cancel\" === arg) {\n        return;\n      }\n\n      var $popupContent = this.getPopupContent();\n\n      this._dataController.dataErrorOccurred.fire(arg, $popupContent);\n    },\n    _needToCloseEditableCell: function ($targetElement) {\n      var $element = this.component.$element();\n      var result = this.isEditing();\n      var isCurrentComponentElement = !$element || !!$targetElement.closest($element).length;\n\n      if (isCurrentComponentElement) {\n        var isDataRow = $targetElement.closest(\".\" + DATA_ROW_CLASS).length;\n\n        if (isDataRow) {\n          var rowsView = this.getView(\"rowsView\");\n          var $targetCell = $targetElement.closest(\".\" + ROW_CLASS + \"> td\");\n          var rowIndex = rowsView.getRowIndex($targetCell.parent());\n          var columnIndex = rowsView.getCellElements(rowIndex).index($targetCell);\n\n          var visibleColumns = this._columnsController.getVisibleColumns();\n\n          var allowEditing = visibleColumns[columnIndex] && visibleColumns[columnIndex].allowEditing;\n          result = result && !allowEditing && !this.isEditCell(rowIndex, columnIndex);\n        }\n      }\n\n      return result;\n    },\n    _closeEditItem: function ($targetElement) {\n      if (this._needToCloseEditableCell($targetElement)) {\n        this.closeEditCell();\n      }\n    },\n    _handleDataChanged: function (args) {\n      var that = this;\n      var editForm = that._editForm;\n\n      if (\"standard\" === that.option(\"scrolling.mode\")) {\n        that.resetRowAndPageIndices();\n      }\n\n      if (\"prepend\" === args.changeType) {\n        (0, _iterator.each)(that._editData, function (_, editData) {\n          editData.rowIndex += args.items.length;\n        });\n      }\n\n      if (\"refresh\" === args.changeType && _getEditMode(that) === EDIT_MODE_POPUP && editForm && editForm.option(\"visible\")) {\n        this._repaintEditPopup();\n      }\n    },\n    _isDefaultButtonVisible: function (button, options) {\n      var result = true;\n\n      var isRowMode = _isRowEditMode(this);\n\n      var isEditRow = options.row && options.row.rowIndex === this._getVisibleEditRowIndex() && isRowMode;\n\n      switch (button.name) {\n        case \"edit\":\n          result = !isEditRow && this.allowUpdating(options) && isRowMode;\n          break;\n\n        case \"save\":\n        case \"cancel\":\n          result = isEditRow;\n          break;\n\n        case \"delete\":\n          result = !isEditRow && this.allowDeleting(options) && !options.row.removed;\n          break;\n\n        case \"undelete\":\n          result = this.allowDeleting(options) && options.row.removed;\n      }\n\n      return result;\n    },\n    _isButtonVisible: function (button, options) {\n      var visible = button.visible;\n\n      if (!_type2.default.isDefined(visible)) {\n        return this._isDefaultButtonVisible(button, options);\n      }\n\n      return _type2.default.isFunction(visible) ? visible.call(button, {\n        component: options.component,\n        row: options.row,\n        column: options.column\n      }) : visible;\n    },\n    _getButtonConfig: function (button, options) {\n      var _this = this;\n\n      var config = _type2.default.isObject(button) ? button : {};\n      var buttonName = getButtonName(button);\n      var editingTexts = getEditingTexts(options);\n      var methodName = METHOD_NAMES[buttonName];\n      var editingOptions = this.option(\"editing\");\n      var actionName = ACTION_OPTION_NAMES[buttonName];\n      var allowAction = actionName ? editingOptions[actionName] : true;\n      return (0, _extend.extend)({\n        name: buttonName,\n        text: editingTexts[buttonName],\n        cssClass: EDIT_LINK_CLASS[buttonName],\n        onClick: function (e) {\n          var event = e.event;\n          event.stopPropagation();\n          event.preventDefault();\n          setTimeout(function () {\n            options.row && allowAction && _this[methodName] && _this[methodName](options.row.rowIndex);\n          });\n        }\n      }, config);\n    },\n    _getEditingButtons: function (options) {\n      var _this2 = this;\n\n      var buttonIndex;\n      var haveCustomButtons = !!options.column.buttons;\n      var buttons = (options.column.buttons || []).slice();\n\n      if (haveCustomButtons) {\n        buttonIndex = getButtonIndex(buttons, \"edit\");\n\n        if (buttonIndex >= 0) {\n          if (getButtonIndex(buttons, \"save\") < 0) {\n            buttons.splice(buttonIndex + 1, 0, \"save\");\n          }\n\n          if (getButtonIndex(buttons, \"cancel\") < 0) {\n            buttons.splice(getButtonIndex(buttons, \"save\") + 1, 0, \"cancel\");\n          }\n        }\n\n        buttonIndex = getButtonIndex(buttons, \"delete\");\n\n        if (buttonIndex >= 0 && getButtonIndex(buttons, \"undelete\") < 0) {\n          buttons.splice(buttonIndex + 1, 0, \"undelete\");\n        }\n      } else {\n        buttons = BUTTON_NAMES.slice();\n      }\n\n      return buttons.map(function (button) {\n        return _this2._getButtonConfig(button, options);\n      });\n    },\n    _renderEditingButtons: function ($container, buttons, options) {\n      var _this3 = this;\n\n      buttons.forEach(function (button) {\n        if (_this3._isButtonVisible(button, options)) {\n          _this3._createButton($container, button, options);\n        }\n      });\n    },\n    _getEditCommandCellTemplate: function () {\n      var _this4 = this;\n\n      return function (container, options) {\n        var $container = (0, _renderer2.default)(container);\n\n        if (\"data\" === options.rowType) {\n          options.rtlEnabled = _this4.option(\"rtlEnabled\");\n\n          var buttons = _this4._getEditingButtons(options);\n\n          _this4._renderEditingButtons($container, buttons, options);\n\n          options.watch && options.watch(function () {\n            return buttons.map(function (button) {\n              return _this4._isButtonVisible(button, options);\n            });\n          }, function () {\n            $container.empty();\n\n            _this4._renderEditingButtons($container, buttons, options);\n          });\n        } else {\n          (0, _uiGrid_core3.setEmptyText)($container);\n        }\n      };\n    },\n    correctEditRowIndexAfterExpand: function (key) {\n      if (this._editRowIndex > this._dataController.getRowIndexByKey(key)) {\n        this._editRowIndex++;\n      }\n    },\n    correctEditRowIndex: function (getRowIndexCorrection) {\n      this._editRowIndex += getRowIndexCorrection(this._getVisibleEditRowIndex());\n    },\n    isRowEditMode: function () {\n      return _isRowEditMode(this);\n    },\n    isFormEditMode: function () {\n      var editMode = _getEditMode(this);\n\n      return FORM_BASED_MODES.indexOf(editMode) !== -1;\n    },\n    isCellOrBatchEditMode: function () {\n      var editMode = this.getEditMode();\n      return editMode === EDIT_MODE_BATCH || editMode === EDIT_MODE_CELL;\n    },\n    getEditMode: function () {\n      return _getEditMode(this);\n    },\n    getFirstEditableColumnIndex: function () {\n      var columnsController = this.getController(\"columns\");\n      var firstFormItem = this._firstFormItem;\n      var columnIndex;\n\n      if (_getEditMode(this) === EDIT_MODE_FORM && firstFormItem) {\n        var $editFormElements = this._rowsView.getCellElements(this._editRowIndex);\n\n        columnIndex = this._rowsView._getEditFormEditorVisibleIndex($editFormElements, firstFormItem.column);\n      } else {\n        var visibleColumns = columnsController.getVisibleColumns();\n        (0, _iterator.each)(visibleColumns, function (index, column) {\n          if (column.allowEditing) {\n            columnIndex = index;\n            return false;\n          }\n        });\n      }\n\n      return columnIndex;\n    },\n    getFirstEditableCellInRow: function (rowIndex) {\n      var rowsView = this.getView(\"rowsView\");\n      return rowsView && rowsView._getCellElement(rowIndex ? rowIndex : 0, this.getFirstEditableColumnIndex());\n    },\n    getFocusedCellInRow: function (rowIndex) {\n      return this.getFirstEditableCellInRow(rowIndex);\n    },\n    getIndexByKey: function (key, items) {\n      return (0, _uiGrid_core3.getIndexByKey)(key, items);\n    },\n    hasChanges: function (rowIndex) {\n      var that = this;\n      var result = false;\n\n      for (var i = 0; i < that._editData.length; i++) {\n        if (that._editData[i].type && (!_type2.default.isDefined(rowIndex) || that._dataController.getRowIndexByKey(that._editData[i].key) === rowIndex)) {\n          result = true;\n          break;\n        }\n      }\n\n      return result;\n    },\n    dispose: function () {\n      this.callBase();\n      clearTimeout(this._inputFocusTimeoutID);\n\n      _events_engine2.default.off(_dom_adapter2.default.getDocument(), _pointer2.default.down, this._pointerDownEditorHandler);\n\n      _events_engine2.default.off(_dom_adapter2.default.getDocument(), _click2.default.name, this._saveEditorHandler);\n    },\n    optionChanged: function (args) {\n      if (\"editing\" === args.name) {\n        var fullName = args.fullName;\n        var editPopup = this._editPopup;\n\n        if (fullName && 0 === fullName.indexOf(EDITING_POPUP_OPTION_NAME)) {\n          if (editPopup) {\n            var popupOptionName = fullName.slice(EDITING_POPUP_OPTION_NAME.length + 1);\n\n            if (popupOptionName) {\n              editPopup.option(popupOptionName, args.value);\n            } else {\n              editPopup.option(args.value);\n            }\n          }\n        } else {\n          if (editPopup && editPopup.option(\"visible\") && 0 === fullName.indexOf(\"editing.form\")) {\n            this._repaintEditPopup();\n          } else {\n            this.init();\n          }\n        }\n\n        args.handled = true;\n      } else {\n        this.callBase(args);\n      }\n    },\n    publicMethods: function () {\n      return [\"insertRow\", \"addRow\", \"removeRow\", \"deleteRow\", \"undeleteRow\", \"editRow\", \"editCell\", \"closeEditCell\", \"saveEditData\", \"cancelEditData\", \"hasEditData\"];\n    },\n    refresh: function (isPageChanged) {\n      var editMode = _getEditMode(this);\n\n      var needResetIndexes = editMode === EDIT_MODE_BATCH || isPageChanged && \"virtual\" !== this.option(\"scrolling.mode\");\n\n      if (editMode !== EDIT_MODE_BATCH && editMode !== EDIT_MODE_CELL) {\n        this.init();\n      } else {\n        if (needResetIndexes) {\n          this._editRowIndex = -1;\n          this._editColumnIndex = -1;\n        }\n      }\n    },\n    isEditing: function () {\n      return this._editRowIndex > -1;\n    },\n    isEditRow: function (rowIndex) {\n      var editMode = _getEditMode(this);\n\n      return this._getVisibleEditRowIndex() === rowIndex && ROW_BASED_MODES.indexOf(editMode) !== -1;\n    },\n    getEditRowKey: function () {\n      var items = this._dataController.items();\n\n      var item = items[this._getVisibleEditRowIndex()];\n\n      return item && item.key;\n    },\n    getEditRowIndex: function () {\n      return this._getVisibleEditRowIndex();\n    },\n    getEditFormRowIndex: function () {\n      var editMode = _getEditMode(this);\n\n      return editMode === EDIT_MODE_FORM || editMode === EDIT_MODE_POPUP ? this._getVisibleEditRowIndex() : -1;\n    },\n    isEditCell: function (visibleRowIndex, columnIndex) {\n      var hasEditData = !!(Array.isArray(this._editData) && this._editData.length);\n      return hasEditData && this._getVisibleEditRowIndex() === visibleRowIndex && this._editColumnIndex === columnIndex;\n    },\n    getPopupContent: function () {\n      var editMode = _getEditMode(this);\n\n      var popupVisible = this._editPopup && this._editPopup.option(\"visible\");\n\n      if (editMode === EDIT_MODE_POPUP && popupVisible) {\n        return this._$popupContent;\n      }\n    },\n    getEditForm: function () {\n      return this._editForm;\n    },\n    _needInsertItem: function (editData, changeType) {\n      var that = this;\n\n      var dataSource = that._dataController.dataSource();\n\n      var scrollingMode = that.option(\"scrolling.mode\");\n      var pageIndex = dataSource.pageIndex();\n      var beginPageIndex = dataSource.beginPageIndex ? dataSource.beginPageIndex() : pageIndex;\n      var endPageIndex = dataSource.endPageIndex ? dataSource.endPageIndex() : pageIndex;\n\n      if (\"standard\" !== scrollingMode) {\n        switch (changeType) {\n          case \"append\":\n            return editData.key.pageIndex === endPageIndex;\n\n          case \"prepend\":\n            return editData.key.pageIndex === beginPageIndex;\n\n          case \"refresh\":\n            editData.key.rowIndex = 0;\n            editData.key.dataRowIndex = 0;\n            editData.key.pageIndex = 0;\n            break;\n\n          default:\n            return editData.key.pageIndex >= beginPageIndex && editData.key.pageIndex <= endPageIndex;\n        }\n      }\n\n      return editData.key.pageIndex === pageIndex;\n    },\n    _generateNewItem: function (key) {\n      var item = {\n        key: key\n      };\n\n      if (key && key[INSERT_INDEX]) {\n        item[INSERT_INDEX] = key[INSERT_INDEX];\n      }\n\n      return item;\n    },\n    processItems: function (items, change) {\n      var changeType = change.changeType;\n      var dataController = this._dataController;\n      var dataRowIndex = -1;\n      this.update(changeType);\n      var editData = this._editData;\n\n      for (var i = 0; i < editData.length; i++) {\n        var key = editData[i].key;\n\n        if (key) {\n          var rowIndexOffset = dataController.getRowIndexOffset();\n          dataRowIndex = key.dataRowIndex - rowIndexOffset + dataController.getRowIndexDelta();\n\n          if (\"append\" === changeType) {\n            dataRowIndex -= dataController.items(true).length;\n\n            if (change.removeCount) {\n              dataRowIndex += change.removeCount;\n            }\n          }\n\n          var item = this._generateNewItem(key);\n\n          if (dataRowIndex >= 0 && editData[i].type === DATA_EDIT_DATA_INSERT_TYPE && this._needInsertItem(editData[i], changeType, items, item)) {\n            items.splice(key.dataRowIndex ? dataRowIndex : 0, 0, item);\n          }\n        }\n      }\n\n      return items;\n    },\n    processDataItem: function (item, options, generateDataValues) {\n      var that = this;\n      var data;\n      var columns = options.visibleColumns;\n      var key = item.data[INSERT_INDEX] ? item.data.key : item.key;\n      var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, that._editData);\n      item.isEditing = false;\n\n      if (editIndex >= 0) {\n        var editMode = _getEditMode(that);\n\n        var editData = that._editData[editIndex];\n        data = editData.data;\n\n        switch (editData.type) {\n          case DATA_EDIT_DATA_INSERT_TYPE:\n            if (editMode === EDIT_MODE_POPUP) {\n              item.visible = false;\n            }\n\n            item.isNewRow = true;\n            item.key = key;\n            item.data = data;\n            break;\n\n          case DATA_EDIT_DATA_UPDATE_TYPE:\n            item.modified = true;\n            item.oldData = item.data;\n            item.data = (0, _uiGrid_core3.createObjectWithChanges)(item.data, data);\n            item.modifiedValues = generateDataValues(data, columns, true);\n            break;\n\n          case DATA_EDIT_DATA_REMOVE_TYPE:\n            if (editMode === EDIT_MODE_BATCH) {\n              item.data = (0, _uiGrid_core3.createObjectWithChanges)(item.data, data);\n            }\n\n            item.removed = true;\n        }\n      }\n    },\n    insertRow: function () {\n      _ui2.default.log(\"W0002\", \"dxDataGrid\", \"insertRow\", \"15.2\", \"Use the 'addRow' method instead\");\n\n      return this.addRow();\n    },\n    _initNewRow: function (options) {\n      var _this5 = this;\n\n      this.executeAction(\"onInitNewRow\", options);\n\n      if (options.promise) {\n        var deferred = new _deferred.Deferred();\n        (0, _deferred.when)((0, _deferred.fromPromise)(options.promise)).done(deferred.resolve).fail(createFailureHandler(deferred)).fail(function (arg) {\n          return _this5._fireDataErrorOccurred(arg);\n        });\n        return deferred;\n      }\n    },\n    _getInsertKey: function (parentKey) {\n      var that = this;\n      var dataController = that._dataController;\n      var rows = dataController.items();\n\n      var editMode = _getEditMode(that);\n\n      var insertKey = {\n        parentKey: parentKey,\n        pageIndex: dataController.pageIndex(),\n        rowIndex: that._getInsertRowIndex(parentKey)\n      };\n      var row = rows[insertKey.rowIndex];\n\n      if (row && (!row.isEditing && \"detail\" === row.rowType || \"detailAdaptive\" === row.rowType)) {\n        insertKey.rowIndex++;\n      }\n\n      insertKey.dataRowIndex = dataController.getRowIndexOffset() + rows.filter(function (row, index) {\n        return index < insertKey.rowIndex && (\"data\" === row.rowType || \"group\" === row.rowType || row.isNewRow);\n      }).length;\n\n      if (editMode !== EDIT_MODE_BATCH) {\n        that._editRowIndex = insertKey.rowIndex + that._dataController.getRowIndexOffset();\n      }\n\n      insertKey[INSERT_INDEX] = that._getInsertIndex();\n      return insertKey;\n    },\n    _getInsertRowIndex: function (parentKey) {\n      var that = this;\n      var rowsView = that.getView(\"rowsView\");\n\n      var parentRowIndex = that._dataController.getRowIndexByKey(parentKey);\n\n      if (parentRowIndex >= 0) {\n        return parentRowIndex + 1;\n      }\n\n      if (rowsView) {\n        return rowsView.getTopVisibleItemIndex(true);\n      }\n\n      return 0;\n    },\n    _getInsertIndex: function () {\n      var maxInsertIndex = 0;\n\n      this._editData.forEach(function (editItem) {\n        if (editItem.type === DATA_EDIT_DATA_INSERT_TYPE && editItem.key[INSERT_INDEX] > maxInsertIndex) {\n          maxInsertIndex = editItem.key[INSERT_INDEX];\n        }\n      });\n\n      return maxInsertIndex + 1;\n    },\n    addRow: function (parentKey) {\n      var that = this;\n      var dataController = that._dataController;\n      var store = dataController.store();\n      var key = store && store.key();\n      var param = {\n        data: {}\n      };\n\n      var editMode = _getEditMode(that);\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      var deferred = new _deferred.Deferred();\n\n      if (!store) {\n        dataController.fireError(\"E1052\", this.component.NAME);\n        return deferred.reject();\n      }\n\n      if (editMode === EDIT_MODE_CELL && that.hasChanges()) {\n        that.saveEditData().done(function () {\n          if (!that.hasChanges()) {\n            that.addRow(parentKey).done(deferred.resolve).fail(deferred.reject);\n          } else {\n            deferred.reject(\"cancel\");\n          }\n        });\n        return deferred.promise();\n      }\n\n      that.refresh();\n\n      if (!that._allowRowAdding()) {\n        return deferred.reject(\"cancel\");\n      }\n\n      if (!key) {\n        param.data.__KEY__ = String(new _guid2.default());\n      }\n\n      (0, _deferred.when)(that._initNewRow(param, parentKey)).done(function () {\n        if (that._allowRowAdding()) {\n          that._addRowCore(param.data, parentKey, oldEditRowIndex);\n\n          deferred.resolve();\n        } else {\n          deferred.reject(\"cancel\");\n        }\n      }).fail(deferred.reject);\n      return deferred.promise();\n    },\n    _allowRowAdding: function () {\n      var that = this;\n\n      var editMode = _getEditMode(that);\n\n      var insertIndex = that._getInsertIndex();\n\n      if (editMode !== EDIT_MODE_BATCH && insertIndex > 1) {\n        return false;\n      }\n\n      return true;\n    },\n    _addRowCore: function (data, parentKey, initialOldEditRowIndex) {\n      var that = this;\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      var insertKey = that._getInsertKey(parentKey);\n\n      var editMode = _getEditMode(that);\n\n      that._addEditData({\n        key: insertKey,\n        data: data,\n        type: DATA_EDIT_DATA_INSERT_TYPE\n      });\n\n      that._dataController.updateItems({\n        changeType: \"update\",\n        rowIndices: [initialOldEditRowIndex, oldEditRowIndex, insertKey.rowIndex]\n      });\n\n      if (editMode === EDIT_MODE_POPUP) {\n        that._showEditPopup(insertKey.rowIndex);\n      } else {\n        that._focusFirstEditableCellInRow(insertKey.rowIndex);\n      }\n\n      that._afterInsertRow({\n        key: insertKey,\n        data: data\n      });\n    },\n    _focusFirstEditableCellInRow: function (rowIndex) {\n      var that = this;\n      var $firstCell = that.getFirstEditableCellInRow(rowIndex);\n      that._editCellInProgress = true;\n\n      that._delayedInputFocus($firstCell, function () {\n        that._editCellInProgress = false;\n        var $cell = that.getFirstEditableCellInRow(rowIndex);\n        var eventToTrigger = \"dblClick\" === that.option(\"editing.startEditAction\") ? _double_click2.default.name : _click2.default.name;\n        $cell && _events_engine2.default.trigger($cell, eventToTrigger);\n      });\n    },\n    _isEditingStart: function (options) {\n      this.executeAction(\"onEditingStart\", options);\n      return options.cancel;\n    },\n    _beforeEditCell: function (rowIndex, columnIndex, item) {\n      var that = this;\n\n      if (_getEditMode(that) === EDIT_MODE_CELL && !item.isNewRow && that.hasChanges()) {\n        var d = new _deferred.Deferred();\n        that.saveEditData().always(function () {\n          d.resolve(that.hasChanges());\n        });\n        return d;\n      }\n    },\n    _beforeUpdateItems: function () {},\n    _getVisibleEditRowIndex: function () {\n      return this._editRowIndex >= 0 ? this._editRowIndex - this._dataController.getRowIndexOffset() : -1;\n    },\n    editRow: function (rowIndex) {\n      var that = this;\n      var dataController = that._dataController;\n      var items = dataController.items();\n      var item = items[rowIndex];\n      var params = {\n        data: item && item.data,\n        cancel: false\n      };\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      var $editingCell;\n\n      if (!item) {\n        return;\n      }\n\n      if (rowIndex === oldEditRowIndex) {\n        return true;\n      }\n\n      if (!item.isNewRow) {\n        params.key = item.key;\n      }\n\n      if (that._isEditingStart(params)) {\n        return;\n      }\n\n      that.init();\n      that._pageIndex = dataController.pageIndex();\n      that._editRowIndex = (items[0].isNewRow ? rowIndex - 1 : rowIndex) + that._dataController.getRowIndexOffset();\n\n      that._addEditData({\n        data: {},\n        key: item.key,\n        oldData: item.data\n      });\n\n      var rowIndices = [oldEditRowIndex, rowIndex];\n\n      var editMode = _getEditMode(that);\n\n      that._beforeUpdateItems(rowIndices, rowIndex, oldEditRowIndex);\n\n      if (editMode === EDIT_MODE_POPUP) {\n        that._showEditPopup(rowIndex);\n      } else {\n        dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: rowIndices\n        });\n      }\n\n      if (MODES_WITH_DELAYED_FOCUS.indexOf(editMode) !== -1) {\n        $editingCell = that.getFocusedCellInRow(that._getVisibleEditRowIndex());\n\n        that._delayedInputFocus($editingCell, function () {\n          $editingCell && that.component.focus($editingCell);\n        });\n      }\n    },\n    _showEditPopup: function (rowIndex, repaintForm) {\n      var that = this;\n\n      var isMobileDevice = \"desktop\" !== _devices2.default.current().deviceType;\n\n      var popupOptions = (0, _extend.extend)({\n        showTitle: false,\n        fullScreen: isMobileDevice,\n        toolbarItems: [{\n          toolbar: \"bottom\",\n          location: \"after\",\n          widget: \"dxButton\",\n          options: that._getSaveButtonConfig()\n        }, {\n          toolbar: \"bottom\",\n          location: \"after\",\n          widget: \"dxButton\",\n          options: that._getCancelButtonConfig()\n        }],\n        contentTemplate: that._getPopupEditFormTemplate(rowIndex)\n      }, that.option(EDITING_POPUP_OPTION_NAME));\n\n      if (!that._editPopup) {\n        var $popupContainer = (0, _renderer2.default)(\"<div>\").appendTo(that.component.$element()).addClass(that.addWidgetPrefix(EDIT_POPUP_CLASS));\n        that._editPopup = that._createComponent($popupContainer, _popup2.default, {});\n\n        that._editPopup.on(\"hiding\", that._getEditPopupHiddenHandler());\n\n        that._editPopup.on(\"shown\", function (e) {\n          _events_engine2.default.trigger(e.component.$content().find(FOCUSABLE_ELEMENT_SELECTOR).not(\".\" + SCROLLABLE_CONTAINER_CLASS).first(), \"focus\");\n\n          if (repaintForm) {\n            that._editForm && that._editForm.repaint();\n          }\n        });\n      }\n\n      that._editPopup.option(popupOptions);\n\n      that._editPopup.show();\n    },\n    _repaintEditPopup: function () {\n      var rowIndex = this._getVisibleEditRowIndex();\n\n      if (this._editPopup && this._editPopup.option(\"visible\") && rowIndex >= 0) {\n        var defaultAnimation = this._editPopup.option(\"animation\");\n\n        this._editPopup.option(\"animation\", null);\n\n        this._showEditPopup(rowIndex, true);\n\n        this._editPopup.option(\"animation\", defaultAnimation);\n      }\n    },\n    _getEditPopupHiddenHandler: function () {\n      var that = this;\n      return function (e) {\n        if (that.isEditing()) {\n          that.cancelEditData();\n        }\n      };\n    },\n    _getPopupEditFormTemplate: function (rowIndex) {\n      var that = this;\n      var row = that.component.getVisibleRows()[rowIndex];\n      var templateOptions = {\n        row: row,\n        rowType: row.rowType,\n        key: row.key\n      };\n      return function (container) {\n        var formTemplate = that.getEditFormTemplate();\n\n        var scrollable = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo(container), _ui4.default);\n\n        that._$popupContent = scrollable.$content();\n        formTemplate(that._$popupContent, templateOptions, true);\n      };\n    },\n    _getSaveButtonConfig: function () {\n      return {\n        text: this.option(\"editing.texts.saveRowChanges\"),\n        onClick: this.saveEditData.bind(this)\n      };\n    },\n    _getCancelButtonConfig: function () {\n      return {\n        text: this.option(\"editing.texts.cancelRowChanges\"),\n        onClick: this.cancelEditData.bind(this)\n      };\n    },\n    _removeEditDataItem: function (index) {\n      if (index >= 0) {\n        this._editData.splice(index, 1);\n      }\n    },\n    executeOperation: function (deferred, func) {\n      var _this6 = this;\n\n      this._lastOperation && this._lastOperation.reject();\n      this._lastOperation = deferred;\n      this.waitForDeferredOperations().done(function () {\n        if (\"rejected\" === deferred.state()) {\n          return;\n        }\n\n        func();\n        _this6._lastOperation = null;\n      }).fail(function () {\n        deferred.reject();\n        _this6._lastOperation = null;\n      });\n    },\n    waitForDeferredOperations: function () {\n      return _deferred.when.apply(void 0, _toConsumableArray(this._deferreds));\n    },\n    editCell: function (rowIndex, columnIndex) {\n      var _this7 = this;\n\n      var d = new _deferred.Deferred();\n      var coreResult;\n      this.executeOperation(d, function () {\n        coreResult = _this7._editCellCore(rowIndex, columnIndex);\n        (0, _deferred.when)(coreResult).done(d.resolve).fail(d.reject);\n      });\n      return void 0 !== coreResult ? coreResult : d.promise();\n    },\n    _editCellCore: function (rowIndex, columnIndex) {\n      var that = this;\n      var columnsController = that._columnsController;\n      var dataController = that._dataController;\n      var items = dataController.items();\n      var item = items[rowIndex];\n      var params = {\n        data: item && item.data,\n        cancel: false\n      };\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      var visibleColumns = columnsController.getVisibleColumns();\n      var oldColumn = visibleColumns[that._editColumnIndex];\n\n      if (_type2.default.isString(columnIndex)) {\n        columnIndex = columnsController.columnOption(columnIndex, \"index\");\n        columnIndex = columnsController.getVisibleIndex(columnIndex);\n      }\n\n      var column = params.column = visibleColumns[columnIndex];\n\n      if (column && item && (\"data\" === item.rowType || \"detailAdaptive\" === item.rowType) && !item.removed && !_isRowEditMode(that)) {\n        if (that.isEditCell(rowIndex, columnIndex)) {\n          return true;\n        }\n\n        var editRowIndex = rowIndex + dataController.getRowIndexOffset();\n        return (0, _deferred.when)(that._beforeEditCell(rowIndex, columnIndex, item)).done(function (cancel) {\n          if (cancel) {\n            return;\n          }\n\n          if (that._prepareEditCell(params, item, columnIndex, editRowIndex)) {\n            _common2.default.deferRender(function () {\n              that._repaintEditCell(column, oldColumn, oldEditRowIndex);\n            });\n          } else {\n            that._processCanceledEditingCell();\n          }\n        });\n      }\n\n      return false;\n    },\n    _processCanceledEditingCell: function () {},\n    _prepareEditCell: function (params, item, editColumnIndex, editRowIndex) {\n      var that = this;\n\n      if (!item.isNewRow) {\n        params.key = item.key;\n      }\n\n      if (that._isEditingStart(params)) {\n        return false;\n      }\n\n      that._editRowIndex = editRowIndex;\n      that._editColumnIndex = editColumnIndex;\n      that._pageIndex = that._dataController.pageIndex();\n\n      that._addEditData({\n        data: {},\n        key: item.key,\n        oldData: item.data\n      });\n\n      return true;\n    },\n    _repaintEditCell: function (column, oldColumn, oldEditRowIndex) {\n      var that = this;\n      var rowsView = that._rowsView;\n\n      if (!column || !column.showEditorAlways || oldColumn && !oldColumn.showEditorAlways) {\n        that._editCellInProgress = true;\n        that.getController(\"editorFactory\").loseFocus();\n\n        that._dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: [oldEditRowIndex, that._getVisibleEditRowIndex()]\n        });\n      }\n\n      var $cell = rowsView && rowsView._getCellElement(that._getVisibleEditRowIndex(), that._editColumnIndex);\n\n      if ($cell && !$cell.find(\":focus\").length) {\n        that._focusEditingCell(function () {\n          that._editCellInProgress = false;\n        }, $cell, true);\n      } else {\n        that._editCellInProgress = false;\n      }\n    },\n    _delayedInputFocus: function ($cell, beforeFocusCallback, callBeforeFocusCallbackAlways) {\n      var that = this;\n\n      function inputFocus() {\n        if (beforeFocusCallback) {\n          beforeFocusCallback();\n        }\n\n        if ($cell) {\n          var $focusableElement = $cell.find(FOCUSABLE_ELEMENT_SELECTOR).first();\n          (0, _uiGrid_core3.focusAndSelectElement)(that, $focusableElement);\n        }\n\n        that._beforeFocusCallback = null;\n      }\n\n      if (_devices2.default.real().ios || _devices2.default.real().android) {\n        inputFocus();\n      } else {\n        if (that._beforeFocusCallback) {\n          that._beforeFocusCallback();\n        }\n\n        clearTimeout(that._inputFocusTimeoutID);\n\n        if (callBeforeFocusCallbackAlways) {\n          that._beforeFocusCallback = beforeFocusCallback;\n        }\n\n        that._inputFocusTimeoutID = setTimeout(inputFocus);\n      }\n    },\n    _focusEditingCell: function (beforeFocusCallback, $editCell, callBeforeFocusCallbackAlways) {\n      var that = this;\n      var rowsView = that.getView(\"rowsView\");\n      $editCell = $editCell || rowsView && rowsView._getCellElement(that._getVisibleEditRowIndex(), that._editColumnIndex);\n\n      that._delayedInputFocus($editCell, beforeFocusCallback, callBeforeFocusCallbackAlways);\n    },\n    removeRow: function (rowIndex) {\n      _ui2.default.log(\"W0002\", \"dxDataGrid\", \"removeRow\", \"15.2\", \"Use the 'deleteRow' method instead\");\n\n      return this.deleteRow(rowIndex);\n    },\n    deleteRow: function (rowIndex) {\n      var _this8 = this;\n\n      if (\"cell\" === this.option(\"editing.mode\") && this.isEditing()) {\n        var isNewRow = this._dataController.items()[rowIndex].isNewRow;\n\n        this.closeEditCell(null, isNewRow).always(function () {\n          _this8._checkAndDeleteRow(rowIndex);\n        });\n      } else {\n        this._checkAndDeleteRow(rowIndex);\n      }\n    },\n    _checkAndDeleteRow: function (rowIndex) {\n      var that = this;\n      var editingOptions = that.option(\"editing\");\n      var editingTexts = editingOptions && editingOptions.texts;\n      var isBatchMode = editingOptions && editingOptions.mode === EDIT_MODE_BATCH;\n      var confirmDelete = editingOptions && editingOptions.confirmDelete;\n      var confirmDeleteMessage = editingTexts && editingTexts.confirmDeleteMessage;\n\n      var item = that._dataController.items()[rowIndex];\n\n      var allowDeleting = isBatchMode || !that.isEditing() || item.isNewRow;\n\n      if (item && allowDeleting) {\n        if (isBatchMode || !confirmDelete || !confirmDeleteMessage) {\n          that._deleteRowCore(rowIndex);\n        } else {\n          var confirmDeleteTitle = editingTexts && editingTexts.confirmDeleteTitle;\n          var showDialogTitle = _type2.default.isDefined(confirmDeleteTitle) && confirmDeleteTitle.length > 0;\n\n          _dialog2.default.confirm(confirmDeleteMessage, confirmDeleteTitle, showDialogTitle).done(function (confirmResult) {\n            if (confirmResult) {\n              that._deleteRowCore(rowIndex);\n            }\n          });\n        }\n      }\n    },\n    _deleteRowCore: function (rowIndex) {\n      var dataController = this._dataController;\n      var item = dataController.items()[rowIndex];\n      var key = item && item.key;\n\n      var oldEditRowIndex = this._getVisibleEditRowIndex();\n\n      var isBatchMode = this.option(\"editing.mode\") === EDIT_MODE_BATCH;\n      this.refresh();\n      var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, this._editData);\n\n      if (editIndex >= 0) {\n        if (this._editData[editIndex].type === DATA_EDIT_DATA_INSERT_TYPE) {\n          this._removeEditDataItem(editIndex);\n        } else {\n          this._addEditData({\n            key: key,\n            type: DATA_EDIT_DATA_REMOVE_TYPE\n          });\n        }\n      } else {\n        this._addEditData({\n          key: key,\n          oldData: item.data,\n          type: DATA_EDIT_DATA_REMOVE_TYPE\n        });\n      }\n\n      if (isBatchMode) {\n        dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: [oldEditRowIndex, rowIndex]\n        });\n      } else {\n        this.saveEditData();\n      }\n    },\n    undeleteRow: function (rowIndex) {\n      var that = this;\n      var dataController = that._dataController;\n      var item = dataController.items()[rowIndex];\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      var key = item && item.key;\n\n      if (item) {\n        var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, that._editData);\n\n        if (editIndex >= 0) {\n          var editData = that._editData[editIndex];\n\n          if (_type2.default.isEmptyObject(editData.data)) {\n            that._removeEditDataItem(editIndex);\n          } else {\n            that._addEditData({\n              key: key,\n              type: DATA_EDIT_DATA_UPDATE_TYPE\n            });\n          }\n\n          dataController.updateItems({\n            changeType: \"update\",\n            rowIndices: [oldEditRowIndex, rowIndex]\n          });\n        }\n      }\n    },\n    _saveEditDataCore: function (deferreds, results, changes) {\n      var that = this;\n\n      var store = that._dataController.store();\n\n      var isDataSaved = true;\n\n      function executeEditingAction(actionName, params, func) {\n        var deferred = new _deferred.Deferred();\n        that.executeAction(actionName, params);\n        (0, _deferred.when)((0, _deferred.fromPromise)(params.cancel)).done(function (cancel) {\n          if (cancel) {\n            setTimeout(function () {\n              deferred.resolve(\"cancel\");\n            });\n          } else {\n            func(params).done(deferred.resolve).fail(createFailureHandler(deferred));\n          }\n        }).fail(createFailureHandler(deferred));\n        return deferred;\n      }\n\n      (0, _iterator.each)(that._editData, function (index, editData) {\n        var data = editData.data;\n        var oldData = editData.oldData;\n        var type = editData.type;\n        var deferred;\n        var params;\n\n        if (that._beforeSaveEditData(editData, index)) {\n          return;\n        }\n\n        switch (type) {\n          case DATA_EDIT_DATA_REMOVE_TYPE:\n            params = {\n              data: oldData,\n              key: editData.key,\n              cancel: false\n            };\n            deferred = executeEditingAction(\"onRowRemoving\", params, function () {\n              return store.remove(editData.key).done(function (key) {\n                changes.push({\n                  type: \"remove\",\n                  key: key\n                });\n              });\n            });\n            break;\n\n          case DATA_EDIT_DATA_INSERT_TYPE:\n            params = {\n              data: data,\n              cancel: false\n            };\n            deferred = executeEditingAction(\"onRowInserting\", params, function () {\n              return store.insert(params.data).done(function (data, key) {\n                if (_type2.default.isDefined(key)) {\n                  editData.key = key;\n                }\n\n                if (data && _type2.default.isObject(data) && data !== params.data) {\n                  editData.data = data;\n                }\n\n                changes.push({\n                  type: \"insert\",\n                  data: data,\n                  index: 0\n                });\n              });\n            });\n            break;\n\n          case DATA_EDIT_DATA_UPDATE_TYPE:\n            params = {\n              newData: data,\n              oldData: oldData,\n              key: editData.key,\n              cancel: false\n            };\n            deferred = executeEditingAction(\"onRowUpdating\", params, function () {\n              return store.update(editData.key, params.newData).done(function (data, key) {\n                if (data && _type2.default.isObject(data) && data !== params.newData) {\n                  editData.data = data;\n                }\n\n                changes.push({\n                  type: \"update\",\n                  key: key,\n                  data: data\n                });\n              });\n            });\n        }\n\n        if (deferred) {\n          var doneDeferred = new _deferred.Deferred();\n          deferred.always(function (data) {\n            isDataSaved = \"cancel\" !== data;\n            results.push({\n              key: editData.key,\n              result: data\n            });\n          }).always(doneDeferred.resolve);\n          deferreds.push(doneDeferred.promise());\n        }\n      });\n      return isDataSaved;\n    },\n    _processSaveEditDataResult: function (results) {\n      var that = this;\n      var hasSavedData = false;\n\n      var editMode = _getEditMode(that);\n\n      for (var i = 0; i < results.length; i++) {\n        var arg = results[i].result;\n        var cancel = \"cancel\" === arg;\n        var editIndex = (0, _uiGrid_core3.getIndexByKey)(results[i].key, that._editData);\n        var editData = that._editData[editIndex];\n        var isError = arg && arg instanceof Error;\n\n        if (isError) {\n          if (editData) {\n            editData.error = arg;\n          }\n\n          that._fireDataErrorOccurred(arg);\n\n          if (editMode !== EDIT_MODE_BATCH) {\n            if (editData && editData.type === DATA_EDIT_DATA_REMOVE_TYPE) {\n              that._removeEditDataItem(editIndex);\n            }\n\n            break;\n          }\n        } else {\n          if (!cancel || !editData || editMode !== EDIT_MODE_BATCH && editData.type === DATA_EDIT_DATA_REMOVE_TYPE) {\n            that._removeEditDataItem(editIndex);\n\n            hasSavedData = !cancel;\n          }\n        }\n      }\n\n      return hasSavedData;\n    },\n    _fireSaveEditDataEvents: function (editData) {\n      var that = this;\n      (0, _iterator.each)(editData, function (_, itemData) {\n        var data = itemData.data;\n        var key = itemData.key;\n        var type = itemData.type;\n        var params = {\n          key: key,\n          data: data\n        };\n\n        if (itemData.error) {\n          params.error = itemData.error;\n        }\n\n        switch (type) {\n          case DATA_EDIT_DATA_REMOVE_TYPE:\n            that.executeAction(\"onRowRemoved\", (0, _extend.extend)({}, params, {\n              data: itemData.oldData\n            }));\n            break;\n\n          case DATA_EDIT_DATA_INSERT_TYPE:\n            that.executeAction(\"onRowInserted\", params);\n            break;\n\n          case DATA_EDIT_DATA_UPDATE_TYPE:\n            that.executeAction(\"onRowUpdated\", params);\n        }\n      });\n    },\n    saveEditData: function () {\n      var _this9 = this;\n\n      var deferred = new _deferred.Deferred();\n\n      var afterSaveEditData = function (cancel) {\n        (0, _deferred.when)(_this9._afterSaveEditData(cancel)).done(function () {\n          deferred.resolve();\n        });\n      };\n\n      this.waitForDeferredOperations().done(function () {\n        if (_this9._saving) {\n          afterSaveEditData();\n          return;\n        }\n\n        (0, _deferred.when)(_this9._beforeSaveEditData()).done(function (cancel) {\n          if (cancel) {\n            afterSaveEditData(cancel);\n            return;\n          }\n\n          _this9._saveEditDataInner().done(deferred.resolve).fail(deferred.reject);\n        }).fail(deferred.reject);\n      }).fail(deferred.reject);\n      return deferred.promise();\n    },\n    _saveEditDataInner: function () {\n      var _this10 = this;\n\n      var results = [];\n      var deferreds = [];\n      var changes = [];\n      var dataController = this._dataController;\n      var dataSource = dataController.dataSource();\n\n      var editMode = _getEditMode(this);\n\n      var result = new _deferred.Deferred();\n\n      var resetEditIndices = function () {\n        if (editMode !== EDIT_MODE_CELL) {\n          _this10._editColumnIndex = -1;\n          _this10._editRowIndex = -1;\n        }\n      };\n\n      var afterSaveEditData = function (error) {\n        (0, _deferred.when)(_this10._afterSaveEditData()).done(function () {\n          result.resolve(error);\n        });\n      };\n\n      var editData = this._editData.slice(0);\n\n      if (!this._saveEditDataCore(deferreds, results, changes) && editMode === EDIT_MODE_CELL) {\n        this._focusEditingCell();\n      }\n\n      if (deferreds.length) {\n        this._saving = true;\n        dataSource && dataSource.beginLoading();\n\n        _deferred.when.apply(_renderer2.default, deferreds).done(function () {\n          if (_this10._processSaveEditDataResult(results)) {\n            resetEditIndices();\n\n            if (editMode === EDIT_MODE_POPUP && _this10._editPopup) {\n              _this10._editPopup.hide();\n            }\n\n            dataSource && dataSource.endLoading();\n\n            var refreshMode = _this10.option(\"editing.refreshMode\");\n\n            var isFullRefresh = \"reshape\" !== refreshMode && \"repaint\" !== refreshMode;\n\n            if (!isFullRefresh) {\n              dataController.push(changes);\n            }\n\n            (0, _deferred.when)(dataController.refresh({\n              selection: isFullRefresh,\n              reload: isFullRefresh,\n              load: \"reshape\" === refreshMode,\n              changesOnly: _this10.option(\"repaintChangesOnly\")\n            })).always(function () {\n              _this10._fireSaveEditDataEvents(editData);\n            }).done(function () {\n              afterSaveEditData();\n            }).fail(function (error) {\n              afterSaveEditData(error);\n            });\n          } else {\n            dataSource && dataSource.endLoading();\n            result.resolve();\n          }\n        }).fail(function (error) {\n          dataSource && dataSource.endLoading();\n          result.resolve(error);\n        });\n\n        return result.always(function () {\n          _this10._focusEditingCell();\n\n          _this10._saving = false;\n        }).promise();\n      }\n\n      if (_isRowEditMode(this)) {\n        if (!this.hasChanges()) {\n          this.cancelEditData();\n        }\n      } else {\n        if (CELL_BASED_MODES.indexOf(editMode) !== -1) {\n          resetEditIndices();\n          dataController.updateItems();\n        } else {\n          this._focusEditingCell();\n        }\n      }\n\n      afterSaveEditData();\n      return result.promise();\n    },\n    isSaving: function () {\n      return this._saving;\n    },\n    _updateEditColumn: function () {\n      var that = this;\n\n      var isEditColumnVisible = that._isEditColumnVisible();\n\n      var useIcons = that.option(\"editing.useIcons\");\n      var cssClass = COMMAND_EDIT_CLASS + (useIcons ? \" \" + COMMAND_EDIT_WITH_ICONS_CLASS : \"\");\n\n      that._columnsController.addCommandColumn({\n        type: \"buttons\",\n        command: \"edit\",\n        visible: isEditColumnVisible,\n        cssClass: cssClass,\n        width: \"auto\",\n        alignment: \"center\",\n        cellTemplate: that._getEditCommandCellTemplate(),\n        fixedPosition: \"right\"\n      });\n\n      that._columnsController.columnOption(\"command:edit\", {\n        visible: isEditColumnVisible,\n        cssClass: cssClass\n      });\n    },\n    _isEditColumnVisible: function () {\n      var that = this;\n      var editingOptions = that.option(\"editing\");\n\n      if (editingOptions) {\n        var editMode = _getEditMode(that);\n\n        var isVisibleWithCurrentEditMode = false;\n\n        switch (editMode) {\n          case EDIT_MODE_ROW:\n            isVisibleWithCurrentEditMode = editingOptions.allowUpdating || editingOptions.allowAdding;\n            break;\n\n          case EDIT_MODE_FORM:\n          case EDIT_MODE_POPUP:\n            isVisibleWithCurrentEditMode = editingOptions.allowUpdating;\n        }\n\n        return editingOptions.allowDeleting || isVisibleWithCurrentEditMode;\n      }\n    },\n    _updateEditButtons: function () {\n      var that = this;\n      var headerPanel = that.getView(\"headerPanel\");\n      var hasChanges = that.hasChanges();\n\n      if (headerPanel) {\n        headerPanel.setToolbarItemDisabled(\"saveButton\", !hasChanges);\n        headerPanel.setToolbarItemDisabled(\"revertButton\", !hasChanges);\n      }\n    },\n    _applyModified: function ($element) {\n      $element && $element.addClass(CELL_MODIFIED);\n    },\n    _beforeCloseEditCellInBatchMode: function () {},\n    cancelEditData: function () {\n      var that = this;\n\n      var editMode = _getEditMode(that);\n\n      var rowIndex = this._getVisibleEditRowIndex();\n\n      var dataController = that._dataController;\n\n      that._beforeCancelEditData();\n\n      that.init();\n\n      if (ROW_BASED_MODES.indexOf(editMode) !== -1 && rowIndex >= 0) {\n        dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: [rowIndex, rowIndex + 1]\n        });\n      } else {\n        dataController.updateItems({\n          repaintChangesOnly: that.option(\"repaintChangesOnly\")\n        });\n      }\n\n      if (editMode === EDIT_MODE_POPUP) {\n        that._hideEditPopup();\n      }\n    },\n    _hideEditPopup: function () {\n      this._editPopup && this._editPopup.option(\"visible\", false);\n    },\n    hasEditData: function () {\n      return this.hasChanges();\n    },\n    closeEditCell: function (isError, withoutSaveEditData) {\n      var _this11 = this;\n\n      var that = this;\n\n      var result = _deferred2.default.when();\n\n      var oldEditRowIndex = that._getVisibleEditRowIndex();\n\n      if (!_isRowEditMode(that)) {\n        result = _deferred2.default.Deferred();\n        this.executeOperation(result, function () {\n          _this11._closeEditCellCore(isError, oldEditRowIndex, withoutSaveEditData);\n\n          result.resolve();\n        });\n      }\n\n      return result.promise();\n    },\n    _closeEditCellCore: function (isError, oldEditRowIndex, withoutSaveEditData) {\n      var that = this;\n\n      var editMode = _getEditMode(that);\n\n      var dataController = that._dataController;\n\n      if (editMode === EDIT_MODE_CELL && that.hasChanges()) {\n        if (!withoutSaveEditData) {\n          that.saveEditData().done(function (error) {\n            if (!that.hasChanges()) {\n              that.closeEditCell(!!error);\n            }\n          });\n        }\n      } else {\n        if (oldEditRowIndex >= 0) {\n          var rowIndices = [oldEditRowIndex];\n          that._editRowIndex = -1;\n          that._editColumnIndex = -1;\n\n          that._beforeCloseEditCellInBatchMode(rowIndices);\n\n          if (!isError) {\n            dataController.updateItems({\n              changeType: \"update\",\n              rowIndices: rowIndices\n            });\n          }\n        }\n      }\n    },\n    update: function (changeType) {\n      var that = this;\n      var dataController = that._dataController;\n\n      if (dataController && that._pageIndex !== dataController.pageIndex()) {\n        if (\"refresh\" === changeType) {\n          that.refresh(true);\n        }\n\n        that._pageIndex = dataController.pageIndex();\n      }\n\n      that._updateEditButtons();\n    },\n    _getRowIndicesForCascadeUpdating: function (row, skipCurrentRow) {\n      return skipCurrentRow ? [] : [row.rowIndex];\n    },\n    addDeferred: function (deferred) {\n      var _this12 = this;\n\n      if (this._deferreds.indexOf(deferred) < 0) {\n        this._deferreds.push(deferred);\n\n        deferred.always(function () {\n          var index = _this12._deferreds.indexOf(deferred);\n\n          if (index >= 0) {\n            _this12._deferreds.splice(index, 1);\n          }\n        });\n      }\n    },\n    _prepareEditDataParams: function (options, value, text) {\n      var _options$row;\n\n      var that = this;\n      var newData = {};\n      var oldData = null === (_options$row = options.row) || void 0 === _options$row ? void 0 : _options$row.data;\n      var rowKey = options.key;\n      var $cellElement = (0, _renderer2.default)(options.cellElement);\n\n      var editMode = _getEditMode(that);\n\n      var deferred = new _deferred.Deferred();\n\n      if (void 0 !== rowKey) {\n        if (editMode === EDIT_MODE_BATCH) {\n          that._applyModified($cellElement, options);\n        }\n\n        options.value = value;\n        var setCellValueResult = (0, _deferred.fromPromise)(options.column.setCellValue(newData, value, (0, _extend.extend)(true, {}, oldData), text));\n        setCellValueResult.done(function () {\n          deferred.resolve({\n            data: newData,\n            key: rowKey,\n            oldData: oldData,\n            type: DATA_EDIT_DATA_UPDATE_TYPE\n          });\n        }).fail(createFailureHandler(deferred)).fail(function (arg) {\n          return that._fireDataErrorOccurred(arg);\n        });\n\n        if (_type2.default.isDefined(text) && options.column.displayValueMap) {\n          options.column.displayValueMap[value] = text;\n        }\n\n        if (options.values) {\n          options.values[options.columnIndex] = value;\n        }\n\n        that.addDeferred(deferred);\n      }\n\n      return deferred;\n    },\n    updateFieldValue: function (options, value, text, forceUpdateRow) {\n      var _this13 = this;\n\n      var rowKey = options.key;\n      var deferred = new _deferred.Deferred();\n\n      if (void 0 === rowKey) {\n        this._dataController.fireError(\"E1043\");\n      }\n\n      if (options.column.setCellValue) {\n        this._prepareEditDataParams(options, value, text).done(function (params) {\n          (0, _deferred.when)(_this13._applyEditDataParams(options, params, forceUpdateRow)).always(function () {\n            deferred.resolve();\n          });\n        });\n      } else {\n        deferred.resolve();\n      }\n\n      return deferred.promise();\n    },\n    _focusPreviousEditingCellIfNeed: function (options) {\n      var that = this;\n\n      if (that.hasEditData() && !that.isEditCell(options.rowIndex, options.columnIndex)) {\n        that._focusEditingCell();\n\n        that._updateEditRow(options.row, true);\n\n        return true;\n      }\n    },\n    _needUpdateRow: function (column) {\n      var visibleColumns = this._columnsController.getVisibleColumns();\n\n      if (!column) {\n        column = visibleColumns[this._editColumnIndex];\n      }\n\n      var isCustomSetCellValue = column && column.setCellValue !== column.defaultSetCellValue;\n      var isCustomCalculateCellValue = visibleColumns.some(function (visibleColumn) {\n        return visibleColumn.calculateCellValue !== visibleColumn.defaultCalculateCellValue;\n      });\n      return isCustomSetCellValue || isCustomCalculateCellValue;\n    },\n    _applyEditDataParams: function (options, params, forceUpdateRow) {\n      var that = this;\n\n      var editMode = _getEditMode(that);\n\n      var isCustomSetCellValue = options.column.setCellValue !== options.column.defaultSetCellValue;\n      var showEditorAlways = options.column.showEditorAlways;\n      var isUpdateInCellMode = editMode === EDIT_MODE_CELL && options.row && !options.row.isNewRow;\n      var focusPreviousEditingCell = showEditorAlways && !forceUpdateRow && isUpdateInCellMode && that.hasEditData() && !that.isEditCell(options.rowIndex, options.columnIndex);\n\n      if (focusPreviousEditingCell) {\n        that._focusEditingCell();\n\n        that._updateEditRow(options.row, true, isCustomSetCellValue);\n\n        return;\n      }\n\n      that._addEditData(params, options.row);\n\n      that._updateEditButtons();\n\n      if (showEditorAlways && !forceUpdateRow) {\n        if (isUpdateInCellMode) {\n          that._editRowIndex = options.row.rowIndex + that._dataController.getRowIndexOffset();\n          that._editColumnIndex = options.columnIndex;\n          return that.saveEditData();\n        } else {\n          if (editMode === EDIT_MODE_BATCH) {\n            forceUpdateRow = that._needUpdateRow(options.column);\n          }\n        }\n      }\n\n      var row = options.row;\n\n      if (row) {\n        if (forceUpdateRow || isCustomSetCellValue) {\n          that._updateEditRow(row, forceUpdateRow, isCustomSetCellValue);\n        } else {\n          if (row.update) {\n            row.update();\n          }\n        }\n      }\n    },\n    _updateEditRowCore: function (row, skipCurrentRow, isCustomSetCellValue) {\n      var that = this;\n      var editForm = that._editForm;\n\n      var editMode = _getEditMode(that);\n\n      if (editMode === EDIT_MODE_POPUP) {\n        if (that.option(\"repaintChangesOnly\")) {\n          row.update && row.update(row);\n        } else {\n          if (editForm) {\n            that._updateEditFormDeferred = new _deferred.Deferred().done(function () {\n              return editForm.repaint();\n            });\n\n            if (!that._updateLockCount) {\n              that._updateEditFormDeferred.resolve();\n            }\n          }\n        }\n      } else {\n        that._dataController.updateItems({\n          changeType: \"update\",\n          rowIndices: that._getRowIndicesForCascadeUpdating(row, skipCurrentRow)\n        });\n      }\n\n      if (isCustomSetCellValue && that._editForm && !row.isNewRow) {\n        that._editForm.validate();\n      }\n    },\n    _endUpdateCore: function () {\n      this._updateEditFormDeferred && this._updateEditFormDeferred.resolve();\n    },\n    _updateEditRow: function (row, forceUpdateRow, isCustomSetCellValue) {\n      var that = this;\n\n      if (forceUpdateRow || !_isRowEditMode(that)) {\n        that._updateEditRowCore(row, !forceUpdateRow, isCustomSetCellValue);\n\n        if (!forceUpdateRow) {\n          that._focusEditingCell();\n        }\n      } else {\n        var deferred = new _deferred.Deferred();\n        that.addDeferred(deferred);\n        setTimeout(function () {\n          var $focusedElement = (0, _renderer2.default)(_dom_adapter2.default.getActiveElement());\n\n          var columnIndex = that._rowsView.getCellIndex($focusedElement, row.rowIndex);\n\n          var focusedElement = $focusedElement.get(0);\n          var selectionRange = (0, _uiGrid_core3.getSelectionRange)(focusedElement);\n\n          that._updateEditRowCore(row, false, isCustomSetCellValue);\n\n          if (columnIndex >= 0) {\n            var $focusedItem = that._rowsView._getCellElement(row.rowIndex, columnIndex);\n\n            that._delayedInputFocus($focusedItem, function () {\n              setTimeout(function () {\n                focusedElement = _dom_adapter2.default.getActiveElement();\n\n                if (selectionRange.selectionStart >= 0) {\n                  (0, _uiGrid_core3.setSelectionRange)(focusedElement, selectionRange);\n                }\n              });\n            });\n          }\n\n          deferred.resolve();\n        });\n      }\n    },\n    _addEditData: function (options, row) {\n      var that = this;\n      var editDataIndex = (0, _uiGrid_core3.getIndexByKey)(options.key, that._editData);\n\n      if (editDataIndex < 0) {\n        editDataIndex = that._editData.length;\n\n        that._editData.push(options);\n      }\n\n      if (that._editData[editDataIndex]) {\n        if (options.data) {\n          that._editData[editDataIndex].data = (0, _uiGrid_core3.createObjectWithChanges)(that._editData[editDataIndex].data, options.data);\n        }\n\n        if ((!that._editData[editDataIndex].type || !options.data) && options.type) {\n          that._editData[editDataIndex].type = options.type;\n        }\n\n        if (row) {\n          row.oldData = that._editData[editDataIndex].oldData;\n          row.data = (0, _uiGrid_core3.createObjectWithChanges)(row.data, options.data);\n        }\n      }\n\n      return editDataIndex;\n    },\n    _getFormEditItemTemplate: function (cellOptions, column) {\n      return column.editCellTemplate || getDefaultEditorTemplate(this);\n    },\n    renderFormEditTemplate: function (detailCellOptions, item, form, container, isReadOnly) {\n      var that = this;\n      var $container = (0, _renderer2.default)(container);\n      var column = item.column;\n      var editorType = getEditorType(item);\n      var rowData = null === detailCellOptions || void 0 === detailCellOptions ? void 0 : detailCellOptions.row.data;\n      var cellOptions = (0, _extend.extend)({}, detailCellOptions, {\n        data: rowData,\n        cellElement: null,\n        isOnForm: true,\n        item: item,\n        column: (0, _extend.extend)({}, column, {\n          editorType: editorType,\n          editorOptions: item.editorOptions\n        }),\n        id: form.getItemID(item.name || item.dataField),\n        columnIndex: column.index,\n        setValue: !isReadOnly && column.allowEditing && function (value) {\n          that.updateFieldValue(cellOptions, value);\n        }\n      });\n      cellOptions.value = column.calculateCellValue(rowData);\n\n      var template = that._getFormEditItemTemplate.bind(that)(cellOptions, column);\n\n      that._rowsView.renderTemplate($container, template, cellOptions, !!$container.closest((0, _window.getWindow)().document).length).done(function () {\n        that._rowsView._updateCell($container, cellOptions);\n      });\n\n      return cellOptions;\n    },\n    getFormEditorTemplate: function (cellOptions, item) {\n      var that = this;\n      var column = this.component.columnOption(item.dataField);\n      return function (options, container) {\n        var $container = (0, _renderer2.default)(container);\n        cellOptions.row.watch && cellOptions.row.watch(function () {\n          return column.selector(cellOptions.row.data);\n        }, function () {\n          var _validator;\n\n          var $editorElement = $container.find(\".dx-widget\").first();\n          var validator = $editorElement.data(\"dxValidator\");\n          var validatorOptions = null === (_validator = validator) || void 0 === _validator ? void 0 : _validator.option();\n          $container.contents().remove();\n          cellOptions = that.renderFormEditTemplate.bind(that)(cellOptions, item, options.component, $container);\n          $editorElement = $container.find(\".dx-widget\").first();\n          validator = $editorElement.data(\"dxValidator\");\n\n          if (validatorOptions && !validator) {\n            $editorElement.dxValidator({\n              validationRules: validatorOptions.validationRules,\n              validationGroup: validatorOptions.validationGroup,\n              dataGetter: validatorOptions.dataGetter\n            });\n          }\n        });\n        cellOptions = that.renderFormEditTemplate.bind(that)(cellOptions, item, options.component, $container);\n      };\n    },\n    getEditFormTemplate: function () {\n      var that = this;\n      return function ($container, detailOptions, renderFormOnly) {\n        var editFormOptions = that.option(\"editing.form\");\n        var items = that.option(\"editing.form.items\");\n        var userCustomizeItem = that.option(\"editing.form.customizeItem\");\n\n        var editData = that._editData[(0, _uiGrid_core3.getIndexByKey)(detailOptions.key, that._editData)];\n\n        var editFormItemClass = that.addWidgetPrefix(EDIT_FORM_ITEM_CLASS);\n        var isCustomEditorType = {};\n\n        if (!items) {\n          var columns = that.getController(\"columns\").getColumns();\n          items = [];\n          (0, _iterator.each)(columns, function (_, column) {\n            if (!column.isBand && !column.type) {\n              items.push({\n                column: column,\n                name: column.name,\n                dataField: column.dataField\n              });\n            }\n          });\n        } else {\n          forEachFormItems(items, function (item) {\n            var itemId = (null === item || void 0 === item ? void 0 : item.name) || (null === item || void 0 === item ? void 0 : item.dataField);\n\n            if (itemId) {\n              isCustomEditorType[itemId] = !!item.editorType;\n            }\n          });\n        }\n\n        that._firstFormItem = void 0;\n        that._editForm = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($container), _form2.default, (0, _extend.extend)({}, editFormOptions, {\n          items: items,\n          formID: \"dx-\" + new _guid2.default(),\n          validationGroup: editData,\n          customizeItem: function (item) {\n            var column;\n            var itemId = item.name || item.dataField;\n\n            if (item.column || itemId) {\n              column = item.column || that._columnsController.columnOption(item.name ? \"name:\" + item.name : \"dataField:\" + item.dataField);\n            }\n\n            if (column) {\n              item.label = item.label || {};\n              item.label.text = item.label.text || column.caption;\n              item.template = item.template || that.getFormEditorTemplate(detailOptions, item);\n              item.column = column;\n              item.isCustomEditorType = isCustomEditorType[itemId];\n\n              if (column.formItem) {\n                (0, _extend.extend)(item, column.formItem);\n              }\n\n              if (void 0 === item.isRequired && column.validationRules) {\n                item.isRequired = column.validationRules.some(function (rule) {\n                  return \"required\" === rule.type;\n                });\n                item.validationRules = [];\n              }\n\n              var itemVisible = _type2.default.isDefined(item.visible) ? item.visible : true;\n\n              if (!that._firstFormItem && itemVisible) {\n                that._firstFormItem = item;\n              }\n            }\n\n            userCustomizeItem && userCustomizeItem.call(this, item);\n            item.cssClass = _type2.default.isString(item.cssClass) ? item.cssClass + \" \" + editFormItemClass : editFormItemClass;\n          }\n        }));\n\n        if (!renderFormOnly) {\n          var $buttonsContainer = (0, _renderer2.default)(\"<div>\").addClass(that.addWidgetPrefix(FORM_BUTTONS_CONTAINER_CLASS)).appendTo($container);\n\n          that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($buttonsContainer), _button2.default, that._getSaveButtonConfig());\n\n          that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($buttonsContainer), _button2.default, that._getCancelButtonConfig());\n        }\n\n        that._editForm.on(\"contentReady\", function () {\n          that._editPopup && that._editPopup.repaint();\n        });\n      };\n    },\n    getColumnTemplate: function (options) {\n      var that = this;\n      var column = options.column;\n      var rowIndex = options.row && options.row.rowIndex;\n      var template;\n\n      var isRowMode = _isRowEditMode(that);\n\n      var isRowEditing = that.isEditRow(rowIndex);\n      var isCellEditing = that.isEditCell(rowIndex, options.columnIndex);\n      var editingStartOptions;\n\n      if ((column.showEditorAlways || column.setCellValue && (isRowEditing && column.allowEditing || isCellEditing)) && (\"data\" === options.rowType || \"detailAdaptive\" === options.rowType) && !column.command) {\n        var allowUpdating = that.allowUpdating(options);\n\n        if (((allowUpdating || isRowEditing) && column.allowEditing || isCellEditing) && (isRowMode && isRowEditing || !isRowMode)) {\n          if (column.showEditorAlways && !isRowMode) {\n            editingStartOptions = {\n              cancel: false,\n              key: options.row.isNewRow ? void 0 : options.row.key,\n              data: options.row.data,\n              column: column\n            };\n\n            that._isEditingStart(editingStartOptions);\n          }\n\n          if (!editingStartOptions || !editingStartOptions.cancel) {\n            options.setValue = function (value, text) {\n              that.updateFieldValue(options, value, text);\n            };\n          }\n        }\n\n        template = column.editCellTemplate || getDefaultEditorTemplate(that);\n      } else {\n        if (\"detail\" === column.command && \"detail\" === options.rowType && isRowEditing) {\n          template = that.getEditFormTemplate(options);\n        }\n      }\n\n      return template;\n    },\n    _createButton: function ($container, button, options) {\n      var that = this;\n      var icon = EDIT_ICON_CLASS[button.name];\n      var useIcons = that.option(\"editing.useIcons\");\n      var $button = (0, _renderer2.default)(\"<a>\").attr(\"href\", \"#\").addClass(LINK_CLASS).addClass(button.cssClass);\n\n      if (button.template) {\n        that._rowsView.renderTemplate($container, button.template, options, true);\n      } else {\n        if (useIcons && icon || button.icon) {\n          icon = button.icon || icon;\n\n          var iconType = _icon2.default.getImageSourceType(icon);\n\n          if (\"image\" === iconType || \"svg\" === iconType) {\n            $button = _icon2.default.getImageContainer(icon).addClass(button.cssClass);\n          } else {\n            $button.addClass(\"dx-icon\" + (\"dxIcon\" === iconType ? \"-\" : \" \") + icon).attr(\"title\", button.text);\n          }\n\n          $button.addClass(\"dx-link-icon\");\n          $container.addClass(COMMAND_EDIT_WITH_ICONS_CLASS);\n          var localizationName = this.getButtonLocalizationNames()[button.name];\n          localizationName && $button.attr(\"aria-label\", _message2.default.format(localizationName));\n        } else {\n          $button.text(button.text);\n        }\n\n        if (_type2.default.isDefined(button.hint)) {\n          $button.attr(\"title\", button.hint);\n        }\n\n        _events_engine2.default.on($button, (0, _utils.addNamespace)(\"click\", EDITING_NAMESPACE), that.createAction(function (e) {\n          button.onClick.call(button, (0, _extend.extend)({}, e, {\n            row: options.row,\n            column: options.column\n          }));\n          e.event.preventDefault();\n          e.event.stopPropagation();\n        }));\n\n        options.rtlEnabled ? $container.prepend($button, \"&nbsp;\") : $container.append($button, \"&nbsp;\");\n      }\n    },\n    getButtonLocalizationNames: function () {\n      return {\n        edit: \"dxDataGrid-editingEditRow\",\n        save: \"dxDataGrid-editingSaveRowChanges\",\n        \"delete\": \"dxDataGrid-editingDeleteRow\",\n        undelete: \"dxDataGrid-editingUndeleteRow\",\n        cancel: \"dxDataGrid-editingCancelRowChanges\"\n      };\n    },\n    prepareEditButtons: function (headerPanel) {\n      var that = this;\n      var editingOptions = that.option(\"editing\") || {};\n      var editingTexts = that.option(\"editing.texts\") || {};\n      var titleButtonTextByClassNames = {\n        revert: editingTexts.cancelAllChanges,\n        save: editingTexts.saveAllChanges,\n        addRow: editingTexts.addRow\n      };\n      var classNameButtonByNames = {\n        revert: \"cancel\",\n        save: \"save\",\n        addRow: \"addrow\"\n      };\n      var buttonItems = [];\n\n      var prepareButtonItem = function (name, methodName, sortIndex) {\n        var className = classNameButtonByNames[name];\n\n        var onInitialized = function (e) {\n          (0, _renderer2.default)(e.element).addClass(headerPanel._getToolbarButtonClass(EDIT_BUTTON_CLASS + \" \" + that.addWidgetPrefix(className) + \"-button\"));\n        };\n\n        var hintText = titleButtonTextByClassNames[name];\n        var isButtonDisabled = (\"save\" === className || \"cancel\" === className) && !that.hasChanges();\n        return {\n          widget: \"dxButton\",\n          options: {\n            onInitialized: onInitialized,\n            icon: \"edit-button-\" + className,\n            disabled: isButtonDisabled,\n            onClick: function () {\n              setTimeout(function () {\n                that[methodName]();\n              });\n            },\n            text: hintText,\n            hint: hintText\n          },\n          showText: \"inMenu\",\n          name: name + \"Button\",\n          location: \"after\",\n          locateInMenu: \"auto\",\n          sortIndex: sortIndex\n        };\n      };\n\n      if (editingOptions.allowAdding) {\n        buttonItems.push(prepareButtonItem(\"addRow\", \"addRow\", 20));\n      }\n\n      if ((editingOptions.allowUpdating || editingOptions.allowAdding || editingOptions.allowDeleting) && _getEditMode(that) === EDIT_MODE_BATCH) {\n        buttonItems.push(prepareButtonItem(\"save\", \"saveEditData\", 21));\n        buttonItems.push(prepareButtonItem(\"revert\", \"cancelEditData\", 22));\n      }\n\n      return buttonItems;\n    },\n    showHighlighting: function ($cell) {\n      var $highlight = $cell.find(\".\" + CELL_HIGHLIGHT_OUTLINE);\n\n      if (\"TD\" === $cell.get(0).tagName && !$highlight.length) {\n        $cell.wrapInner((0, _renderer2.default)(\"<div>\").addClass(CELL_HIGHLIGHT_OUTLINE + \" \" + POINTER_EVENTS_TARGET_CLASS));\n      }\n    },\n    highlightDataCell: function ($cell, parameters) {\n      var isEditableCell = parameters.setValue;\n      var cellModified = this.isCellModified(parameters);\n\n      if (cellModified && parameters.column.setCellValue) {\n        this.showHighlighting($cell);\n        $cell.addClass(CELL_MODIFIED);\n      } else {\n        if (isEditableCell) {\n          this.showHighlighting($cell);\n        }\n      }\n    },\n    resetRowAndPageIndices: function () {\n      var that = this;\n      (0, _iterator.each)(that._editData, function (_, editData) {\n        if (editData.pageIndex !== that._pageIndex) {\n          delete editData.pageIndex;\n          delete editData.rowIndex;\n        }\n      });\n    },\n    _afterInsertRow: function () {},\n    _beforeSaveEditData: function (editData) {\n      if (editData && !_type2.default.isDefined(editData.key) && _type2.default.isDefined(editData.type)) {\n        return true;\n      }\n    },\n    _afterSaveEditData: function () {},\n    _beforeCancelEditData: function () {},\n    _allowEditAction: function (actionName, options) {\n      var allowEditAction = this.option(\"editing.\" + actionName);\n\n      if (_type2.default.isFunction(allowEditAction)) {\n        allowEditAction = allowEditAction({\n          component: this.component,\n          row: options.row\n        });\n      }\n\n      return allowEditAction;\n    },\n    allowUpdating: function (options, eventName) {\n      var startEditAction = this.option(\"editing.startEditAction\") || DEFAULT_START_EDIT_ACTION;\n      var needCallback = arguments.length > 1 ? startEditAction === eventName || \"down\" === eventName : true;\n      return needCallback && this._allowEditAction(\"allowUpdating\", options);\n    },\n    allowDeleting: function (options) {\n      return this._allowEditAction(\"allowDeleting\", options);\n    },\n    isCellModified: function (parameters) {\n      var columnIndex = parameters.columnIndex;\n      var modifiedValues = parameters.row && (parameters.row.isNewRow ? parameters.row.values : parameters.row.modifiedValues);\n      return !!modifiedValues && void 0 !== modifiedValues[columnIndex];\n    }\n  };\n}());\n\nmodule.exports = {\n  defaultOptions: function () {\n    return {\n      editing: {\n        mode: \"row\",\n        refreshMode: \"full\",\n        allowAdding: false,\n        allowUpdating: false,\n        allowDeleting: false,\n        useIcons: false,\n        selectTextOnEditStart: false,\n        confirmDelete: true,\n        texts: {\n          editRow: _message2.default.format(\"dxDataGrid-editingEditRow\"),\n          saveAllChanges: _message2.default.format(\"dxDataGrid-editingSaveAllChanges\"),\n          saveRowChanges: _message2.default.format(\"dxDataGrid-editingSaveRowChanges\"),\n          cancelAllChanges: _message2.default.format(\"dxDataGrid-editingCancelAllChanges\"),\n          cancelRowChanges: _message2.default.format(\"dxDataGrid-editingCancelRowChanges\"),\n          addRow: _message2.default.format(\"dxDataGrid-editingAddRow\"),\n          deleteRow: _message2.default.format(\"dxDataGrid-editingDeleteRow\"),\n          undeleteRow: _message2.default.format(\"dxDataGrid-editingUndeleteRow\"),\n          confirmDeleteMessage: _message2.default.format(\"dxDataGrid-editingConfirmDeleteMessage\"),\n          confirmDeleteTitle: \"\"\n        },\n        form: {\n          colCount: 2\n        },\n        popup: {},\n        startEditAction: \"click\"\n      }\n    };\n  },\n  controllers: {\n    editing: EditingController\n  },\n  extenders: {\n    controllers: {\n      data: {\n        init: function () {\n          this._editingController = this.getController(\"editing\");\n          this.callBase();\n        },\n        reload: function (full, repaintChangesOnly) {\n          !repaintChangesOnly && this._editingController.refresh();\n          return this.callBase.apply(this, arguments);\n        },\n        repaintRows: function () {\n          if (this.getController(\"editing\").isSaving()) {\n            return;\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _updateEditRow: function (items) {\n          var editingController = this._editingController;\n          var editRowIndex = editingController.getEditRowIndex();\n          var editItem = items[editRowIndex];\n\n          if (editItem) {\n            editItem.isEditing = true;\n\n            if (editingController.getEditMode() === EDIT_MODE_FORM) {\n              editItem.rowType = \"detail\";\n            }\n          }\n        },\n        _updateItemsCore: function (change) {\n          this.callBase(change);\n\n          this._updateEditRow(this.items());\n        },\n        _applyChangeUpdate: function (change) {\n          this._updateEditRow(change.items);\n\n          this.callBase(change);\n        },\n        _applyChangesOnly: function (change) {\n          this._updateEditRow(change.items);\n\n          this.callBase(change);\n        },\n        _processItems: function (items, change) {\n          items = this._editingController.processItems(items, change);\n          return this.callBase(items, change);\n        },\n        _processDataItem: function (dataItem, options) {\n          this._editingController.processDataItem(dataItem, options, this.generateDataValues);\n\n          return this.callBase(dataItem, options);\n        },\n        _processItem: function (item, options) {\n          item = this.callBase(item, options);\n\n          if (item.isNewRow) {\n            options.dataIndex--;\n            delete item.dataIndex;\n          }\n\n          return item;\n        },\n        _correctRowIndices: function (getRowIndexCorrection) {\n          this.callBase.apply(this, arguments);\n\n          this._editingController.correctEditRowIndex(getRowIndexCorrection);\n        },\n        _getChangedColumnIndices: function (oldItem, newItem, rowIndex, isLiveUpdate) {\n          var editingController = this.getController(\"editing\");\n          var isRowEditMode = editingController.isRowEditMode();\n\n          if (oldItem.isNewRow !== newItem.isNewRow || oldItem.removed !== newItem.removed || isRowEditMode && oldItem.isEditing !== newItem.isEditing) {\n            return;\n          }\n\n          if (oldItem.rowType === newItem.rowType && isRowEditMode && editingController.isEditRow(rowIndex) && isLiveUpdate) {\n            return [];\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _isCellChanged: function (oldRow, newRow, visibleRowIndex, columnIndex, isLiveUpdate) {\n          var editingController = this.getController(\"editing\");\n          var cell = oldRow.cells && oldRow.cells[columnIndex];\n          var isEditing = editingController && editingController.isEditCell(visibleRowIndex, columnIndex);\n\n          if (isLiveUpdate && isEditing) {\n            return false;\n          }\n\n          if (cell && cell.column && !cell.column.showEditorAlways && cell.isEditing !== isEditing) {\n            return true;\n          }\n\n          return this.callBase.apply(this, arguments);\n        }\n      }\n    },\n    views: {\n      rowsView: {\n        init: function () {\n          this.callBase();\n          this._editingController = this.getController(\"editing\");\n        },\n        getCellElements: function (rowIndex) {\n          var $cellElements = this.callBase(rowIndex);\n          var editingController = this._editingController;\n          var editForm = editingController.getEditForm();\n          var editFormRowIndex = editingController.getEditFormRowIndex();\n\n          if (editFormRowIndex === rowIndex && $cellElements && editForm) {\n            return editForm.$element().find(\".\" + this.addWidgetPrefix(EDIT_FORM_ITEM_CLASS) + \", .\" + BUTTON_CLASS);\n          }\n\n          return $cellElements;\n        },\n        getCellIndex: function ($cell, rowIndex) {\n          if (!$cell.is(\"td\") && rowIndex >= 0) {\n            var $cellElements = this.getCellElements(rowIndex);\n            var cellIndex = -1;\n            (0, _iterator.each)($cellElements, function (index, cellElement) {\n              if ((0, _renderer2.default)(cellElement).find($cell).length) {\n                cellIndex = index;\n              }\n            });\n            return cellIndex;\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _getVisibleColumnIndex: function ($cells, rowIndex, columnIdentifier) {\n          var editFormRowIndex = this._editingController.getEditFormRowIndex();\n\n          if (editFormRowIndex === rowIndex && _type2.default.isString(columnIdentifier)) {\n            var column = this._columnsController.columnOption(columnIdentifier);\n\n            return this._getEditFormEditorVisibleIndex($cells, column);\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _getEditFormEditorVisibleIndex: function ($cells, column) {\n          var visibleIndex = -1;\n          (0, _iterator.each)($cells, function (index, cellElement) {\n            var item = (0, _renderer2.default)(cellElement).find(\".dx-field-item-content\").data(\"dx-form-item\");\n\n            if (item && item.column && column && item.column.index === column.index) {\n              visibleIndex = index;\n              return false;\n            }\n          });\n          return visibleIndex;\n        },\n        publicMethods: function () {\n          return this.callBase().concat([\"cellValue\"]);\n        },\n        _getCellTemplate: function (options) {\n          var that = this;\n\n          var template = that._editingController.getColumnTemplate(options);\n\n          return template || that.callBase(options);\n        },\n        _isNativeClick: function () {\n          return (_devices2.default.real().ios || _devices2.default.real().android) && this.option(\"editing.allowUpdating\");\n        },\n        _createTable: function () {\n          var that = this;\n          var $table = that.callBase.apply(that, arguments);\n\n          if (!_isRowEditMode(that) && that.option(\"editing.allowUpdating\")) {\n            _events_engine2.default.on($table, (0, _utils.addNamespace)(_hold2.default.name, \"dxDataGridRowsView\"), \"td:not(.\" + EDITOR_CELL_CLASS + \")\", that.createAction(function () {\n              var editingController = that._editingController;\n\n              if (editingController.isEditing()) {\n                editingController.closeEditCell();\n              }\n            }));\n          }\n\n          return $table;\n        },\n        _createRow: function (row) {\n          var $row = this.callBase(row);\n\n          if (row) {\n            var editingController = this._editingController;\n            var isEditRow = editingController.isEditRow(row.rowIndex);\n            var isRowRemoved = !!row.removed;\n            var isRowInserted = !!row.isNewRow;\n            var isRowModified = !!row.modified;\n\n            if (_getEditMode(this) === EDIT_MODE_BATCH) {\n              isRowRemoved && $row.addClass(ROW_REMOVED);\n            } else {\n              isEditRow && $row.addClass(EDIT_ROW);\n            }\n\n            isRowInserted && $row.addClass(ROW_INSERTED);\n            isRowModified && $row.addClass(ROW_MODIFIED);\n\n            if (isEditRow || isRowInserted || isRowRemoved) {\n              $row.removeClass(ROW_SELECTED);\n            }\n\n            if (isEditRow && \"detail\" === row.rowType) {\n              $row.addClass(this.addWidgetPrefix(EDIT_FORM_CLASS));\n            }\n          }\n\n          return $row;\n        },\n        _getColumnIndexByElement: function ($element) {\n          var $tableElement = $element.closest(\"table\");\n          var $tableElements = this.getTableElements();\n\n          while ($tableElement.length && !$tableElements.filter($tableElement).length) {\n            $element = $tableElement.closest(\"td\");\n            $tableElement = $element.closest(\"table\");\n          }\n\n          return this._getColumnIndexByElementCore($element);\n        },\n        _getColumnIndexByElementCore: function ($element) {\n          var $targetElement = $element.closest(\".\" + ROW_CLASS + \"> td:not(.dx-master-detail-cell)\");\n          return this.getCellIndex($targetElement);\n        },\n        _editCellByClick: function (e, eventName) {\n          var that = this;\n          var editingController = that._editingController;\n          var $targetElement = (0, _renderer2.default)(e.event.target);\n\n          var columnIndex = that._getColumnIndexByElement($targetElement);\n\n          var row = that._dataController.items()[e.rowIndex];\n\n          var allowUpdating = editingController.allowUpdating({\n            row: row\n          }, eventName) || row && row.isNewRow;\n\n          var column = that._columnsController.getVisibleColumns()[columnIndex];\n\n          var allowEditing = allowUpdating && column && (column.allowEditing || editingController.isEditCell(e.rowIndex, columnIndex));\n          var startEditAction = that.option(\"editing.startEditAction\") || \"click\";\n\n          if (\"down\" === eventName) {\n            return column && column.showEditorAlways && allowEditing && editingController.editCell(e.rowIndex, columnIndex);\n          }\n\n          if (\"click\" === eventName && \"dblClick\" === startEditAction && !editingController.isEditCell(e.rowIndex, columnIndex)) {\n            editingController.closeEditCell();\n          }\n\n          if (allowEditing && eventName === startEditAction) {\n            return editingController.editCell(e.rowIndex, columnIndex) || editingController.isEditRow(e.rowIndex);\n          }\n        },\n        _rowPointerDown: function (e) {\n          var _this14 = this;\n\n          this._pointerDownTimeout = setTimeout(function () {\n            _this14._editCellByClick(e, \"down\");\n          });\n        },\n        _rowClick: function (e) {\n          var isEditForm = (0, _renderer2.default)(e.rowElement).hasClass(this.addWidgetPrefix(EDIT_FORM_CLASS));\n          e.event[TARGET_COMPONENT_NAME] = this.component;\n\n          if (!this._editCellByClick(e, \"click\") && !isEditForm) {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        _rowDblClick: function (e) {\n          if (!this._editCellByClick(e, \"dblClick\")) {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        _cellPrepared: function ($cell, parameters) {\n          var editingController = this._editingController;\n          var isCommandCell = !!parameters.column.command;\n          var isEditableCell = parameters.setValue;\n          var isEditing = parameters.isEditing || editingController.isEditRow(parameters.rowIndex) && parameters.column.allowEditing;\n\n          if (\"data\" === parameters.rowType && !parameters.column.command && (isEditing || parameters.column.showEditorAlways)) {\n            var alignment = parameters.column.alignment;\n            $cell.addClass(EDITOR_CELL_CLASS).toggleClass(this.addWidgetPrefix(READONLY_CLASS), !isEditableCell).toggleClass(CELL_FOCUS_DISABLED_CLASS, !isEditableCell);\n\n            if (alignment) {\n              $cell.find(EDITORS_INPUT_SELECTOR).first().css(\"textAlign\", alignment);\n            }\n          }\n\n          if (isEditing) {\n            this._editCellPrepared($cell);\n          }\n\n          if (parameters.column && !isCommandCell) {\n            editingController.highlightDataCell($cell, parameters);\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        _editCellPrepared: function ($cell) {},\n        _formItemPrepared: function () {},\n        _isFormItem: function (parameters) {\n          var isDetailRow = \"detail\" === parameters.rowType || \"detailAdaptive\" === parameters.rowType;\n\n          var isPopupEditing = \"data\" === parameters.rowType && \"popup\" === _getEditMode(this);\n\n          return (isDetailRow || isPopupEditing) && parameters.item;\n        },\n        _updateCell: function ($cell, parameters) {\n          if (this._isFormItem(parameters)) {\n            this._formItemPrepared(parameters, $cell);\n          } else {\n            this.callBase($cell, parameters);\n          }\n        },\n        _update: function (change) {\n          this.callBase(change);\n\n          if (\"updateSelection\" === change.changeType) {\n            this.getTableElements().children(\"tbody\").children(\".\" + EDIT_ROW).removeClass(ROW_SELECTED);\n          }\n        },\n        _getCellOptions: function (options) {\n          var cellOptions = this.callBase(options);\n          cellOptions.isEditing = this._editingController.isEditCell(cellOptions.rowIndex, cellOptions.columnIndex);\n          return cellOptions;\n        },\n        _renderCellContent: function ($cell, options) {\n          if (\"data\" === options.rowType && _getEditMode(this) === EDIT_MODE_POPUP && false === options.row.visible) {\n            return;\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        cellValue: function (rowIndex, columnIdentifier, value, text) {\n          var cellOptions = this.getCellOptions(rowIndex, columnIdentifier);\n\n          if (cellOptions) {\n            if (void 0 === value) {\n              return cellOptions.value;\n            } else {\n              this._editingController.updateFieldValue(cellOptions, value, text, true);\n            }\n          }\n        },\n        dispose: function () {\n          this.callBase.apply(this, arguments);\n          clearTimeout(this._pointerDownTimeout);\n        }\n      },\n      headerPanel: {\n        _getToolbarItems: function () {\n          var items = this.callBase();\n          var editButtonItems = this.getController(\"editing\").prepareEditButtons(this);\n          return editButtonItems.concat(items);\n        },\n        optionChanged: function (args) {\n          var fullName = args.fullName;\n\n          switch (args.name) {\n            case \"editing\":\n              var isEditingPopupOption = fullName && 0 === fullName.indexOf(EDITING_POPUP_OPTION_NAME);\n\n              if (!isEditingPopupOption) {\n                this._invalidate();\n              }\n\n              this.callBase(args);\n              break;\n\n            default:\n              this.callBase(args);\n          }\n        },\n        isVisible: function () {\n          var that = this;\n          var editingOptions = that.getController(\"editing\").option(\"editing\");\n          return that.callBase() || editingOptions && (editingOptions.allowAdding || (editingOptions.allowUpdating || editingOptions.allowDeleting) && editingOptions.mode === EDIT_MODE_BATCH);\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["/Users/tracyvy/Desktop/calendar/client/node_modules/devextreme/ui/grid_core/ui.grid_core.editing.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_dom_adapter","_dom_adapter2","_window","_events_engine","_events_engine2","_guid","_guid2","_type","_type2","_iterator","_extend","_uiGrid_core","_uiGrid_core2","_click","_click2","_double_click","_double_click2","_pointer","_pointer2","_uiGrid_core3","_utils","_dialog","_dialog2","_message","_message2","_button","_button2","_popup","_popup2","_ui","_ui2","_devices","_devices2","_form","_form2","_hold","_hold2","_deferred","_deferred2","_common","_common2","_icon","_icon2","_ui3","_ui4","obj","__esModule","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","o","minLen","_arrayLikeToArray","n","Object","prototype","toString","call","slice","constructor","name","Array","from","test","iter","Symbol","iterator","isArray","len","length","i","arr2","EDIT_FORM_CLASS","EDIT_FORM_ITEM_CLASS","FOCUS_OVERLAY_CLASS","READONLY_CLASS","EDIT_POPUP_CLASS","FORM_BUTTONS_CONTAINER_CLASS","ADD_ROW_BUTTON_CLASS","DROPDOWN_EDITOR_OVERLAY_CLASS","LINK_CLASS","EDITOR_CELL_CLASS","ROW_SELECTED","EDIT_ROW","EDIT_BUTTON_CLASS","COMMAND_EDIT_CLASS","COMMAND_EDIT_WITH_ICONS_CLASS","SCROLLABLE_CONTAINER_CLASS","BUTTON_CLASS","INSERT_INDEX","ROW_CLASS","ROW_REMOVED","ROW_INSERTED","ROW_MODIFIED","CELL_MODIFIED","CELL_HIGHLIGHT_OUTLINE","EDITING_NAMESPACE","DATA_ROW_CLASS","CELL_FOCUS_DISABLED_CLASS","EDITORS_INPUT_SELECTOR","FOCUSABLE_ELEMENT_SELECTOR","EDIT_MODE_BATCH","EDIT_MODE_ROW","EDIT_MODE_CELL","EDIT_MODE_FORM","EDIT_MODE_POPUP","DATA_EDIT_DATA_INSERT_TYPE","DATA_EDIT_DATA_UPDATE_TYPE","DATA_EDIT_DATA_REMOVE_TYPE","POINTER_EVENTS_TARGET_CLASS","DEFAULT_START_EDIT_ACTION","EDIT_MODES","ROW_BASED_MODES","CELL_BASED_MODES","FORM_BASED_MODES","MODES_WITH_DELAYED_FOCUS","TARGET_COMPONENT_NAME","EDIT_LINK_CLASS","save","cancel","edit","undelete","add","EDIT_ICON_CLASS","METHOD_NAMES","ACTION_OPTION_NAMES","BUTTON_NAMES","EDITING_POPUP_OPTION_NAME","createFailureHandler","deferred","arg","error","Error","String","reject","_getEditMode","that","editMode","option","indexOf","_isRowEditMode","EditingController","default","ViewController","inherit","getDefaultEditorTemplate","container","options","$editor","appendTo","getController","createEditor","extend","column","value","setValue","row","parentType","width","readOnly","isOnForm","id","getEditingTexts","editingTexts","component","saveRowChanges","cancelRowChanges","editRow","undeleteRow","deleteRow","addRowToNode","getButtonIndex","buttons","result","some","button","index","getButtonName","isObject","getEditorType","item","isCustomEditorType","editorType","formItem","forEachFormItems","items","callBack","forEach","tabs","init","_editRowIndex","_editData","_editColumnIndex","_columnsController","_dataController","_rowsView","getView","_editForm","_updateEditFormDeferred","_lastOperation","_deferreds","d","_dataChangedHandler","_handleDataChanged","bind","changed","_saveEditorHandler","createAction","excludeValidators","$pointerDownTarget","_pointerDownEditorHandler","e","target","event","$target","targetComponent","is","checkEditorPopup","$element","closest","concat","_editCellInProgress","isEditorPopup","isDomElement","getWindow","document","isAnotherComponent","_disposed","isAddRowButton","addWidgetPrefix","isFocusOverlay","hasClass","isCellEditMode","isEditing","_closeEditItem","on","getDocument","down","_updateEditColumn","_updateEditButtons","getUpdatedData","data","key","keyOf","editData","editIndex","getIndexByKey","createObjectWithChanges","getInsertedData","filter","type","map","getRemovedData","oldData","_fireDataErrorOccurred","$popupContent","getPopupContent","dataErrorOccurred","fire","_needToCloseEditableCell","$targetElement","isCurrentComponentElement","isDataRow","rowsView","$targetCell","rowIndex","getRowIndex","parent","columnIndex","getCellElements","visibleColumns","getVisibleColumns","allowEditing","isEditCell","closeEditCell","args","editForm","resetRowAndPageIndices","changeType","each","_","_repaintEditPopup","_isDefaultButtonVisible","isRowMode","isEditRow","_getVisibleEditRowIndex","allowUpdating","allowDeleting","removed","_isButtonVisible","visible","isDefined","isFunction","_getButtonConfig","_this","config","buttonName","methodName","editingOptions","actionName","allowAction","text","cssClass","onClick","stopPropagation","preventDefault","setTimeout","_getEditingButtons","_this2","buttonIndex","haveCustomButtons","splice","_renderEditingButtons","$container","_this3","_createButton","_getEditCommandCellTemplate","_this4","rowType","rtlEnabled","watch","empty","setEmptyText","correctEditRowIndexAfterExpand","getRowIndexByKey","correctEditRowIndex","getRowIndexCorrection","isRowEditMode","isFormEditMode","isCellOrBatchEditMode","getEditMode","getFirstEditableColumnIndex","columnsController","firstFormItem","_firstFormItem","$editFormElements","_getEditFormEditorVisibleIndex","getFirstEditableCellInRow","_getCellElement","getFocusedCellInRow","hasChanges","dispose","callBase","clearTimeout","_inputFocusTimeoutID","off","optionChanged","fullName","editPopup","_editPopup","popupOptionName","handled","publicMethods","refresh","isPageChanged","needResetIndexes","getEditRowKey","getEditRowIndex","getEditFormRowIndex","visibleRowIndex","hasEditData","popupVisible","_$popupContent","getEditForm","_needInsertItem","dataSource","scrollingMode","pageIndex","beginPageIndex","endPageIndex","dataRowIndex","_generateNewItem","processItems","change","dataController","update","rowIndexOffset","getRowIndexOffset","getRowIndexDelta","removeCount","processDataItem","generateDataValues","columns","isNewRow","modified","modifiedValues","insertRow","log","addRow","_initNewRow","_this5","executeAction","promise","Deferred","when","fromPromise","done","resolve","fail","_getInsertKey","parentKey","rows","insertKey","_getInsertRowIndex","_getInsertIndex","parentRowIndex","getTopVisibleItemIndex","maxInsertIndex","editItem","store","param","oldEditRowIndex","fireError","NAME","saveEditData","_allowRowAdding","__KEY__","_addRowCore","insertIndex","initialOldEditRowIndex","_addEditData","updateItems","rowIndices","_showEditPopup","_focusFirstEditableCellInRow","_afterInsertRow","$firstCell","_delayedInputFocus","$cell","eventToTrigger","trigger","_isEditingStart","_beforeEditCell","always","_beforeUpdateItems","params","$editingCell","_pageIndex","focus","repaintForm","isMobileDevice","current","deviceType","popupOptions","showTitle","fullScreen","toolbarItems","toolbar","location","widget","_getSaveButtonConfig","_getCancelButtonConfig","contentTemplate","_getPopupEditFormTemplate","$popupContainer","addClass","_createComponent","_getEditPopupHiddenHandler","$content","find","not","first","repaint","show","defaultAnimation","cancelEditData","getVisibleRows","templateOptions","formTemplate","getEditFormTemplate","scrollable","_removeEditDataItem","executeOperation","func","_this6","waitForDeferredOperations","state","apply","editCell","_this7","coreResult","_editCellCore","oldColumn","isString","columnOption","getVisibleIndex","editRowIndex","_prepareEditCell","deferRender","_repaintEditCell","_processCanceledEditingCell","editColumnIndex","showEditorAlways","loseFocus","_focusEditingCell","beforeFocusCallback","callBeforeFocusCallbackAlways","inputFocus","$focusableElement","focusAndSelectElement","_beforeFocusCallback","real","ios","android","$editCell","removeRow","_this8","_checkAndDeleteRow","texts","isBatchMode","mode","confirmDelete","confirmDeleteMessage","_deleteRowCore","confirmDeleteTitle","showDialogTitle","confirm","confirmResult","isEmptyObject","_saveEditDataCore","deferreds","results","changes","isDataSaved","executeEditingAction","_beforeSaveEditData","remove","push","insert","newData","doneDeferred","_processSaveEditDataResult","hasSavedData","isError","_fireSaveEditDataEvents","itemData","_this9","afterSaveEditData","_afterSaveEditData","_saving","_saveEditDataInner","_this10","resetEditIndices","beginLoading","hide","endLoading","refreshMode","isFullRefresh","selection","reload","load","changesOnly","isSaving","isEditColumnVisible","_isEditColumnVisible","useIcons","addCommandColumn","command","alignment","cellTemplate","fixedPosition","isVisibleWithCurrentEditMode","allowAdding","headerPanel","setToolbarItemDisabled","_applyModified","_beforeCloseEditCellInBatchMode","_beforeCancelEditData","repaintChangesOnly","_hideEditPopup","withoutSaveEditData","_this11","_closeEditCellCore","_getRowIndicesForCascadeUpdating","skipCurrentRow","addDeferred","_this12","_prepareEditDataParams","_options$row","rowKey","$cellElement","cellElement","setCellValueResult","setCellValue","displayValueMap","values","updateFieldValue","forceUpdateRow","_this13","_applyEditDataParams","_focusPreviousEditingCellIfNeed","_updateEditRow","_needUpdateRow","isCustomSetCellValue","defaultSetCellValue","isCustomCalculateCellValue","visibleColumn","calculateCellValue","defaultCalculateCellValue","isUpdateInCellMode","focusPreviousEditingCell","_updateEditRowCore","_updateLockCount","validate","_endUpdateCore","$focusedElement","getActiveElement","getCellIndex","focusedElement","get","selectionRange","getSelectionRange","$focusedItem","selectionStart","setSelectionRange","editDataIndex","_getFormEditItemTemplate","cellOptions","editCellTemplate","renderFormEditTemplate","detailCellOptions","form","isReadOnly","rowData","editorOptions","getItemID","dataField","template","renderTemplate","_updateCell","getFormEditorTemplate","selector","_validator","$editorElement","validator","validatorOptions","contents","dxValidator","validationRules","validationGroup","dataGetter","detailOptions","renderFormOnly","editFormOptions","userCustomizeItem","editFormItemClass","getColumns","isBand","itemId","formID","customizeItem","label","caption","isRequired","rule","itemVisible","$buttonsContainer","getColumnTemplate","isRowEditing","isCellEditing","editingStartOptions","icon","$button","attr","iconType","getImageSourceType","getImageContainer","localizationName","getButtonLocalizationNames","format","hint","addNamespace","prepend","append","prepareEditButtons","titleButtonTextByClassNames","revert","cancelAllChanges","saveAllChanges","classNameButtonByNames","buttonItems","prepareButtonItem","sortIndex","className","onInitialized","element","_getToolbarButtonClass","hintText","isButtonDisabled","disabled","showText","locateInMenu","showHighlighting","$highlight","tagName","wrapInner","highlightDataCell","parameters","isEditableCell","cellModified","isCellModified","_allowEditAction","allowEditAction","eventName","startEditAction","needCallback","arguments","module","exports","defaultOptions","editing","selectTextOnEditStart","colCount","popup","controllers","extenders","_editingController","full","repaintRows","editingController","_updateItemsCore","_applyChangeUpdate","_applyChangesOnly","_processItems","_processDataItem","dataItem","_processItem","dataIndex","_correctRowIndices","_getChangedColumnIndices","oldItem","newItem","isLiveUpdate","_isCellChanged","oldRow","newRow","cell","cells","views","$cellElements","editFormRowIndex","cellIndex","_getVisibleColumnIndex","$cells","columnIdentifier","visibleIndex","_getCellTemplate","_isNativeClick","_createTable","$table","_createRow","$row","isRowRemoved","isRowInserted","isRowModified","removeClass","_getColumnIndexByElement","$tableElement","$tableElements","getTableElements","_getColumnIndexByElementCore","_editCellByClick","_rowPointerDown","_this14","_pointerDownTimeout","_rowClick","isEditForm","rowElement","_rowDblClick","_cellPrepared","isCommandCell","toggleClass","css","_editCellPrepared","_formItemPrepared","_isFormItem","isDetailRow","isPopupEditing","_update","children","_getCellOptions","_renderCellContent","cellValue","getCellOptions","_getToolbarItems","editButtonItems","isEditingPopupOption","_invalidate","isVisible"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.editing.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _dom_adapter = require(\"../../core/dom_adapter\");\r\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\r\nvar _window = require(\"../../core/utils/window\");\r\nvar _events_engine = require(\"../../events/core/events_engine\");\r\nvar _events_engine2 = _interopRequireDefault(_events_engine);\r\nvar _guid = require(\"../../core/guid\");\r\nvar _guid2 = _interopRequireDefault(_guid);\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _type2 = _interopRequireDefault(_type);\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\r\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\r\nvar _click = require(\"../../events/click\");\r\nvar _click2 = _interopRequireDefault(_click);\r\nvar _double_click = require(\"../../events/double_click\");\r\nvar _double_click2 = _interopRequireDefault(_double_click);\r\nvar _pointer = require(\"../../events/pointer\");\r\nvar _pointer2 = _interopRequireDefault(_pointer);\r\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\r\nvar _utils = require(\"../../events/utils\");\r\nvar _dialog = require(\"../dialog\");\r\nvar _dialog2 = _interopRequireDefault(_dialog);\r\nvar _message = require(\"../../localization/message\");\r\nvar _message2 = _interopRequireDefault(_message);\r\nvar _button = require(\"../button\");\r\nvar _button2 = _interopRequireDefault(_button);\r\nvar _popup = require(\"../popup\");\r\nvar _popup2 = _interopRequireDefault(_popup);\r\nvar _ui = require(\"../widget/ui.errors\");\r\nvar _ui2 = _interopRequireDefault(_ui);\r\nvar _devices = require(\"../../core/devices\");\r\nvar _devices2 = _interopRequireDefault(_devices);\r\nvar _form = require(\"../form\");\r\nvar _form2 = _interopRequireDefault(_form);\r\nvar _hold = require(\"../../events/hold\");\r\nvar _hold2 = _interopRequireDefault(_hold);\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _deferred2 = _interopRequireDefault(_deferred);\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _common2 = _interopRequireDefault(_common);\r\nvar _icon = require(\"../../core/utils/icon\");\r\nvar _icon2 = _interopRequireDefault(_icon);\r\nvar _ui3 = require(\"../scroll_view/ui.scrollable\");\r\nvar _ui4 = _interopRequireDefault(_ui3);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _toConsumableArray(arr) {\r\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread()\r\n}\r\n\r\nfunction _nonIterableSpread() {\r\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")\r\n}\r\n\r\nfunction _unsupportedIterableToArray(o, minLen) {\r\n    if (!o) {\r\n        return\r\n    }\r\n    if (\"string\" === typeof o) {\r\n        return _arrayLikeToArray(o, minLen)\r\n    }\r\n    var n = Object.prototype.toString.call(o).slice(8, -1);\r\n    if (\"Object\" === n && o.constructor) {\r\n        n = o.constructor.name\r\n    }\r\n    if (\"Map\" === n || \"Set\" === n) {\r\n        return Array.from(o)\r\n    }\r\n    if (\"Arguments\" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) {\r\n        return _arrayLikeToArray(o, minLen)\r\n    }\r\n}\r\n\r\nfunction _iterableToArray(iter) {\r\n    if (\"undefined\" !== typeof Symbol && Symbol.iterator in Object(iter)) {\r\n        return Array.from(iter)\r\n    }\r\n}\r\n\r\nfunction _arrayWithoutHoles(arr) {\r\n    if (Array.isArray(arr)) {\r\n        return _arrayLikeToArray(arr)\r\n    }\r\n}\r\n\r\nfunction _arrayLikeToArray(arr, len) {\r\n    if (null == len || len > arr.length) {\r\n        len = arr.length\r\n    }\r\n    for (var i = 0, arr2 = new Array(len); i < len; i++) {\r\n        arr2[i] = arr[i]\r\n    }\r\n    return arr2\r\n}\r\nvar EDIT_FORM_CLASS = \"edit-form\";\r\nvar EDIT_FORM_ITEM_CLASS = \"edit-form-item\";\r\nvar FOCUS_OVERLAY_CLASS = \"focus-overlay\";\r\nvar READONLY_CLASS = \"readonly\";\r\nvar EDIT_POPUP_CLASS = \"edit-popup\";\r\nvar FORM_BUTTONS_CONTAINER_CLASS = \"form-buttons-container\";\r\nvar ADD_ROW_BUTTON_CLASS = \"addrow-button\";\r\nvar DROPDOWN_EDITOR_OVERLAY_CLASS = \"dx-dropdowneditor-overlay\";\r\nvar LINK_CLASS = \"dx-link\";\r\nvar EDITOR_CELL_CLASS = \"dx-editor-cell\";\r\nvar ROW_SELECTED = \"dx-selection\";\r\nvar EDIT_ROW = \"dx-edit-row\";\r\nvar EDIT_BUTTON_CLASS = \"dx-edit-button\";\r\nvar COMMAND_EDIT_CLASS = \"dx-command-edit\";\r\nvar COMMAND_EDIT_WITH_ICONS_CLASS = COMMAND_EDIT_CLASS + \"-with-icons\";\r\nvar SCROLLABLE_CONTAINER_CLASS = \"dx-scrollable-container\";\r\nvar BUTTON_CLASS = \"dx-button\";\r\nvar INSERT_INDEX = \"__DX_INSERT_INDEX__\";\r\nvar ROW_CLASS = \"dx-row\";\r\nvar ROW_REMOVED = \"dx-row-removed\";\r\nvar ROW_INSERTED = \"dx-row-inserted\";\r\nvar ROW_MODIFIED = \"dx-row-modified\";\r\nvar CELL_MODIFIED = \"dx-cell-modified\";\r\nvar CELL_HIGHLIGHT_OUTLINE = \"dx-highlight-outline\";\r\nvar EDITING_NAMESPACE = \"dxDataGridEditing\";\r\nvar DATA_ROW_CLASS = \"dx-data-row\";\r\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\r\nvar EDITORS_INPUT_SELECTOR = \"input:not([type='hidden'])\";\r\nvar FOCUSABLE_ELEMENT_SELECTOR = \"[tabindex], \" + EDITORS_INPUT_SELECTOR;\r\nvar EDIT_MODE_BATCH = \"batch\";\r\nvar EDIT_MODE_ROW = \"row\";\r\nvar EDIT_MODE_CELL = \"cell\";\r\nvar EDIT_MODE_FORM = \"form\";\r\nvar EDIT_MODE_POPUP = \"popup\";\r\nvar DATA_EDIT_DATA_INSERT_TYPE = \"insert\";\r\nvar DATA_EDIT_DATA_UPDATE_TYPE = \"update\";\r\nvar DATA_EDIT_DATA_REMOVE_TYPE = \"remove\";\r\nvar POINTER_EVENTS_TARGET_CLASS = \"dx-pointer-events-target\";\r\nvar DEFAULT_START_EDIT_ACTION = \"click\";\r\nvar EDIT_MODES = [EDIT_MODE_BATCH, EDIT_MODE_ROW, EDIT_MODE_CELL, EDIT_MODE_FORM, EDIT_MODE_POPUP];\r\nvar ROW_BASED_MODES = [EDIT_MODE_ROW, EDIT_MODE_FORM, EDIT_MODE_POPUP];\r\nvar CELL_BASED_MODES = [EDIT_MODE_BATCH, EDIT_MODE_CELL];\r\nvar FORM_BASED_MODES = [EDIT_MODE_FORM, EDIT_MODE_POPUP];\r\nvar MODES_WITH_DELAYED_FOCUS = [EDIT_MODE_ROW, EDIT_MODE_FORM];\r\nvar TARGET_COMPONENT_NAME = \"targetComponent\";\r\nvar EDIT_LINK_CLASS = {\r\n    save: \"dx-link-save\",\r\n    cancel: \"dx-link-cancel\",\r\n    edit: \"dx-link-edit\",\r\n    undelete: \"dx-link-undelete\",\r\n    \"delete\": \"dx-link-delete\",\r\n    add: \"dx-link-add\"\r\n};\r\nvar EDIT_ICON_CLASS = {\r\n    save: \"save\",\r\n    cancel: \"revert\",\r\n    edit: \"edit\",\r\n    undelete: \"revert\",\r\n    \"delete\": \"trash\",\r\n    add: \"add\"\r\n};\r\nvar METHOD_NAMES = {\r\n    edit: \"editRow\",\r\n    \"delete\": \"deleteRow\",\r\n    undelete: \"undeleteRow\",\r\n    save: \"saveEditData\",\r\n    cancel: \"cancelEditData\",\r\n    add: \"addRowByRowIndex\"\r\n};\r\nvar ACTION_OPTION_NAMES = {\r\n    add: \"allowAdding\",\r\n    edit: \"allowUpdating\",\r\n    \"delete\": \"allowDeleting\"\r\n};\r\nvar BUTTON_NAMES = [\"edit\", \"save\", \"cancel\", \"delete\", \"undelete\"];\r\nvar EDITING_POPUP_OPTION_NAME = \"editing.popup\";\r\nvar createFailureHandler = function(deferred) {\r\n    return function(arg) {\r\n        var error = arg instanceof Error ? arg : new Error(arg && String(arg) || \"Unknown error\");\r\n        deferred.reject(error)\r\n    }\r\n};\r\nvar _getEditMode = function(that) {\r\n    var editMode = that.option(\"editing.mode\");\r\n    if (EDIT_MODES.indexOf(editMode) !== -1) {\r\n        return editMode\r\n    }\r\n    return EDIT_MODE_ROW\r\n};\r\nvar _isRowEditMode = function(that) {\r\n    var editMode = _getEditMode(that);\r\n    return ROW_BASED_MODES.indexOf(editMode) !== -1\r\n};\r\nvar EditingController = _uiGrid_core2.default.ViewController.inherit(function() {\r\n    var getDefaultEditorTemplate = function(that) {\r\n        return function(container, options) {\r\n            var $editor = (0, _renderer2.default)(\"<div>\").appendTo(container);\r\n            that.getController(\"editorFactory\").createEditor($editor, (0, _extend.extend)({}, options.column, {\r\n                value: options.value,\r\n                setValue: options.setValue,\r\n                row: options.row,\r\n                parentType: \"dataRow\",\r\n                width: null,\r\n                readOnly: !options.setValue,\r\n                isOnForm: options.isOnForm,\r\n                id: options.id\r\n            }))\r\n        }\r\n    };\r\n    var getEditingTexts = function(options) {\r\n        var editingTexts = options.component.option(\"editing.texts\") || {};\r\n        return {\r\n            save: editingTexts.saveRowChanges,\r\n            cancel: editingTexts.cancelRowChanges,\r\n            edit: editingTexts.editRow,\r\n            undelete: editingTexts.undeleteRow,\r\n            \"delete\": editingTexts.deleteRow,\r\n            add: editingTexts.addRowToNode\r\n        }\r\n    };\r\n    var getButtonIndex = function(buttons, name) {\r\n        var result = -1;\r\n        buttons.some(function(button, index) {\r\n            if (getButtonName(button) === name) {\r\n                result = index;\r\n                return true\r\n            }\r\n        });\r\n        return result\r\n    };\r\n\r\n    function getButtonName(button) {\r\n        return _type2.default.isObject(button) ? button.name : button\r\n    }\r\n    var getEditorType = function(item) {\r\n        var column = item.column;\r\n        return item.isCustomEditorType ? item.editorType : column.formItem && column.formItem.editorType\r\n    };\r\n    var forEachFormItems = function forEachFormItems(items, callBack) {\r\n        items.forEach(function(item) {\r\n            if (item.items || item.tabs) {\r\n                forEachFormItems(item.items || item.tabs, callBack)\r\n            } else {\r\n                callBack(item)\r\n            }\r\n        })\r\n    };\r\n    return {\r\n        init: function() {\r\n            var that = this;\r\n            that._editRowIndex = -1;\r\n            that._editData = [];\r\n            that._editColumnIndex = -1;\r\n            that._columnsController = that.getController(\"columns\");\r\n            that._dataController = that.getController(\"data\");\r\n            that._rowsView = that.getView(\"rowsView\");\r\n            that._editForm = null;\r\n            that._updateEditFormDeferred = null;\r\n            that._lastOperation = null;\r\n            if (that._deferreds) {\r\n                that._deferreds.forEach(function(d) {\r\n                    return d.reject(\"cancel\")\r\n                })\r\n            }\r\n            that._deferreds = [];\r\n            if (!that._dataChangedHandler) {\r\n                that._dataChangedHandler = that._handleDataChanged.bind(that);\r\n                that._dataController.changed.add(that._dataChangedHandler)\r\n            }\r\n            if (!that._saveEditorHandler) {\r\n                that.createAction(\"onInitNewRow\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowInserting\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowInserted\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onEditingStart\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowUpdating\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowUpdated\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowRemoving\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                that.createAction(\"onRowRemoved\", {\r\n                    excludeValidators: [\"disabled\", \"readOnly\"]\r\n                });\r\n                var $pointerDownTarget;\r\n                that._pointerDownEditorHandler = function(e) {\r\n                    return $pointerDownTarget = (0, _renderer2.default)(e.target)\r\n                };\r\n                that._saveEditorHandler = that.createAction(function(e) {\r\n                    var event = e.event;\r\n                    var $target = (0, _renderer2.default)(event.target);\r\n                    var targetComponent = event[TARGET_COMPONENT_NAME];\r\n                    if ($pointerDownTarget && $pointerDownTarget.is(\"input\") && !$pointerDownTarget.is($target)) {\r\n                        return\r\n                    }\r\n\r\n                    function checkEditorPopup($element) {\r\n                        return $element && !!$element.closest(\".\".concat(DROPDOWN_EDITOR_OVERLAY_CLASS)).length\r\n                    }\r\n                    if (!_isRowEditMode(that) && !that._editCellInProgress) {\r\n                        var isEditorPopup = checkEditorPopup($target) || checkEditorPopup(null === targetComponent || void 0 === targetComponent ? void 0 : targetComponent.$element());\r\n                        var isDomElement = !!$target.closest((0, _window.getWindow)().document).length;\r\n                        var isAnotherComponent = targetComponent && !targetComponent._disposed && targetComponent !== that.component;\r\n                        var isAddRowButton = !!$target.closest(\".\".concat(that.addWidgetPrefix(ADD_ROW_BUTTON_CLASS))).length;\r\n                        var isFocusOverlay = $target.hasClass(that.addWidgetPrefix(FOCUS_OVERLAY_CLASS));\r\n                        var isCellEditMode = _getEditMode(that) === EDIT_MODE_CELL;\r\n                        if (!isEditorPopup && !isFocusOverlay && !(isAddRowButton && isCellEditMode && that.isEditing()) && (isDomElement || isAnotherComponent)) {\r\n                            that._closeEditItem.bind(that)($target)\r\n                        }\r\n                    }\r\n                });\r\n                _events_engine2.default.on(_dom_adapter2.default.getDocument(), _pointer2.default.down, that._pointerDownEditorHandler);\r\n                _events_engine2.default.on(_dom_adapter2.default.getDocument(), _click2.default.name, that._saveEditorHandler)\r\n            }\r\n            that._updateEditColumn();\r\n            that._updateEditButtons()\r\n        },\r\n        getUpdatedData: function(data) {\r\n            var key = this._dataController.keyOf(data);\r\n            var editData = this._editData;\r\n            var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, editData);\r\n            if (editData[editIndex]) {\r\n                return (0, _uiGrid_core3.createObjectWithChanges)(data, editData[editIndex].data)\r\n            }\r\n            return data\r\n        },\r\n        getInsertedData: function() {\r\n            return this._editData.filter(function(editData) {\r\n                return editData.data && editData.type === DATA_EDIT_DATA_INSERT_TYPE\r\n            }).map(function(editData) {\r\n                return editData.data\r\n            })\r\n        },\r\n        getRemovedData: function() {\r\n            return this._editData.filter(function(editData) {\r\n                return editData.oldData && editData.type === DATA_EDIT_DATA_REMOVE_TYPE\r\n            }).map(function(editData) {\r\n                return editData.oldData\r\n            })\r\n        },\r\n        _fireDataErrorOccurred: function(arg) {\r\n            if (\"cancel\" === arg) {\r\n                return\r\n            }\r\n            var $popupContent = this.getPopupContent();\r\n            this._dataController.dataErrorOccurred.fire(arg, $popupContent)\r\n        },\r\n        _needToCloseEditableCell: function($targetElement) {\r\n            var $element = this.component.$element();\r\n            var result = this.isEditing();\r\n            var isCurrentComponentElement = !$element || !!$targetElement.closest($element).length;\r\n            if (isCurrentComponentElement) {\r\n                var isDataRow = $targetElement.closest(\".\" + DATA_ROW_CLASS).length;\r\n                if (isDataRow) {\r\n                    var rowsView = this.getView(\"rowsView\");\r\n                    var $targetCell = $targetElement.closest(\".\" + ROW_CLASS + \"> td\");\r\n                    var rowIndex = rowsView.getRowIndex($targetCell.parent());\r\n                    var columnIndex = rowsView.getCellElements(rowIndex).index($targetCell);\r\n                    var visibleColumns = this._columnsController.getVisibleColumns();\r\n                    var allowEditing = visibleColumns[columnIndex] && visibleColumns[columnIndex].allowEditing;\r\n                    result = result && !allowEditing && !this.isEditCell(rowIndex, columnIndex)\r\n                }\r\n            }\r\n            return result\r\n        },\r\n        _closeEditItem: function($targetElement) {\r\n            if (this._needToCloseEditableCell($targetElement)) {\r\n                this.closeEditCell()\r\n            }\r\n        },\r\n        _handleDataChanged: function(args) {\r\n            var that = this;\r\n            var editForm = that._editForm;\r\n            if (\"standard\" === that.option(\"scrolling.mode\")) {\r\n                that.resetRowAndPageIndices()\r\n            }\r\n            if (\"prepend\" === args.changeType) {\r\n                (0, _iterator.each)(that._editData, function(_, editData) {\r\n                    editData.rowIndex += args.items.length\r\n                })\r\n            }\r\n            if (\"refresh\" === args.changeType && _getEditMode(that) === EDIT_MODE_POPUP && editForm && editForm.option(\"visible\")) {\r\n                this._repaintEditPopup()\r\n            }\r\n        },\r\n        _isDefaultButtonVisible: function(button, options) {\r\n            var result = true;\r\n            var isRowMode = _isRowEditMode(this);\r\n            var isEditRow = options.row && options.row.rowIndex === this._getVisibleEditRowIndex() && isRowMode;\r\n            switch (button.name) {\r\n                case \"edit\":\r\n                    result = !isEditRow && this.allowUpdating(options) && isRowMode;\r\n                    break;\r\n                case \"save\":\r\n                case \"cancel\":\r\n                    result = isEditRow;\r\n                    break;\r\n                case \"delete\":\r\n                    result = !isEditRow && this.allowDeleting(options) && !options.row.removed;\r\n                    break;\r\n                case \"undelete\":\r\n                    result = this.allowDeleting(options) && options.row.removed\r\n            }\r\n            return result\r\n        },\r\n        _isButtonVisible: function(button, options) {\r\n            var visible = button.visible;\r\n            if (!_type2.default.isDefined(visible)) {\r\n                return this._isDefaultButtonVisible(button, options)\r\n            }\r\n            return _type2.default.isFunction(visible) ? visible.call(button, {\r\n                component: options.component,\r\n                row: options.row,\r\n                column: options.column\r\n            }) : visible\r\n        },\r\n        _getButtonConfig: function(button, options) {\r\n            var _this = this;\r\n            var config = _type2.default.isObject(button) ? button : {};\r\n            var buttonName = getButtonName(button);\r\n            var editingTexts = getEditingTexts(options);\r\n            var methodName = METHOD_NAMES[buttonName];\r\n            var editingOptions = this.option(\"editing\");\r\n            var actionName = ACTION_OPTION_NAMES[buttonName];\r\n            var allowAction = actionName ? editingOptions[actionName] : true;\r\n            return (0, _extend.extend)({\r\n                name: buttonName,\r\n                text: editingTexts[buttonName],\r\n                cssClass: EDIT_LINK_CLASS[buttonName],\r\n                onClick: function(e) {\r\n                    var event = e.event;\r\n                    event.stopPropagation();\r\n                    event.preventDefault();\r\n                    setTimeout(function() {\r\n                        options.row && allowAction && _this[methodName] && _this[methodName](options.row.rowIndex)\r\n                    })\r\n                }\r\n            }, config)\r\n        },\r\n        _getEditingButtons: function(options) {\r\n            var _this2 = this;\r\n            var buttonIndex;\r\n            var haveCustomButtons = !!options.column.buttons;\r\n            var buttons = (options.column.buttons || []).slice();\r\n            if (haveCustomButtons) {\r\n                buttonIndex = getButtonIndex(buttons, \"edit\");\r\n                if (buttonIndex >= 0) {\r\n                    if (getButtonIndex(buttons, \"save\") < 0) {\r\n                        buttons.splice(buttonIndex + 1, 0, \"save\")\r\n                    }\r\n                    if (getButtonIndex(buttons, \"cancel\") < 0) {\r\n                        buttons.splice(getButtonIndex(buttons, \"save\") + 1, 0, \"cancel\")\r\n                    }\r\n                }\r\n                buttonIndex = getButtonIndex(buttons, \"delete\");\r\n                if (buttonIndex >= 0 && getButtonIndex(buttons, \"undelete\") < 0) {\r\n                    buttons.splice(buttonIndex + 1, 0, \"undelete\")\r\n                }\r\n            } else {\r\n                buttons = BUTTON_NAMES.slice()\r\n            }\r\n            return buttons.map(function(button) {\r\n                return _this2._getButtonConfig(button, options)\r\n            })\r\n        },\r\n        _renderEditingButtons: function($container, buttons, options) {\r\n            var _this3 = this;\r\n            buttons.forEach(function(button) {\r\n                if (_this3._isButtonVisible(button, options)) {\r\n                    _this3._createButton($container, button, options)\r\n                }\r\n            })\r\n        },\r\n        _getEditCommandCellTemplate: function() {\r\n            var _this4 = this;\r\n            return function(container, options) {\r\n                var $container = (0, _renderer2.default)(container);\r\n                if (\"data\" === options.rowType) {\r\n                    options.rtlEnabled = _this4.option(\"rtlEnabled\");\r\n                    var buttons = _this4._getEditingButtons(options);\r\n                    _this4._renderEditingButtons($container, buttons, options);\r\n                    options.watch && options.watch(function() {\r\n                        return buttons.map(function(button) {\r\n                            return _this4._isButtonVisible(button, options)\r\n                        })\r\n                    }, function() {\r\n                        $container.empty();\r\n                        _this4._renderEditingButtons($container, buttons, options)\r\n                    })\r\n                } else {\r\n                    (0, _uiGrid_core3.setEmptyText)($container)\r\n                }\r\n            }\r\n        },\r\n        correctEditRowIndexAfterExpand: function(key) {\r\n            if (this._editRowIndex > this._dataController.getRowIndexByKey(key)) {\r\n                this._editRowIndex++\r\n            }\r\n        },\r\n        correctEditRowIndex: function(getRowIndexCorrection) {\r\n            this._editRowIndex += getRowIndexCorrection(this._getVisibleEditRowIndex())\r\n        },\r\n        isRowEditMode: function() {\r\n            return _isRowEditMode(this)\r\n        },\r\n        isFormEditMode: function() {\r\n            var editMode = _getEditMode(this);\r\n            return FORM_BASED_MODES.indexOf(editMode) !== -1\r\n        },\r\n        isCellOrBatchEditMode: function() {\r\n            var editMode = this.getEditMode();\r\n            return editMode === EDIT_MODE_BATCH || editMode === EDIT_MODE_CELL\r\n        },\r\n        getEditMode: function() {\r\n            return _getEditMode(this)\r\n        },\r\n        getFirstEditableColumnIndex: function() {\r\n            var columnsController = this.getController(\"columns\");\r\n            var firstFormItem = this._firstFormItem;\r\n            var columnIndex;\r\n            if (_getEditMode(this) === EDIT_MODE_FORM && firstFormItem) {\r\n                var $editFormElements = this._rowsView.getCellElements(this._editRowIndex);\r\n                columnIndex = this._rowsView._getEditFormEditorVisibleIndex($editFormElements, firstFormItem.column)\r\n            } else {\r\n                var visibleColumns = columnsController.getVisibleColumns();\r\n                (0, _iterator.each)(visibleColumns, function(index, column) {\r\n                    if (column.allowEditing) {\r\n                        columnIndex = index;\r\n                        return false\r\n                    }\r\n                })\r\n            }\r\n            return columnIndex\r\n        },\r\n        getFirstEditableCellInRow: function(rowIndex) {\r\n            var rowsView = this.getView(\"rowsView\");\r\n            return rowsView && rowsView._getCellElement(rowIndex ? rowIndex : 0, this.getFirstEditableColumnIndex())\r\n        },\r\n        getFocusedCellInRow: function(rowIndex) {\r\n            return this.getFirstEditableCellInRow(rowIndex)\r\n        },\r\n        getIndexByKey: function(key, items) {\r\n            return (0, _uiGrid_core3.getIndexByKey)(key, items)\r\n        },\r\n        hasChanges: function(rowIndex) {\r\n            var that = this;\r\n            var result = false;\r\n            for (var i = 0; i < that._editData.length; i++) {\r\n                if (that._editData[i].type && (!_type2.default.isDefined(rowIndex) || that._dataController.getRowIndexByKey(that._editData[i].key) === rowIndex)) {\r\n                    result = true;\r\n                    break\r\n                }\r\n            }\r\n            return result\r\n        },\r\n        dispose: function() {\r\n            this.callBase();\r\n            clearTimeout(this._inputFocusTimeoutID);\r\n            _events_engine2.default.off(_dom_adapter2.default.getDocument(), _pointer2.default.down, this._pointerDownEditorHandler);\r\n            _events_engine2.default.off(_dom_adapter2.default.getDocument(), _click2.default.name, this._saveEditorHandler)\r\n        },\r\n        optionChanged: function(args) {\r\n            if (\"editing\" === args.name) {\r\n                var fullName = args.fullName;\r\n                var editPopup = this._editPopup;\r\n                if (fullName && 0 === fullName.indexOf(EDITING_POPUP_OPTION_NAME)) {\r\n                    if (editPopup) {\r\n                        var popupOptionName = fullName.slice(EDITING_POPUP_OPTION_NAME.length + 1);\r\n                        if (popupOptionName) {\r\n                            editPopup.option(popupOptionName, args.value)\r\n                        } else {\r\n                            editPopup.option(args.value)\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (editPopup && editPopup.option(\"visible\") && 0 === fullName.indexOf(\"editing.form\")) {\r\n                        this._repaintEditPopup()\r\n                    } else {\r\n                        this.init()\r\n                    }\r\n                }\r\n                args.handled = true\r\n            } else {\r\n                this.callBase(args)\r\n            }\r\n        },\r\n        publicMethods: function() {\r\n            return [\"insertRow\", \"addRow\", \"removeRow\", \"deleteRow\", \"undeleteRow\", \"editRow\", \"editCell\", \"closeEditCell\", \"saveEditData\", \"cancelEditData\", \"hasEditData\"]\r\n        },\r\n        refresh: function(isPageChanged) {\r\n            var editMode = _getEditMode(this);\r\n            var needResetIndexes = editMode === EDIT_MODE_BATCH || isPageChanged && \"virtual\" !== this.option(\"scrolling.mode\");\r\n            if (editMode !== EDIT_MODE_BATCH && editMode !== EDIT_MODE_CELL) {\r\n                this.init()\r\n            } else {\r\n                if (needResetIndexes) {\r\n                    this._editRowIndex = -1;\r\n                    this._editColumnIndex = -1\r\n                }\r\n            }\r\n        },\r\n        isEditing: function() {\r\n            return this._editRowIndex > -1\r\n        },\r\n        isEditRow: function(rowIndex) {\r\n            var editMode = _getEditMode(this);\r\n            return this._getVisibleEditRowIndex() === rowIndex && ROW_BASED_MODES.indexOf(editMode) !== -1\r\n        },\r\n        getEditRowKey: function() {\r\n            var items = this._dataController.items();\r\n            var item = items[this._getVisibleEditRowIndex()];\r\n            return item && item.key\r\n        },\r\n        getEditRowIndex: function() {\r\n            return this._getVisibleEditRowIndex()\r\n        },\r\n        getEditFormRowIndex: function() {\r\n            var editMode = _getEditMode(this);\r\n            return editMode === EDIT_MODE_FORM || editMode === EDIT_MODE_POPUP ? this._getVisibleEditRowIndex() : -1\r\n        },\r\n        isEditCell: function(visibleRowIndex, columnIndex) {\r\n            var hasEditData = !!(Array.isArray(this._editData) && this._editData.length);\r\n            return hasEditData && this._getVisibleEditRowIndex() === visibleRowIndex && this._editColumnIndex === columnIndex\r\n        },\r\n        getPopupContent: function() {\r\n            var editMode = _getEditMode(this);\r\n            var popupVisible = this._editPopup && this._editPopup.option(\"visible\");\r\n            if (editMode === EDIT_MODE_POPUP && popupVisible) {\r\n                return this._$popupContent\r\n            }\r\n        },\r\n        getEditForm: function() {\r\n            return this._editForm\r\n        },\r\n        _needInsertItem: function(editData, changeType) {\r\n            var that = this;\r\n            var dataSource = that._dataController.dataSource();\r\n            var scrollingMode = that.option(\"scrolling.mode\");\r\n            var pageIndex = dataSource.pageIndex();\r\n            var beginPageIndex = dataSource.beginPageIndex ? dataSource.beginPageIndex() : pageIndex;\r\n            var endPageIndex = dataSource.endPageIndex ? dataSource.endPageIndex() : pageIndex;\r\n            if (\"standard\" !== scrollingMode) {\r\n                switch (changeType) {\r\n                    case \"append\":\r\n                        return editData.key.pageIndex === endPageIndex;\r\n                    case \"prepend\":\r\n                        return editData.key.pageIndex === beginPageIndex;\r\n                    case \"refresh\":\r\n                        editData.key.rowIndex = 0;\r\n                        editData.key.dataRowIndex = 0;\r\n                        editData.key.pageIndex = 0;\r\n                        break;\r\n                    default:\r\n                        return editData.key.pageIndex >= beginPageIndex && editData.key.pageIndex <= endPageIndex\r\n                }\r\n            }\r\n            return editData.key.pageIndex === pageIndex\r\n        },\r\n        _generateNewItem: function(key) {\r\n            var item = {\r\n                key: key\r\n            };\r\n            if (key && key[INSERT_INDEX]) {\r\n                item[INSERT_INDEX] = key[INSERT_INDEX]\r\n            }\r\n            return item\r\n        },\r\n        processItems: function(items, change) {\r\n            var changeType = change.changeType;\r\n            var dataController = this._dataController;\r\n            var dataRowIndex = -1;\r\n            this.update(changeType);\r\n            var editData = this._editData;\r\n            for (var i = 0; i < editData.length; i++) {\r\n                var key = editData[i].key;\r\n                if (key) {\r\n                    var rowIndexOffset = dataController.getRowIndexOffset();\r\n                    dataRowIndex = key.dataRowIndex - rowIndexOffset + dataController.getRowIndexDelta();\r\n                    if (\"append\" === changeType) {\r\n                        dataRowIndex -= dataController.items(true).length;\r\n                        if (change.removeCount) {\r\n                            dataRowIndex += change.removeCount\r\n                        }\r\n                    }\r\n                    var item = this._generateNewItem(key);\r\n                    if (dataRowIndex >= 0 && editData[i].type === DATA_EDIT_DATA_INSERT_TYPE && this._needInsertItem(editData[i], changeType, items, item)) {\r\n                        items.splice(key.dataRowIndex ? dataRowIndex : 0, 0, item)\r\n                    }\r\n                }\r\n            }\r\n            return items\r\n        },\r\n        processDataItem: function(item, options, generateDataValues) {\r\n            var that = this;\r\n            var data;\r\n            var columns = options.visibleColumns;\r\n            var key = item.data[INSERT_INDEX] ? item.data.key : item.key;\r\n            var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, that._editData);\r\n            item.isEditing = false;\r\n            if (editIndex >= 0) {\r\n                var editMode = _getEditMode(that);\r\n                var editData = that._editData[editIndex];\r\n                data = editData.data;\r\n                switch (editData.type) {\r\n                    case DATA_EDIT_DATA_INSERT_TYPE:\r\n                        if (editMode === EDIT_MODE_POPUP) {\r\n                            item.visible = false\r\n                        }\r\n                        item.isNewRow = true;\r\n                        item.key = key;\r\n                        item.data = data;\r\n                        break;\r\n                    case DATA_EDIT_DATA_UPDATE_TYPE:\r\n                        item.modified = true;\r\n                        item.oldData = item.data;\r\n                        item.data = (0, _uiGrid_core3.createObjectWithChanges)(item.data, data);\r\n                        item.modifiedValues = generateDataValues(data, columns, true);\r\n                        break;\r\n                    case DATA_EDIT_DATA_REMOVE_TYPE:\r\n                        if (editMode === EDIT_MODE_BATCH) {\r\n                            item.data = (0, _uiGrid_core3.createObjectWithChanges)(item.data, data)\r\n                        }\r\n                        item.removed = true\r\n                }\r\n            }\r\n        },\r\n        insertRow: function() {\r\n            _ui2.default.log(\"W0002\", \"dxDataGrid\", \"insertRow\", \"15.2\", \"Use the 'addRow' method instead\");\r\n            return this.addRow()\r\n        },\r\n        _initNewRow: function(options) {\r\n            var _this5 = this;\r\n            this.executeAction(\"onInitNewRow\", options);\r\n            if (options.promise) {\r\n                var deferred = new _deferred.Deferred;\r\n                (0, _deferred.when)((0, _deferred.fromPromise)(options.promise)).done(deferred.resolve).fail(createFailureHandler(deferred)).fail(function(arg) {\r\n                    return _this5._fireDataErrorOccurred(arg)\r\n                });\r\n                return deferred\r\n            }\r\n        },\r\n        _getInsertKey: function(parentKey) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            var rows = dataController.items();\r\n            var editMode = _getEditMode(that);\r\n            var insertKey = {\r\n                parentKey: parentKey,\r\n                pageIndex: dataController.pageIndex(),\r\n                rowIndex: that._getInsertRowIndex(parentKey)\r\n            };\r\n            var row = rows[insertKey.rowIndex];\r\n            if (row && (!row.isEditing && \"detail\" === row.rowType || \"detailAdaptive\" === row.rowType)) {\r\n                insertKey.rowIndex++\r\n            }\r\n            insertKey.dataRowIndex = dataController.getRowIndexOffset() + rows.filter(function(row, index) {\r\n                return index < insertKey.rowIndex && (\"data\" === row.rowType || \"group\" === row.rowType || row.isNewRow)\r\n            }).length;\r\n            if (editMode !== EDIT_MODE_BATCH) {\r\n                that._editRowIndex = insertKey.rowIndex + that._dataController.getRowIndexOffset()\r\n            }\r\n            insertKey[INSERT_INDEX] = that._getInsertIndex();\r\n            return insertKey\r\n        },\r\n        _getInsertRowIndex: function(parentKey) {\r\n            var that = this;\r\n            var rowsView = that.getView(\"rowsView\");\r\n            var parentRowIndex = that._dataController.getRowIndexByKey(parentKey);\r\n            if (parentRowIndex >= 0) {\r\n                return parentRowIndex + 1\r\n            }\r\n            if (rowsView) {\r\n                return rowsView.getTopVisibleItemIndex(true)\r\n            }\r\n            return 0\r\n        },\r\n        _getInsertIndex: function() {\r\n            var maxInsertIndex = 0;\r\n            this._editData.forEach(function(editItem) {\r\n                if (editItem.type === DATA_EDIT_DATA_INSERT_TYPE && editItem.key[INSERT_INDEX] > maxInsertIndex) {\r\n                    maxInsertIndex = editItem.key[INSERT_INDEX]\r\n                }\r\n            });\r\n            return maxInsertIndex + 1\r\n        },\r\n        addRow: function(parentKey) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            var store = dataController.store();\r\n            var key = store && store.key();\r\n            var param = {\r\n                data: {}\r\n            };\r\n            var editMode = _getEditMode(that);\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            var deferred = new _deferred.Deferred;\r\n            if (!store) {\r\n                dataController.fireError(\"E1052\", this.component.NAME);\r\n                return deferred.reject()\r\n            }\r\n            if (editMode === EDIT_MODE_CELL && that.hasChanges()) {\r\n                that.saveEditData().done(function() {\r\n                    if (!that.hasChanges()) {\r\n                        that.addRow(parentKey).done(deferred.resolve).fail(deferred.reject)\r\n                    } else {\r\n                        deferred.reject(\"cancel\")\r\n                    }\r\n                });\r\n                return deferred.promise()\r\n            }\r\n            that.refresh();\r\n            if (!that._allowRowAdding()) {\r\n                return deferred.reject(\"cancel\")\r\n            }\r\n            if (!key) {\r\n                param.data.__KEY__ = String(new _guid2.default)\r\n            }(0, _deferred.when)(that._initNewRow(param, parentKey)).done(function() {\r\n                if (that._allowRowAdding()) {\r\n                    that._addRowCore(param.data, parentKey, oldEditRowIndex);\r\n                    deferred.resolve()\r\n                } else {\r\n                    deferred.reject(\"cancel\")\r\n                }\r\n            }).fail(deferred.reject);\r\n            return deferred.promise()\r\n        },\r\n        _allowRowAdding: function() {\r\n            var that = this;\r\n            var editMode = _getEditMode(that);\r\n            var insertIndex = that._getInsertIndex();\r\n            if (editMode !== EDIT_MODE_BATCH && insertIndex > 1) {\r\n                return false\r\n            }\r\n            return true\r\n        },\r\n        _addRowCore: function(data, parentKey, initialOldEditRowIndex) {\r\n            var that = this;\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            var insertKey = that._getInsertKey(parentKey);\r\n            var editMode = _getEditMode(that);\r\n            that._addEditData({\r\n                key: insertKey,\r\n                data: data,\r\n                type: DATA_EDIT_DATA_INSERT_TYPE\r\n            });\r\n            that._dataController.updateItems({\r\n                changeType: \"update\",\r\n                rowIndices: [initialOldEditRowIndex, oldEditRowIndex, insertKey.rowIndex]\r\n            });\r\n            if (editMode === EDIT_MODE_POPUP) {\r\n                that._showEditPopup(insertKey.rowIndex)\r\n            } else {\r\n                that._focusFirstEditableCellInRow(insertKey.rowIndex)\r\n            }\r\n            that._afterInsertRow({\r\n                key: insertKey,\r\n                data: data\r\n            })\r\n        },\r\n        _focusFirstEditableCellInRow: function(rowIndex) {\r\n            var that = this;\r\n            var $firstCell = that.getFirstEditableCellInRow(rowIndex);\r\n            that._editCellInProgress = true;\r\n            that._delayedInputFocus($firstCell, function() {\r\n                that._editCellInProgress = false;\r\n                var $cell = that.getFirstEditableCellInRow(rowIndex);\r\n                var eventToTrigger = \"dblClick\" === that.option(\"editing.startEditAction\") ? _double_click2.default.name : _click2.default.name;\r\n                $cell && _events_engine2.default.trigger($cell, eventToTrigger)\r\n            })\r\n        },\r\n        _isEditingStart: function(options) {\r\n            this.executeAction(\"onEditingStart\", options);\r\n            return options.cancel\r\n        },\r\n        _beforeEditCell: function(rowIndex, columnIndex, item) {\r\n            var that = this;\r\n            if (_getEditMode(that) === EDIT_MODE_CELL && !item.isNewRow && that.hasChanges()) {\r\n                var d = new _deferred.Deferred;\r\n                that.saveEditData().always(function() {\r\n                    d.resolve(that.hasChanges())\r\n                });\r\n                return d\r\n            }\r\n        },\r\n        _beforeUpdateItems: function() {},\r\n        _getVisibleEditRowIndex: function() {\r\n            return this._editRowIndex >= 0 ? this._editRowIndex - this._dataController.getRowIndexOffset() : -1\r\n        },\r\n        editRow: function(rowIndex) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            var items = dataController.items();\r\n            var item = items[rowIndex];\r\n            var params = {\r\n                data: item && item.data,\r\n                cancel: false\r\n            };\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            var $editingCell;\r\n            if (!item) {\r\n                return\r\n            }\r\n            if (rowIndex === oldEditRowIndex) {\r\n                return true\r\n            }\r\n            if (!item.isNewRow) {\r\n                params.key = item.key\r\n            }\r\n            if (that._isEditingStart(params)) {\r\n                return\r\n            }\r\n            that.init();\r\n            that._pageIndex = dataController.pageIndex();\r\n            that._editRowIndex = (items[0].isNewRow ? rowIndex - 1 : rowIndex) + that._dataController.getRowIndexOffset();\r\n            that._addEditData({\r\n                data: {},\r\n                key: item.key,\r\n                oldData: item.data\r\n            });\r\n            var rowIndices = [oldEditRowIndex, rowIndex];\r\n            var editMode = _getEditMode(that);\r\n            that._beforeUpdateItems(rowIndices, rowIndex, oldEditRowIndex);\r\n            if (editMode === EDIT_MODE_POPUP) {\r\n                that._showEditPopup(rowIndex)\r\n            } else {\r\n                dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: rowIndices\r\n                })\r\n            }\r\n            if (MODES_WITH_DELAYED_FOCUS.indexOf(editMode) !== -1) {\r\n                $editingCell = that.getFocusedCellInRow(that._getVisibleEditRowIndex());\r\n                that._delayedInputFocus($editingCell, function() {\r\n                    $editingCell && that.component.focus($editingCell)\r\n                })\r\n            }\r\n        },\r\n        _showEditPopup: function(rowIndex, repaintForm) {\r\n            var that = this;\r\n            var isMobileDevice = \"desktop\" !== _devices2.default.current().deviceType;\r\n            var popupOptions = (0, _extend.extend)({\r\n                showTitle: false,\r\n                fullScreen: isMobileDevice,\r\n                toolbarItems: [{\r\n                    toolbar: \"bottom\",\r\n                    location: \"after\",\r\n                    widget: \"dxButton\",\r\n                    options: that._getSaveButtonConfig()\r\n                }, {\r\n                    toolbar: \"bottom\",\r\n                    location: \"after\",\r\n                    widget: \"dxButton\",\r\n                    options: that._getCancelButtonConfig()\r\n                }],\r\n                contentTemplate: that._getPopupEditFormTemplate(rowIndex)\r\n            }, that.option(EDITING_POPUP_OPTION_NAME));\r\n            if (!that._editPopup) {\r\n                var $popupContainer = (0, _renderer2.default)(\"<div>\").appendTo(that.component.$element()).addClass(that.addWidgetPrefix(EDIT_POPUP_CLASS));\r\n                that._editPopup = that._createComponent($popupContainer, _popup2.default, {});\r\n                that._editPopup.on(\"hiding\", that._getEditPopupHiddenHandler());\r\n                that._editPopup.on(\"shown\", function(e) {\r\n                    _events_engine2.default.trigger(e.component.$content().find(FOCUSABLE_ELEMENT_SELECTOR).not(\".\" + SCROLLABLE_CONTAINER_CLASS).first(), \"focus\");\r\n                    if (repaintForm) {\r\n                        that._editForm && that._editForm.repaint()\r\n                    }\r\n                })\r\n            }\r\n            that._editPopup.option(popupOptions);\r\n            that._editPopup.show()\r\n        },\r\n        _repaintEditPopup: function() {\r\n            var rowIndex = this._getVisibleEditRowIndex();\r\n            if (this._editPopup && this._editPopup.option(\"visible\") && rowIndex >= 0) {\r\n                var defaultAnimation = this._editPopup.option(\"animation\");\r\n                this._editPopup.option(\"animation\", null);\r\n                this._showEditPopup(rowIndex, true);\r\n                this._editPopup.option(\"animation\", defaultAnimation)\r\n            }\r\n        },\r\n        _getEditPopupHiddenHandler: function() {\r\n            var that = this;\r\n            return function(e) {\r\n                if (that.isEditing()) {\r\n                    that.cancelEditData()\r\n                }\r\n            }\r\n        },\r\n        _getPopupEditFormTemplate: function(rowIndex) {\r\n            var that = this;\r\n            var row = that.component.getVisibleRows()[rowIndex];\r\n            var templateOptions = {\r\n                row: row,\r\n                rowType: row.rowType,\r\n                key: row.key\r\n            };\r\n            return function(container) {\r\n                var formTemplate = that.getEditFormTemplate();\r\n                var scrollable = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo(container), _ui4.default);\r\n                that._$popupContent = scrollable.$content();\r\n                formTemplate(that._$popupContent, templateOptions, true)\r\n            }\r\n        },\r\n        _getSaveButtonConfig: function() {\r\n            return {\r\n                text: this.option(\"editing.texts.saveRowChanges\"),\r\n                onClick: this.saveEditData.bind(this)\r\n            }\r\n        },\r\n        _getCancelButtonConfig: function() {\r\n            return {\r\n                text: this.option(\"editing.texts.cancelRowChanges\"),\r\n                onClick: this.cancelEditData.bind(this)\r\n            }\r\n        },\r\n        _removeEditDataItem: function(index) {\r\n            if (index >= 0) {\r\n                this._editData.splice(index, 1)\r\n            }\r\n        },\r\n        executeOperation: function(deferred, func) {\r\n            var _this6 = this;\r\n            this._lastOperation && this._lastOperation.reject();\r\n            this._lastOperation = deferred;\r\n            this.waitForDeferredOperations().done(function() {\r\n                if (\"rejected\" === deferred.state()) {\r\n                    return\r\n                }\r\n                func();\r\n                _this6._lastOperation = null\r\n            }).fail(function() {\r\n                deferred.reject();\r\n                _this6._lastOperation = null\r\n            })\r\n        },\r\n        waitForDeferredOperations: function() {\r\n            return _deferred.when.apply(void 0, _toConsumableArray(this._deferreds))\r\n        },\r\n        editCell: function(rowIndex, columnIndex) {\r\n            var _this7 = this;\r\n            var d = new _deferred.Deferred;\r\n            var coreResult;\r\n            this.executeOperation(d, function() {\r\n                coreResult = _this7._editCellCore(rowIndex, columnIndex);\r\n                (0, _deferred.when)(coreResult).done(d.resolve).fail(d.reject)\r\n            });\r\n            return void 0 !== coreResult ? coreResult : d.promise()\r\n        },\r\n        _editCellCore: function(rowIndex, columnIndex) {\r\n            var that = this;\r\n            var columnsController = that._columnsController;\r\n            var dataController = that._dataController;\r\n            var items = dataController.items();\r\n            var item = items[rowIndex];\r\n            var params = {\r\n                data: item && item.data,\r\n                cancel: false\r\n            };\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            var visibleColumns = columnsController.getVisibleColumns();\r\n            var oldColumn = visibleColumns[that._editColumnIndex];\r\n            if (_type2.default.isString(columnIndex)) {\r\n                columnIndex = columnsController.columnOption(columnIndex, \"index\");\r\n                columnIndex = columnsController.getVisibleIndex(columnIndex)\r\n            }\r\n            var column = params.column = visibleColumns[columnIndex];\r\n            if (column && item && (\"data\" === item.rowType || \"detailAdaptive\" === item.rowType) && !item.removed && !_isRowEditMode(that)) {\r\n                if (that.isEditCell(rowIndex, columnIndex)) {\r\n                    return true\r\n                }\r\n                var editRowIndex = rowIndex + dataController.getRowIndexOffset();\r\n                return (0, _deferred.when)(that._beforeEditCell(rowIndex, columnIndex, item)).done(function(cancel) {\r\n                    if (cancel) {\r\n                        return\r\n                    }\r\n                    if (that._prepareEditCell(params, item, columnIndex, editRowIndex)) {\r\n                        _common2.default.deferRender(function() {\r\n                            that._repaintEditCell(column, oldColumn, oldEditRowIndex);\r\n                        })\r\n                    } else {\r\n                        that._processCanceledEditingCell()\r\n                    }\r\n                })\r\n            }\r\n            return false\r\n        },\r\n        _processCanceledEditingCell: function() {},\r\n        _prepareEditCell: function(params, item, editColumnIndex, editRowIndex) {\r\n            var that = this;\r\n            if (!item.isNewRow) {\r\n                params.key = item.key\r\n            }\r\n            if (that._isEditingStart(params)) {\r\n                return false\r\n            }\r\n            that._editRowIndex = editRowIndex;\r\n            that._editColumnIndex = editColumnIndex;\r\n            that._pageIndex = that._dataController.pageIndex();\r\n            that._addEditData({\r\n                data: {},\r\n                key: item.key,\r\n                oldData: item.data\r\n            });\r\n            return true\r\n        },\r\n        _repaintEditCell: function(column, oldColumn, oldEditRowIndex) {\r\n            var that = this;\r\n            var rowsView = that._rowsView;\r\n            if (!column || !column.showEditorAlways || oldColumn && !oldColumn.showEditorAlways) {\r\n                that._editCellInProgress = true;\r\n                that.getController(\"editorFactory\").loseFocus();\r\n                that._dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: [oldEditRowIndex, that._getVisibleEditRowIndex()]\r\n                })\r\n            }\r\n            var $cell = rowsView && rowsView._getCellElement(that._getVisibleEditRowIndex(), that._editColumnIndex);\r\n            if ($cell && !$cell.find(\":focus\").length) {\r\n                that._focusEditingCell(function() {\r\n                    that._editCellInProgress = false\r\n                }, $cell, true)\r\n            } else {\r\n                that._editCellInProgress = false\r\n            }\r\n        },\r\n        _delayedInputFocus: function($cell, beforeFocusCallback, callBeforeFocusCallbackAlways) {\r\n            var that = this;\r\n\r\n            function inputFocus() {\r\n                if (beforeFocusCallback) {\r\n                    beforeFocusCallback()\r\n                }\r\n                if ($cell) {\r\n                    var $focusableElement = $cell.find(FOCUSABLE_ELEMENT_SELECTOR).first();\r\n                    (0, _uiGrid_core3.focusAndSelectElement)(that, $focusableElement)\r\n                }\r\n                that._beforeFocusCallback = null\r\n            }\r\n            if (_devices2.default.real().ios || _devices2.default.real().android) {\r\n                inputFocus()\r\n            } else {\r\n                if (that._beforeFocusCallback) {\r\n                    that._beforeFocusCallback()\r\n                }\r\n                clearTimeout(that._inputFocusTimeoutID);\r\n                if (callBeforeFocusCallbackAlways) {\r\n                    that._beforeFocusCallback = beforeFocusCallback\r\n                }\r\n                that._inputFocusTimeoutID = setTimeout(inputFocus)\r\n            }\r\n        },\r\n        _focusEditingCell: function(beforeFocusCallback, $editCell, callBeforeFocusCallbackAlways) {\r\n            var that = this;\r\n            var rowsView = that.getView(\"rowsView\");\r\n            $editCell = $editCell || rowsView && rowsView._getCellElement(that._getVisibleEditRowIndex(), that._editColumnIndex);\r\n            that._delayedInputFocus($editCell, beforeFocusCallback, callBeforeFocusCallbackAlways)\r\n        },\r\n        removeRow: function(rowIndex) {\r\n            _ui2.default.log(\"W0002\", \"dxDataGrid\", \"removeRow\", \"15.2\", \"Use the 'deleteRow' method instead\");\r\n            return this.deleteRow(rowIndex)\r\n        },\r\n        deleteRow: function(rowIndex) {\r\n            var _this8 = this;\r\n            if (\"cell\" === this.option(\"editing.mode\") && this.isEditing()) {\r\n                var isNewRow = this._dataController.items()[rowIndex].isNewRow;\r\n                this.closeEditCell(null, isNewRow).always(function() {\r\n                    _this8._checkAndDeleteRow(rowIndex)\r\n                })\r\n            } else {\r\n                this._checkAndDeleteRow(rowIndex)\r\n            }\r\n        },\r\n        _checkAndDeleteRow: function(rowIndex) {\r\n            var that = this;\r\n            var editingOptions = that.option(\"editing\");\r\n            var editingTexts = editingOptions && editingOptions.texts;\r\n            var isBatchMode = editingOptions && editingOptions.mode === EDIT_MODE_BATCH;\r\n            var confirmDelete = editingOptions && editingOptions.confirmDelete;\r\n            var confirmDeleteMessage = editingTexts && editingTexts.confirmDeleteMessage;\r\n            var item = that._dataController.items()[rowIndex];\r\n            var allowDeleting = isBatchMode || !that.isEditing() || item.isNewRow;\r\n            if (item && allowDeleting) {\r\n                if (isBatchMode || !confirmDelete || !confirmDeleteMessage) {\r\n                    that._deleteRowCore(rowIndex)\r\n                } else {\r\n                    var confirmDeleteTitle = editingTexts && editingTexts.confirmDeleteTitle;\r\n                    var showDialogTitle = _type2.default.isDefined(confirmDeleteTitle) && confirmDeleteTitle.length > 0;\r\n                    _dialog2.default.confirm(confirmDeleteMessage, confirmDeleteTitle, showDialogTitle).done(function(confirmResult) {\r\n                        if (confirmResult) {\r\n                            that._deleteRowCore(rowIndex)\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n        },\r\n        _deleteRowCore: function(rowIndex) {\r\n            var dataController = this._dataController;\r\n            var item = dataController.items()[rowIndex];\r\n            var key = item && item.key;\r\n            var oldEditRowIndex = this._getVisibleEditRowIndex();\r\n            var isBatchMode = this.option(\"editing.mode\") === EDIT_MODE_BATCH;\r\n            this.refresh();\r\n            var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, this._editData);\r\n            if (editIndex >= 0) {\r\n                if (this._editData[editIndex].type === DATA_EDIT_DATA_INSERT_TYPE) {\r\n                    this._removeEditDataItem(editIndex)\r\n                } else {\r\n                    this._addEditData({\r\n                        key: key,\r\n                        type: DATA_EDIT_DATA_REMOVE_TYPE\r\n                    })\r\n                }\r\n            } else {\r\n                this._addEditData({\r\n                    key: key,\r\n                    oldData: item.data,\r\n                    type: DATA_EDIT_DATA_REMOVE_TYPE\r\n                })\r\n            }\r\n            if (isBatchMode) {\r\n                dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: [oldEditRowIndex, rowIndex]\r\n                })\r\n            } else {\r\n                this.saveEditData()\r\n            }\r\n        },\r\n        undeleteRow: function(rowIndex) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            var item = dataController.items()[rowIndex];\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            var key = item && item.key;\r\n            if (item) {\r\n                var editIndex = (0, _uiGrid_core3.getIndexByKey)(key, that._editData);\r\n                if (editIndex >= 0) {\r\n                    var editData = that._editData[editIndex];\r\n                    if (_type2.default.isEmptyObject(editData.data)) {\r\n                        that._removeEditDataItem(editIndex)\r\n                    } else {\r\n                        that._addEditData({\r\n                            key: key,\r\n                            type: DATA_EDIT_DATA_UPDATE_TYPE\r\n                        })\r\n                    }\r\n                    dataController.updateItems({\r\n                        changeType: \"update\",\r\n                        rowIndices: [oldEditRowIndex, rowIndex]\r\n                    })\r\n                }\r\n            }\r\n        },\r\n        _saveEditDataCore: function(deferreds, results, changes) {\r\n            var that = this;\r\n            var store = that._dataController.store();\r\n            var isDataSaved = true;\r\n\r\n            function executeEditingAction(actionName, params, func) {\r\n                var deferred = new _deferred.Deferred;\r\n                that.executeAction(actionName, params);\r\n                (0, _deferred.when)((0, _deferred.fromPromise)(params.cancel)).done(function(cancel) {\r\n                    if (cancel) {\r\n                        setTimeout(function() {\r\n                            deferred.resolve(\"cancel\")\r\n                        })\r\n                    } else {\r\n                        func(params).done(deferred.resolve).fail(createFailureHandler(deferred))\r\n                    }\r\n                }).fail(createFailureHandler(deferred));\r\n                return deferred\r\n            }(0, _iterator.each)(that._editData, function(index, editData) {\r\n                var data = editData.data;\r\n                var oldData = editData.oldData;\r\n                var type = editData.type;\r\n                var deferred;\r\n                var params;\r\n                if (that._beforeSaveEditData(editData, index)) {\r\n                    return\r\n                }\r\n                switch (type) {\r\n                    case DATA_EDIT_DATA_REMOVE_TYPE:\r\n                        params = {\r\n                            data: oldData,\r\n                            key: editData.key,\r\n                            cancel: false\r\n                        };\r\n                        deferred = executeEditingAction(\"onRowRemoving\", params, function() {\r\n                            return store.remove(editData.key).done(function(key) {\r\n                                changes.push({\r\n                                    type: \"remove\",\r\n                                    key: key\r\n                                })\r\n                            })\r\n                        });\r\n                        break;\r\n                    case DATA_EDIT_DATA_INSERT_TYPE:\r\n                        params = {\r\n                            data: data,\r\n                            cancel: false\r\n                        };\r\n                        deferred = executeEditingAction(\"onRowInserting\", params, function() {\r\n                            return store.insert(params.data).done(function(data, key) {\r\n                                if (_type2.default.isDefined(key)) {\r\n                                    editData.key = key\r\n                                }\r\n                                if (data && _type2.default.isObject(data) && data !== params.data) {\r\n                                    editData.data = data\r\n                                }\r\n                                changes.push({\r\n                                    type: \"insert\",\r\n                                    data: data,\r\n                                    index: 0\r\n                                })\r\n                            })\r\n                        });\r\n                        break;\r\n                    case DATA_EDIT_DATA_UPDATE_TYPE:\r\n                        params = {\r\n                            newData: data,\r\n                            oldData: oldData,\r\n                            key: editData.key,\r\n                            cancel: false\r\n                        };\r\n                        deferred = executeEditingAction(\"onRowUpdating\", params, function() {\r\n                            return store.update(editData.key, params.newData).done(function(data, key) {\r\n                                if (data && _type2.default.isObject(data) && data !== params.newData) {\r\n                                    editData.data = data\r\n                                }\r\n                                changes.push({\r\n                                    type: \"update\",\r\n                                    key: key,\r\n                                    data: data\r\n                                })\r\n                            })\r\n                        })\r\n                }\r\n                if (deferred) {\r\n                    var doneDeferred = new _deferred.Deferred;\r\n                    deferred.always(function(data) {\r\n                        isDataSaved = \"cancel\" !== data;\r\n                        results.push({\r\n                            key: editData.key,\r\n                            result: data\r\n                        })\r\n                    }).always(doneDeferred.resolve);\r\n                    deferreds.push(doneDeferred.promise())\r\n                }\r\n            });\r\n            return isDataSaved\r\n        },\r\n        _processSaveEditDataResult: function(results) {\r\n            var that = this;\r\n            var hasSavedData = false;\r\n            var editMode = _getEditMode(that);\r\n            for (var i = 0; i < results.length; i++) {\r\n                var arg = results[i].result;\r\n                var cancel = \"cancel\" === arg;\r\n                var editIndex = (0, _uiGrid_core3.getIndexByKey)(results[i].key, that._editData);\r\n                var editData = that._editData[editIndex];\r\n                var isError = arg && arg instanceof Error;\r\n                if (isError) {\r\n                    if (editData) {\r\n                        editData.error = arg\r\n                    }\r\n                    that._fireDataErrorOccurred(arg);\r\n                    if (editMode !== EDIT_MODE_BATCH) {\r\n                        if (editData && editData.type === DATA_EDIT_DATA_REMOVE_TYPE) {\r\n                            that._removeEditDataItem(editIndex)\r\n                        }\r\n                        break\r\n                    }\r\n                } else {\r\n                    if (!cancel || !editData || editMode !== EDIT_MODE_BATCH && editData.type === DATA_EDIT_DATA_REMOVE_TYPE) {\r\n                        that._removeEditDataItem(editIndex);\r\n                        hasSavedData = !cancel\r\n                    }\r\n                }\r\n            }\r\n            return hasSavedData\r\n        },\r\n        _fireSaveEditDataEvents: function(editData) {\r\n            var that = this;\r\n            (0, _iterator.each)(editData, function(_, itemData) {\r\n                var data = itemData.data;\r\n                var key = itemData.key;\r\n                var type = itemData.type;\r\n                var params = {\r\n                    key: key,\r\n                    data: data\r\n                };\r\n                if (itemData.error) {\r\n                    params.error = itemData.error\r\n                }\r\n                switch (type) {\r\n                    case DATA_EDIT_DATA_REMOVE_TYPE:\r\n                        that.executeAction(\"onRowRemoved\", (0, _extend.extend)({}, params, {\r\n                            data: itemData.oldData\r\n                        }));\r\n                        break;\r\n                    case DATA_EDIT_DATA_INSERT_TYPE:\r\n                        that.executeAction(\"onRowInserted\", params);\r\n                        break;\r\n                    case DATA_EDIT_DATA_UPDATE_TYPE:\r\n                        that.executeAction(\"onRowUpdated\", params)\r\n                }\r\n            })\r\n        },\r\n        saveEditData: function() {\r\n            var _this9 = this;\r\n            var deferred = new _deferred.Deferred;\r\n            var afterSaveEditData = function(cancel) {\r\n                (0, _deferred.when)(_this9._afterSaveEditData(cancel)).done(function() {\r\n                    deferred.resolve()\r\n                })\r\n            };\r\n            this.waitForDeferredOperations().done(function() {\r\n                if (_this9._saving) {\r\n                    afterSaveEditData();\r\n                    return\r\n                }(0, _deferred.when)(_this9._beforeSaveEditData()).done(function(cancel) {\r\n                    if (cancel) {\r\n                        afterSaveEditData(cancel);\r\n                        return\r\n                    }\r\n                    _this9._saveEditDataInner().done(deferred.resolve).fail(deferred.reject)\r\n                }).fail(deferred.reject)\r\n            }).fail(deferred.reject);\r\n            return deferred.promise()\r\n        },\r\n        _saveEditDataInner: function() {\r\n            var _this10 = this;\r\n            var results = [];\r\n            var deferreds = [];\r\n            var changes = [];\r\n            var dataController = this._dataController;\r\n            var dataSource = dataController.dataSource();\r\n            var editMode = _getEditMode(this);\r\n            var result = new _deferred.Deferred;\r\n            var resetEditIndices = function() {\r\n                if (editMode !== EDIT_MODE_CELL) {\r\n                    _this10._editColumnIndex = -1;\r\n                    _this10._editRowIndex = -1\r\n                }\r\n            };\r\n            var afterSaveEditData = function(error) {\r\n                (0, _deferred.when)(_this10._afterSaveEditData()).done(function() {\r\n                    result.resolve(error)\r\n                })\r\n            };\r\n            var editData = this._editData.slice(0);\r\n            if (!this._saveEditDataCore(deferreds, results, changes) && editMode === EDIT_MODE_CELL) {\r\n                this._focusEditingCell()\r\n            }\r\n            if (deferreds.length) {\r\n                this._saving = true;\r\n                dataSource && dataSource.beginLoading();\r\n                _deferred.when.apply(_renderer2.default, deferreds).done(function() {\r\n                    if (_this10._processSaveEditDataResult(results)) {\r\n                        resetEditIndices();\r\n                        if (editMode === EDIT_MODE_POPUP && _this10._editPopup) {\r\n                            _this10._editPopup.hide()\r\n                        }\r\n                        dataSource && dataSource.endLoading();\r\n                        var refreshMode = _this10.option(\"editing.refreshMode\");\r\n                        var isFullRefresh = \"reshape\" !== refreshMode && \"repaint\" !== refreshMode;\r\n                        if (!isFullRefresh) {\r\n                            dataController.push(changes)\r\n                        }(0, _deferred.when)(dataController.refresh({\r\n                            selection: isFullRefresh,\r\n                            reload: isFullRefresh,\r\n                            load: \"reshape\" === refreshMode,\r\n                            changesOnly: _this10.option(\"repaintChangesOnly\")\r\n                        })).always(function() {\r\n                            _this10._fireSaveEditDataEvents(editData)\r\n                        }).done(function() {\r\n                            afterSaveEditData()\r\n                        }).fail(function(error) {\r\n                            afterSaveEditData(error)\r\n                        })\r\n                    } else {\r\n                        dataSource && dataSource.endLoading();\r\n                        result.resolve()\r\n                    }\r\n                }).fail(function(error) {\r\n                    dataSource && dataSource.endLoading();\r\n                    result.resolve(error)\r\n                });\r\n                return result.always(function() {\r\n                    _this10._focusEditingCell();\r\n                    _this10._saving = false\r\n                }).promise()\r\n            }\r\n            if (_isRowEditMode(this)) {\r\n                if (!this.hasChanges()) {\r\n                    this.cancelEditData()\r\n                }\r\n            } else {\r\n                if (CELL_BASED_MODES.indexOf(editMode) !== -1) {\r\n                    resetEditIndices();\r\n                    dataController.updateItems()\r\n                } else {\r\n                    this._focusEditingCell()\r\n                }\r\n            }\r\n            afterSaveEditData();\r\n            return result.promise()\r\n        },\r\n        isSaving: function() {\r\n            return this._saving\r\n        },\r\n        _updateEditColumn: function() {\r\n            var that = this;\r\n            var isEditColumnVisible = that._isEditColumnVisible();\r\n            var useIcons = that.option(\"editing.useIcons\");\r\n            var cssClass = COMMAND_EDIT_CLASS + (useIcons ? \" \" + COMMAND_EDIT_WITH_ICONS_CLASS : \"\");\r\n            that._columnsController.addCommandColumn({\r\n                type: \"buttons\",\r\n                command: \"edit\",\r\n                visible: isEditColumnVisible,\r\n                cssClass: cssClass,\r\n                width: \"auto\",\r\n                alignment: \"center\",\r\n                cellTemplate: that._getEditCommandCellTemplate(),\r\n                fixedPosition: \"right\"\r\n            });\r\n            that._columnsController.columnOption(\"command:edit\", {\r\n                visible: isEditColumnVisible,\r\n                cssClass: cssClass\r\n            })\r\n        },\r\n        _isEditColumnVisible: function() {\r\n            var that = this;\r\n            var editingOptions = that.option(\"editing\");\r\n            if (editingOptions) {\r\n                var editMode = _getEditMode(that);\r\n                var isVisibleWithCurrentEditMode = false;\r\n                switch (editMode) {\r\n                    case EDIT_MODE_ROW:\r\n                        isVisibleWithCurrentEditMode = editingOptions.allowUpdating || editingOptions.allowAdding;\r\n                        break;\r\n                    case EDIT_MODE_FORM:\r\n                    case EDIT_MODE_POPUP:\r\n                        isVisibleWithCurrentEditMode = editingOptions.allowUpdating\r\n                }\r\n                return editingOptions.allowDeleting || isVisibleWithCurrentEditMode\r\n            }\r\n        },\r\n        _updateEditButtons: function() {\r\n            var that = this;\r\n            var headerPanel = that.getView(\"headerPanel\");\r\n            var hasChanges = that.hasChanges();\r\n            if (headerPanel) {\r\n                headerPanel.setToolbarItemDisabled(\"saveButton\", !hasChanges);\r\n                headerPanel.setToolbarItemDisabled(\"revertButton\", !hasChanges)\r\n            }\r\n        },\r\n        _applyModified: function($element) {\r\n            $element && $element.addClass(CELL_MODIFIED)\r\n        },\r\n        _beforeCloseEditCellInBatchMode: function() {},\r\n        cancelEditData: function() {\r\n            var that = this;\r\n            var editMode = _getEditMode(that);\r\n            var rowIndex = this._getVisibleEditRowIndex();\r\n            var dataController = that._dataController;\r\n            that._beforeCancelEditData();\r\n            that.init();\r\n            if (ROW_BASED_MODES.indexOf(editMode) !== -1 && rowIndex >= 0) {\r\n                dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: [rowIndex, rowIndex + 1]\r\n                })\r\n            } else {\r\n                dataController.updateItems({\r\n                    repaintChangesOnly: that.option(\"repaintChangesOnly\")\r\n                })\r\n            }\r\n            if (editMode === EDIT_MODE_POPUP) {\r\n                that._hideEditPopup()\r\n            }\r\n        },\r\n        _hideEditPopup: function() {\r\n            this._editPopup && this._editPopup.option(\"visible\", false)\r\n        },\r\n        hasEditData: function() {\r\n            return this.hasChanges()\r\n        },\r\n        closeEditCell: function(isError, withoutSaveEditData) {\r\n            var _this11 = this;\r\n            var that = this;\r\n            var result = _deferred2.default.when();\r\n            var oldEditRowIndex = that._getVisibleEditRowIndex();\r\n            if (!_isRowEditMode(that)) {\r\n                result = _deferred2.default.Deferred();\r\n                this.executeOperation(result, function() {\r\n                    _this11._closeEditCellCore(isError, oldEditRowIndex, withoutSaveEditData);\r\n                    result.resolve()\r\n                })\r\n            }\r\n            return result.promise()\r\n        },\r\n        _closeEditCellCore: function(isError, oldEditRowIndex, withoutSaveEditData) {\r\n            var that = this;\r\n            var editMode = _getEditMode(that);\r\n            var dataController = that._dataController;\r\n            if (editMode === EDIT_MODE_CELL && that.hasChanges()) {\r\n                if (!withoutSaveEditData) {\r\n                    that.saveEditData().done(function(error) {\r\n                        if (!that.hasChanges()) {\r\n                            that.closeEditCell(!!error)\r\n                        }\r\n                    })\r\n                }\r\n            } else {\r\n                if (oldEditRowIndex >= 0) {\r\n                    var rowIndices = [oldEditRowIndex];\r\n                    that._editRowIndex = -1;\r\n                    that._editColumnIndex = -1;\r\n                    that._beforeCloseEditCellInBatchMode(rowIndices);\r\n                    if (!isError) {\r\n                        dataController.updateItems({\r\n                            changeType: \"update\",\r\n                            rowIndices: rowIndices\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        update: function(changeType) {\r\n            var that = this;\r\n            var dataController = that._dataController;\r\n            if (dataController && that._pageIndex !== dataController.pageIndex()) {\r\n                if (\"refresh\" === changeType) {\r\n                    that.refresh(true)\r\n                }\r\n                that._pageIndex = dataController.pageIndex()\r\n            }\r\n            that._updateEditButtons()\r\n        },\r\n        _getRowIndicesForCascadeUpdating: function(row, skipCurrentRow) {\r\n            return skipCurrentRow ? [] : [row.rowIndex]\r\n        },\r\n        addDeferred: function(deferred) {\r\n            var _this12 = this;\r\n            if (this._deferreds.indexOf(deferred) < 0) {\r\n                this._deferreds.push(deferred);\r\n                deferred.always(function() {\r\n                    var index = _this12._deferreds.indexOf(deferred);\r\n                    if (index >= 0) {\r\n                        _this12._deferreds.splice(index, 1)\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        _prepareEditDataParams: function(options, value, text) {\r\n            var _options$row;\r\n            var that = this;\r\n            var newData = {};\r\n            var oldData = null === (_options$row = options.row) || void 0 === _options$row ? void 0 : _options$row.data;\r\n            var rowKey = options.key;\r\n            var $cellElement = (0, _renderer2.default)(options.cellElement);\r\n            var editMode = _getEditMode(that);\r\n            var deferred = new _deferred.Deferred;\r\n            if (void 0 !== rowKey) {\r\n                if (editMode === EDIT_MODE_BATCH) {\r\n                    that._applyModified($cellElement, options)\r\n                }\r\n                options.value = value;\r\n                var setCellValueResult = (0, _deferred.fromPromise)(options.column.setCellValue(newData, value, (0, _extend.extend)(true, {}, oldData), text));\r\n                setCellValueResult.done(function() {\r\n                    deferred.resolve({\r\n                        data: newData,\r\n                        key: rowKey,\r\n                        oldData: oldData,\r\n                        type: DATA_EDIT_DATA_UPDATE_TYPE\r\n                    })\r\n                }).fail(createFailureHandler(deferred)).fail(function(arg) {\r\n                    return that._fireDataErrorOccurred(arg)\r\n                });\r\n                if (_type2.default.isDefined(text) && options.column.displayValueMap) {\r\n                    options.column.displayValueMap[value] = text\r\n                }\r\n                if (options.values) {\r\n                    options.values[options.columnIndex] = value\r\n                }\r\n                that.addDeferred(deferred)\r\n            }\r\n            return deferred\r\n        },\r\n        updateFieldValue: function(options, value, text, forceUpdateRow) {\r\n            var _this13 = this;\r\n            var rowKey = options.key;\r\n            var deferred = new _deferred.Deferred;\r\n            if (void 0 === rowKey) {\r\n                this._dataController.fireError(\"E1043\")\r\n            }\r\n            if (options.column.setCellValue) {\r\n                this._prepareEditDataParams(options, value, text).done(function(params) {\r\n                    (0, _deferred.when)(_this13._applyEditDataParams(options, params, forceUpdateRow)).always(function() {\r\n                        deferred.resolve()\r\n                    })\r\n                })\r\n            } else {\r\n                deferred.resolve()\r\n            }\r\n            return deferred.promise()\r\n        },\r\n        _focusPreviousEditingCellIfNeed: function(options) {\r\n            var that = this;\r\n            if (that.hasEditData() && !that.isEditCell(options.rowIndex, options.columnIndex)) {\r\n                that._focusEditingCell();\r\n                that._updateEditRow(options.row, true);\r\n                return true\r\n            }\r\n        },\r\n        _needUpdateRow: function(column) {\r\n            var visibleColumns = this._columnsController.getVisibleColumns();\r\n            if (!column) {\r\n                column = visibleColumns[this._editColumnIndex]\r\n            }\r\n            var isCustomSetCellValue = column && column.setCellValue !== column.defaultSetCellValue;\r\n            var isCustomCalculateCellValue = visibleColumns.some(function(visibleColumn) {\r\n                return visibleColumn.calculateCellValue !== visibleColumn.defaultCalculateCellValue\r\n            });\r\n            return isCustomSetCellValue || isCustomCalculateCellValue\r\n        },\r\n        _applyEditDataParams: function(options, params, forceUpdateRow) {\r\n            var that = this;\r\n            var editMode = _getEditMode(that);\r\n            var isCustomSetCellValue = options.column.setCellValue !== options.column.defaultSetCellValue;\r\n            var showEditorAlways = options.column.showEditorAlways;\r\n            var isUpdateInCellMode = editMode === EDIT_MODE_CELL && options.row && !options.row.isNewRow;\r\n            var focusPreviousEditingCell = showEditorAlways && !forceUpdateRow && isUpdateInCellMode && that.hasEditData() && !that.isEditCell(options.rowIndex, options.columnIndex);\r\n            if (focusPreviousEditingCell) {\r\n                that._focusEditingCell();\r\n                that._updateEditRow(options.row, true, isCustomSetCellValue);\r\n                return\r\n            }\r\n            that._addEditData(params, options.row);\r\n            that._updateEditButtons();\r\n            if (showEditorAlways && !forceUpdateRow) {\r\n                if (isUpdateInCellMode) {\r\n                    that._editRowIndex = options.row.rowIndex + that._dataController.getRowIndexOffset();\r\n                    that._editColumnIndex = options.columnIndex;\r\n                    return that.saveEditData()\r\n                } else {\r\n                    if (editMode === EDIT_MODE_BATCH) {\r\n                        forceUpdateRow = that._needUpdateRow(options.column)\r\n                    }\r\n                }\r\n            }\r\n            var row = options.row;\r\n            if (row) {\r\n                if (forceUpdateRow || isCustomSetCellValue) {\r\n                    that._updateEditRow(row, forceUpdateRow, isCustomSetCellValue)\r\n                } else {\r\n                    if (row.update) {\r\n                        row.update()\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        _updateEditRowCore: function(row, skipCurrentRow, isCustomSetCellValue) {\r\n            var that = this;\r\n            var editForm = that._editForm;\r\n            var editMode = _getEditMode(that);\r\n            if (editMode === EDIT_MODE_POPUP) {\r\n                if (that.option(\"repaintChangesOnly\")) {\r\n                    row.update && row.update(row)\r\n                } else {\r\n                    if (editForm) {\r\n                        that._updateEditFormDeferred = (new _deferred.Deferred).done(function() {\r\n                            return editForm.repaint()\r\n                        });\r\n                        if (!that._updateLockCount) {\r\n                            that._updateEditFormDeferred.resolve()\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                that._dataController.updateItems({\r\n                    changeType: \"update\",\r\n                    rowIndices: that._getRowIndicesForCascadeUpdating(row, skipCurrentRow)\r\n                })\r\n            }\r\n            if (isCustomSetCellValue && that._editForm && !row.isNewRow) {\r\n                that._editForm.validate()\r\n            }\r\n        },\r\n        _endUpdateCore: function() {\r\n            this._updateEditFormDeferred && this._updateEditFormDeferred.resolve()\r\n        },\r\n        _updateEditRow: function(row, forceUpdateRow, isCustomSetCellValue) {\r\n            var that = this;\r\n            if (forceUpdateRow || !_isRowEditMode(that)) {\r\n                that._updateEditRowCore(row, !forceUpdateRow, isCustomSetCellValue);\r\n                if (!forceUpdateRow) {\r\n                    that._focusEditingCell()\r\n                }\r\n            } else {\r\n                var deferred = new _deferred.Deferred;\r\n                that.addDeferred(deferred);\r\n                setTimeout(function() {\r\n                    var $focusedElement = (0, _renderer2.default)(_dom_adapter2.default.getActiveElement());\r\n                    var columnIndex = that._rowsView.getCellIndex($focusedElement, row.rowIndex);\r\n                    var focusedElement = $focusedElement.get(0);\r\n                    var selectionRange = (0, _uiGrid_core3.getSelectionRange)(focusedElement);\r\n                    that._updateEditRowCore(row, false, isCustomSetCellValue);\r\n                    if (columnIndex >= 0) {\r\n                        var $focusedItem = that._rowsView._getCellElement(row.rowIndex, columnIndex);\r\n                        that._delayedInputFocus($focusedItem, function() {\r\n                            setTimeout(function() {\r\n                                focusedElement = _dom_adapter2.default.getActiveElement();\r\n                                if (selectionRange.selectionStart >= 0) {\r\n                                    (0, _uiGrid_core3.setSelectionRange)(focusedElement, selectionRange)\r\n                                }\r\n                            })\r\n                        })\r\n                    }\r\n                    deferred.resolve()\r\n                })\r\n            }\r\n        },\r\n        _addEditData: function(options, row) {\r\n            var that = this;\r\n            var editDataIndex = (0, _uiGrid_core3.getIndexByKey)(options.key, that._editData);\r\n            if (editDataIndex < 0) {\r\n                editDataIndex = that._editData.length;\r\n                that._editData.push(options)\r\n            }\r\n            if (that._editData[editDataIndex]) {\r\n                if (options.data) {\r\n                    that._editData[editDataIndex].data = (0, _uiGrid_core3.createObjectWithChanges)(that._editData[editDataIndex].data, options.data)\r\n                }\r\n                if ((!that._editData[editDataIndex].type || !options.data) && options.type) {\r\n                    that._editData[editDataIndex].type = options.type\r\n                }\r\n                if (row) {\r\n                    row.oldData = that._editData[editDataIndex].oldData;\r\n                    row.data = (0, _uiGrid_core3.createObjectWithChanges)(row.data, options.data)\r\n                }\r\n            }\r\n            return editDataIndex\r\n        },\r\n        _getFormEditItemTemplate: function(cellOptions, column) {\r\n            return column.editCellTemplate || getDefaultEditorTemplate(this)\r\n        },\r\n        renderFormEditTemplate: function(detailCellOptions, item, form, container, isReadOnly) {\r\n            var that = this;\r\n            var $container = (0, _renderer2.default)(container);\r\n            var column = item.column;\r\n            var editorType = getEditorType(item);\r\n            var rowData = null === detailCellOptions || void 0 === detailCellOptions ? void 0 : detailCellOptions.row.data;\r\n            var cellOptions = (0, _extend.extend)({}, detailCellOptions, {\r\n                data: rowData,\r\n                cellElement: null,\r\n                isOnForm: true,\r\n                item: item,\r\n                column: (0, _extend.extend)({}, column, {\r\n                    editorType: editorType,\r\n                    editorOptions: item.editorOptions\r\n                }),\r\n                id: form.getItemID(item.name || item.dataField),\r\n                columnIndex: column.index,\r\n                setValue: !isReadOnly && column.allowEditing && function(value) {\r\n                    that.updateFieldValue(cellOptions, value)\r\n                }\r\n            });\r\n            cellOptions.value = column.calculateCellValue(rowData);\r\n            var template = that._getFormEditItemTemplate.bind(that)(cellOptions, column);\r\n            that._rowsView.renderTemplate($container, template, cellOptions, !!$container.closest((0, _window.getWindow)().document).length).done(function() {\r\n                that._rowsView._updateCell($container, cellOptions)\r\n            });\r\n            return cellOptions\r\n        },\r\n        getFormEditorTemplate: function(cellOptions, item) {\r\n            var that = this;\r\n            var column = this.component.columnOption(item.dataField);\r\n            return function(options, container) {\r\n                var $container = (0, _renderer2.default)(container);\r\n                cellOptions.row.watch && cellOptions.row.watch(function() {\r\n                    return column.selector(cellOptions.row.data)\r\n                }, function() {\r\n                    var _validator;\r\n                    var $editorElement = $container.find(\".dx-widget\").first();\r\n                    var validator = $editorElement.data(\"dxValidator\");\r\n                    var validatorOptions = null === (_validator = validator) || void 0 === _validator ? void 0 : _validator.option();\r\n                    $container.contents().remove();\r\n                    cellOptions = that.renderFormEditTemplate.bind(that)(cellOptions, item, options.component, $container);\r\n                    $editorElement = $container.find(\".dx-widget\").first();\r\n                    validator = $editorElement.data(\"dxValidator\");\r\n                    if (validatorOptions && !validator) {\r\n                        $editorElement.dxValidator({\r\n                            validationRules: validatorOptions.validationRules,\r\n                            validationGroup: validatorOptions.validationGroup,\r\n                            dataGetter: validatorOptions.dataGetter\r\n                        })\r\n                    }\r\n                });\r\n                cellOptions = that.renderFormEditTemplate.bind(that)(cellOptions, item, options.component, $container)\r\n            }\r\n        },\r\n        getEditFormTemplate: function() {\r\n            var that = this;\r\n            return function($container, detailOptions, renderFormOnly) {\r\n                var editFormOptions = that.option(\"editing.form\");\r\n                var items = that.option(\"editing.form.items\");\r\n                var userCustomizeItem = that.option(\"editing.form.customizeItem\");\r\n                var editData = that._editData[(0, _uiGrid_core3.getIndexByKey)(detailOptions.key, that._editData)];\r\n                var editFormItemClass = that.addWidgetPrefix(EDIT_FORM_ITEM_CLASS);\r\n                var isCustomEditorType = {};\r\n                if (!items) {\r\n                    var columns = that.getController(\"columns\").getColumns();\r\n                    items = [];\r\n                    (0, _iterator.each)(columns, function(_, column) {\r\n                        if (!column.isBand && !column.type) {\r\n                            items.push({\r\n                                column: column,\r\n                                name: column.name,\r\n                                dataField: column.dataField\r\n                            })\r\n                        }\r\n                    })\r\n                } else {\r\n                    forEachFormItems(items, function(item) {\r\n                        var itemId = (null === item || void 0 === item ? void 0 : item.name) || (null === item || void 0 === item ? void 0 : item.dataField);\r\n                        if (itemId) {\r\n                            isCustomEditorType[itemId] = !!item.editorType\r\n                        }\r\n                    })\r\n                }\r\n                that._firstFormItem = void 0;\r\n                that._editForm = that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($container), _form2.default, (0, _extend.extend)({}, editFormOptions, {\r\n                    items: items,\r\n                    formID: \"dx-\" + new _guid2.default,\r\n                    validationGroup: editData,\r\n                    customizeItem: function(item) {\r\n                        var column;\r\n                        var itemId = item.name || item.dataField;\r\n                        if (item.column || itemId) {\r\n                            column = item.column || that._columnsController.columnOption(item.name ? \"name:\" + item.name : \"dataField:\" + item.dataField)\r\n                        }\r\n                        if (column) {\r\n                            item.label = item.label || {};\r\n                            item.label.text = item.label.text || column.caption;\r\n                            item.template = item.template || that.getFormEditorTemplate(detailOptions, item);\r\n                            item.column = column;\r\n                            item.isCustomEditorType = isCustomEditorType[itemId];\r\n                            if (column.formItem) {\r\n                                (0, _extend.extend)(item, column.formItem)\r\n                            }\r\n                            if (void 0 === item.isRequired && column.validationRules) {\r\n                                item.isRequired = column.validationRules.some(function(rule) {\r\n                                    return \"required\" === rule.type\r\n                                });\r\n                                item.validationRules = []\r\n                            }\r\n                            var itemVisible = _type2.default.isDefined(item.visible) ? item.visible : true;\r\n                            if (!that._firstFormItem && itemVisible) {\r\n                                that._firstFormItem = item\r\n                            }\r\n                        }\r\n                        userCustomizeItem && userCustomizeItem.call(this, item);\r\n                        item.cssClass = _type2.default.isString(item.cssClass) ? item.cssClass + \" \" + editFormItemClass : editFormItemClass\r\n                    }\r\n                }));\r\n                if (!renderFormOnly) {\r\n                    var $buttonsContainer = (0, _renderer2.default)(\"<div>\").addClass(that.addWidgetPrefix(FORM_BUTTONS_CONTAINER_CLASS)).appendTo($container);\r\n                    that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($buttonsContainer), _button2.default, that._getSaveButtonConfig());\r\n                    that._createComponent((0, _renderer2.default)(\"<div>\").appendTo($buttonsContainer), _button2.default, that._getCancelButtonConfig())\r\n                }\r\n                that._editForm.on(\"contentReady\", function() {\r\n                    that._editPopup && that._editPopup.repaint()\r\n                })\r\n            }\r\n        },\r\n        getColumnTemplate: function(options) {\r\n            var that = this;\r\n            var column = options.column;\r\n            var rowIndex = options.row && options.row.rowIndex;\r\n            var template;\r\n            var isRowMode = _isRowEditMode(that);\r\n            var isRowEditing = that.isEditRow(rowIndex);\r\n            var isCellEditing = that.isEditCell(rowIndex, options.columnIndex);\r\n            var editingStartOptions;\r\n            if ((column.showEditorAlways || column.setCellValue && (isRowEditing && column.allowEditing || isCellEditing)) && (\"data\" === options.rowType || \"detailAdaptive\" === options.rowType) && !column.command) {\r\n                var allowUpdating = that.allowUpdating(options);\r\n                if (((allowUpdating || isRowEditing) && column.allowEditing || isCellEditing) && (isRowMode && isRowEditing || !isRowMode)) {\r\n                    if (column.showEditorAlways && !isRowMode) {\r\n                        editingStartOptions = {\r\n                            cancel: false,\r\n                            key: options.row.isNewRow ? void 0 : options.row.key,\r\n                            data: options.row.data,\r\n                            column: column\r\n                        };\r\n                        that._isEditingStart(editingStartOptions)\r\n                    }\r\n                    if (!editingStartOptions || !editingStartOptions.cancel) {\r\n                        options.setValue = function(value, text) {\r\n                            that.updateFieldValue(options, value, text)\r\n                        }\r\n                    }\r\n                }\r\n                template = column.editCellTemplate || getDefaultEditorTemplate(that)\r\n            } else {\r\n                if (\"detail\" === column.command && \"detail\" === options.rowType && isRowEditing) {\r\n                    template = that.getEditFormTemplate(options)\r\n                }\r\n            }\r\n            return template\r\n        },\r\n        _createButton: function($container, button, options) {\r\n            var that = this;\r\n            var icon = EDIT_ICON_CLASS[button.name];\r\n            var useIcons = that.option(\"editing.useIcons\");\r\n            var $button = (0, _renderer2.default)(\"<a>\").attr(\"href\", \"#\").addClass(LINK_CLASS).addClass(button.cssClass);\r\n            if (button.template) {\r\n                that._rowsView.renderTemplate($container, button.template, options, true)\r\n            } else {\r\n                if (useIcons && icon || button.icon) {\r\n                    icon = button.icon || icon;\r\n                    var iconType = _icon2.default.getImageSourceType(icon);\r\n                    if (\"image\" === iconType || \"svg\" === iconType) {\r\n                        $button = _icon2.default.getImageContainer(icon).addClass(button.cssClass)\r\n                    } else {\r\n                        $button.addClass(\"dx-icon\" + (\"dxIcon\" === iconType ? \"-\" : \" \") + icon).attr(\"title\", button.text)\r\n                    }\r\n                    $button.addClass(\"dx-link-icon\");\r\n                    $container.addClass(COMMAND_EDIT_WITH_ICONS_CLASS);\r\n                    var localizationName = this.getButtonLocalizationNames()[button.name];\r\n                    localizationName && $button.attr(\"aria-label\", _message2.default.format(localizationName))\r\n                } else {\r\n                    $button.text(button.text)\r\n                }\r\n                if (_type2.default.isDefined(button.hint)) {\r\n                    $button.attr(\"title\", button.hint)\r\n                }\r\n                _events_engine2.default.on($button, (0, _utils.addNamespace)(\"click\", EDITING_NAMESPACE), that.createAction(function(e) {\r\n                    button.onClick.call(button, (0, _extend.extend)({}, e, {\r\n                        row: options.row,\r\n                        column: options.column\r\n                    }));\r\n                    e.event.preventDefault();\r\n                    e.event.stopPropagation()\r\n                }));\r\n                options.rtlEnabled ? $container.prepend($button, \"&nbsp;\") : $container.append($button, \"&nbsp;\")\r\n            }\r\n        },\r\n        getButtonLocalizationNames: function() {\r\n            return {\r\n                edit: \"dxDataGrid-editingEditRow\",\r\n                save: \"dxDataGrid-editingSaveRowChanges\",\r\n                \"delete\": \"dxDataGrid-editingDeleteRow\",\r\n                undelete: \"dxDataGrid-editingUndeleteRow\",\r\n                cancel: \"dxDataGrid-editingCancelRowChanges\"\r\n            }\r\n        },\r\n        prepareEditButtons: function(headerPanel) {\r\n            var that = this;\r\n            var editingOptions = that.option(\"editing\") || {};\r\n            var editingTexts = that.option(\"editing.texts\") || {};\r\n            var titleButtonTextByClassNames = {\r\n                revert: editingTexts.cancelAllChanges,\r\n                save: editingTexts.saveAllChanges,\r\n                addRow: editingTexts.addRow\r\n            };\r\n            var classNameButtonByNames = {\r\n                revert: \"cancel\",\r\n                save: \"save\",\r\n                addRow: \"addrow\"\r\n            };\r\n            var buttonItems = [];\r\n            var prepareButtonItem = function(name, methodName, sortIndex) {\r\n                var className = classNameButtonByNames[name];\r\n                var onInitialized = function(e) {\r\n                    (0, _renderer2.default)(e.element).addClass(headerPanel._getToolbarButtonClass(EDIT_BUTTON_CLASS + \" \" + that.addWidgetPrefix(className) + \"-button\"))\r\n                };\r\n                var hintText = titleButtonTextByClassNames[name];\r\n                var isButtonDisabled = (\"save\" === className || \"cancel\" === className) && !that.hasChanges();\r\n                return {\r\n                    widget: \"dxButton\",\r\n                    options: {\r\n                        onInitialized: onInitialized,\r\n                        icon: \"edit-button-\" + className,\r\n                        disabled: isButtonDisabled,\r\n                        onClick: function() {\r\n                            setTimeout(function() {\r\n                                that[methodName]()\r\n                            })\r\n                        },\r\n                        text: hintText,\r\n                        hint: hintText\r\n                    },\r\n                    showText: \"inMenu\",\r\n                    name: name + \"Button\",\r\n                    location: \"after\",\r\n                    locateInMenu: \"auto\",\r\n                    sortIndex: sortIndex\r\n                }\r\n            };\r\n            if (editingOptions.allowAdding) {\r\n                buttonItems.push(prepareButtonItem(\"addRow\", \"addRow\", 20))\r\n            }\r\n            if ((editingOptions.allowUpdating || editingOptions.allowAdding || editingOptions.allowDeleting) && _getEditMode(that) === EDIT_MODE_BATCH) {\r\n                buttonItems.push(prepareButtonItem(\"save\", \"saveEditData\", 21));\r\n                buttonItems.push(prepareButtonItem(\"revert\", \"cancelEditData\", 22))\r\n            }\r\n            return buttonItems\r\n        },\r\n        showHighlighting: function($cell) {\r\n            var $highlight = $cell.find(\".\" + CELL_HIGHLIGHT_OUTLINE);\r\n            if (\"TD\" === $cell.get(0).tagName && !$highlight.length) {\r\n                $cell.wrapInner((0, _renderer2.default)(\"<div>\").addClass(CELL_HIGHLIGHT_OUTLINE + \" \" + POINTER_EVENTS_TARGET_CLASS))\r\n            }\r\n        },\r\n        highlightDataCell: function($cell, parameters) {\r\n            var isEditableCell = parameters.setValue;\r\n            var cellModified = this.isCellModified(parameters);\r\n            if (cellModified && parameters.column.setCellValue) {\r\n                this.showHighlighting($cell);\r\n                $cell.addClass(CELL_MODIFIED)\r\n            } else {\r\n                if (isEditableCell) {\r\n                    this.showHighlighting($cell)\r\n                }\r\n            }\r\n        },\r\n        resetRowAndPageIndices: function() {\r\n            var that = this;\r\n            (0, _iterator.each)(that._editData, function(_, editData) {\r\n                if (editData.pageIndex !== that._pageIndex) {\r\n                    delete editData.pageIndex;\r\n                    delete editData.rowIndex\r\n                }\r\n            })\r\n        },\r\n        _afterInsertRow: function() {},\r\n        _beforeSaveEditData: function(editData) {\r\n            if (editData && !_type2.default.isDefined(editData.key) && _type2.default.isDefined(editData.type)) {\r\n                return true\r\n            }\r\n        },\r\n        _afterSaveEditData: function() {},\r\n        _beforeCancelEditData: function() {},\r\n        _allowEditAction: function(actionName, options) {\r\n            var allowEditAction = this.option(\"editing.\" + actionName);\r\n            if (_type2.default.isFunction(allowEditAction)) {\r\n                allowEditAction = allowEditAction({\r\n                    component: this.component,\r\n                    row: options.row\r\n                })\r\n            }\r\n            return allowEditAction\r\n        },\r\n        allowUpdating: function(options, eventName) {\r\n            var startEditAction = this.option(\"editing.startEditAction\") || DEFAULT_START_EDIT_ACTION;\r\n            var needCallback = arguments.length > 1 ? startEditAction === eventName || \"down\" === eventName : true;\r\n            return needCallback && this._allowEditAction(\"allowUpdating\", options)\r\n        },\r\n        allowDeleting: function(options) {\r\n            return this._allowEditAction(\"allowDeleting\", options)\r\n        },\r\n        isCellModified: function(parameters) {\r\n            var columnIndex = parameters.columnIndex;\r\n            var modifiedValues = parameters.row && (parameters.row.isNewRow ? parameters.row.values : parameters.row.modifiedValues);\r\n            return !!modifiedValues && void 0 !== modifiedValues[columnIndex]\r\n        }\r\n    }\r\n}());\r\nmodule.exports = {\r\n    defaultOptions: function() {\r\n        return {\r\n            editing: {\r\n                mode: \"row\",\r\n                refreshMode: \"full\",\r\n                allowAdding: false,\r\n                allowUpdating: false,\r\n                allowDeleting: false,\r\n                useIcons: false,\r\n                selectTextOnEditStart: false,\r\n                confirmDelete: true,\r\n                texts: {\r\n                    editRow: _message2.default.format(\"dxDataGrid-editingEditRow\"),\r\n                    saveAllChanges: _message2.default.format(\"dxDataGrid-editingSaveAllChanges\"),\r\n                    saveRowChanges: _message2.default.format(\"dxDataGrid-editingSaveRowChanges\"),\r\n                    cancelAllChanges: _message2.default.format(\"dxDataGrid-editingCancelAllChanges\"),\r\n                    cancelRowChanges: _message2.default.format(\"dxDataGrid-editingCancelRowChanges\"),\r\n                    addRow: _message2.default.format(\"dxDataGrid-editingAddRow\"),\r\n                    deleteRow: _message2.default.format(\"dxDataGrid-editingDeleteRow\"),\r\n                    undeleteRow: _message2.default.format(\"dxDataGrid-editingUndeleteRow\"),\r\n                    confirmDeleteMessage: _message2.default.format(\"dxDataGrid-editingConfirmDeleteMessage\"),\r\n                    confirmDeleteTitle: \"\"\r\n                },\r\n                form: {\r\n                    colCount: 2\r\n                },\r\n                popup: {},\r\n                startEditAction: \"click\"\r\n            }\r\n        }\r\n    },\r\n    controllers: {\r\n        editing: EditingController\r\n    },\r\n    extenders: {\r\n        controllers: {\r\n            data: {\r\n                init: function() {\r\n                    this._editingController = this.getController(\"editing\");\r\n                    this.callBase()\r\n                },\r\n                reload: function(full, repaintChangesOnly) {\r\n                    !repaintChangesOnly && this._editingController.refresh();\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                repaintRows: function() {\r\n                    if (this.getController(\"editing\").isSaving()) {\r\n                        return\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _updateEditRow: function(items) {\r\n                    var editingController = this._editingController;\r\n                    var editRowIndex = editingController.getEditRowIndex();\r\n                    var editItem = items[editRowIndex];\r\n                    if (editItem) {\r\n                        editItem.isEditing = true;\r\n                        if (editingController.getEditMode() === EDIT_MODE_FORM) {\r\n                            editItem.rowType = \"detail\"\r\n                        }\r\n                    }\r\n                },\r\n                _updateItemsCore: function(change) {\r\n                    this.callBase(change);\r\n                    this._updateEditRow(this.items())\r\n                },\r\n                _applyChangeUpdate: function(change) {\r\n                    this._updateEditRow(change.items);\r\n                    this.callBase(change)\r\n                },\r\n                _applyChangesOnly: function(change) {\r\n                    this._updateEditRow(change.items);\r\n                    this.callBase(change)\r\n                },\r\n                _processItems: function(items, change) {\r\n                    items = this._editingController.processItems(items, change);\r\n                    return this.callBase(items, change)\r\n                },\r\n                _processDataItem: function(dataItem, options) {\r\n                    this._editingController.processDataItem(dataItem, options, this.generateDataValues);\r\n                    return this.callBase(dataItem, options)\r\n                },\r\n                _processItem: function(item, options) {\r\n                    item = this.callBase(item, options);\r\n                    if (item.isNewRow) {\r\n                        options.dataIndex--;\r\n                        delete item.dataIndex\r\n                    }\r\n                    return item\r\n                },\r\n                _correctRowIndices: function(getRowIndexCorrection) {\r\n                    this.callBase.apply(this, arguments);\r\n                    this._editingController.correctEditRowIndex(getRowIndexCorrection)\r\n                },\r\n                _getChangedColumnIndices: function(oldItem, newItem, rowIndex, isLiveUpdate) {\r\n                    var editingController = this.getController(\"editing\");\r\n                    var isRowEditMode = editingController.isRowEditMode();\r\n                    if (oldItem.isNewRow !== newItem.isNewRow || oldItem.removed !== newItem.removed || isRowEditMode && oldItem.isEditing !== newItem.isEditing) {\r\n                        return\r\n                    }\r\n                    if (oldItem.rowType === newItem.rowType && isRowEditMode && editingController.isEditRow(rowIndex) && isLiveUpdate) {\r\n                        return []\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _isCellChanged: function(oldRow, newRow, visibleRowIndex, columnIndex, isLiveUpdate) {\r\n                    var editingController = this.getController(\"editing\");\r\n                    var cell = oldRow.cells && oldRow.cells[columnIndex];\r\n                    var isEditing = editingController && editingController.isEditCell(visibleRowIndex, columnIndex);\r\n                    if (isLiveUpdate && isEditing) {\r\n                        return false\r\n                    }\r\n                    if (cell && cell.column && !cell.column.showEditorAlways && cell.isEditing !== isEditing) {\r\n                        return true\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                }\r\n            }\r\n        },\r\n        views: {\r\n            rowsView: {\r\n                init: function() {\r\n                    this.callBase();\r\n                    this._editingController = this.getController(\"editing\")\r\n                },\r\n                getCellElements: function(rowIndex) {\r\n                    var $cellElements = this.callBase(rowIndex);\r\n                    var editingController = this._editingController;\r\n                    var editForm = editingController.getEditForm();\r\n                    var editFormRowIndex = editingController.getEditFormRowIndex();\r\n                    if (editFormRowIndex === rowIndex && $cellElements && editForm) {\r\n                        return editForm.$element().find(\".\" + this.addWidgetPrefix(EDIT_FORM_ITEM_CLASS) + \", .\" + BUTTON_CLASS)\r\n                    }\r\n                    return $cellElements\r\n                },\r\n                getCellIndex: function($cell, rowIndex) {\r\n                    if (!$cell.is(\"td\") && rowIndex >= 0) {\r\n                        var $cellElements = this.getCellElements(rowIndex);\r\n                        var cellIndex = -1;\r\n                        (0, _iterator.each)($cellElements, function(index, cellElement) {\r\n                            if ((0, _renderer2.default)(cellElement).find($cell).length) {\r\n                                cellIndex = index\r\n                            }\r\n                        });\r\n                        return cellIndex\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _getVisibleColumnIndex: function($cells, rowIndex, columnIdentifier) {\r\n                    var editFormRowIndex = this._editingController.getEditFormRowIndex();\r\n                    if (editFormRowIndex === rowIndex && _type2.default.isString(columnIdentifier)) {\r\n                        var column = this._columnsController.columnOption(columnIdentifier);\r\n                        return this._getEditFormEditorVisibleIndex($cells, column)\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _getEditFormEditorVisibleIndex: function($cells, column) {\r\n                    var visibleIndex = -1;\r\n                    (0, _iterator.each)($cells, function(index, cellElement) {\r\n                        var item = (0, _renderer2.default)(cellElement).find(\".dx-field-item-content\").data(\"dx-form-item\");\r\n                        if (item && item.column && column && item.column.index === column.index) {\r\n                            visibleIndex = index;\r\n                            return false\r\n                        }\r\n                    });\r\n                    return visibleIndex\r\n                },\r\n                publicMethods: function() {\r\n                    return this.callBase().concat([\"cellValue\"])\r\n                },\r\n                _getCellTemplate: function(options) {\r\n                    var that = this;\r\n                    var template = that._editingController.getColumnTemplate(options);\r\n                    return template || that.callBase(options)\r\n                },\r\n                _isNativeClick: function() {\r\n                    return (_devices2.default.real().ios || _devices2.default.real().android) && this.option(\"editing.allowUpdating\")\r\n                },\r\n                _createTable: function() {\r\n                    var that = this;\r\n                    var $table = that.callBase.apply(that, arguments);\r\n                    if (!_isRowEditMode(that) && that.option(\"editing.allowUpdating\")) {\r\n                        _events_engine2.default.on($table, (0, _utils.addNamespace)(_hold2.default.name, \"dxDataGridRowsView\"), \"td:not(.\" + EDITOR_CELL_CLASS + \")\", that.createAction(function() {\r\n                            var editingController = that._editingController;\r\n                            if (editingController.isEditing()) {\r\n                                editingController.closeEditCell()\r\n                            }\r\n                        }))\r\n                    }\r\n                    return $table\r\n                },\r\n                _createRow: function(row) {\r\n                    var $row = this.callBase(row);\r\n                    if (row) {\r\n                        var editingController = this._editingController;\r\n                        var isEditRow = editingController.isEditRow(row.rowIndex);\r\n                        var isRowRemoved = !!row.removed;\r\n                        var isRowInserted = !!row.isNewRow;\r\n                        var isRowModified = !!row.modified;\r\n                        if (_getEditMode(this) === EDIT_MODE_BATCH) {\r\n                            isRowRemoved && $row.addClass(ROW_REMOVED)\r\n                        } else {\r\n                            isEditRow && $row.addClass(EDIT_ROW)\r\n                        }\r\n                        isRowInserted && $row.addClass(ROW_INSERTED);\r\n                        isRowModified && $row.addClass(ROW_MODIFIED);\r\n                        if (isEditRow || isRowInserted || isRowRemoved) {\r\n                            $row.removeClass(ROW_SELECTED)\r\n                        }\r\n                        if (isEditRow && \"detail\" === row.rowType) {\r\n                            $row.addClass(this.addWidgetPrefix(EDIT_FORM_CLASS))\r\n                        }\r\n                    }\r\n                    return $row\r\n                },\r\n                _getColumnIndexByElement: function($element) {\r\n                    var $tableElement = $element.closest(\"table\");\r\n                    var $tableElements = this.getTableElements();\r\n                    while ($tableElement.length && !$tableElements.filter($tableElement).length) {\r\n                        $element = $tableElement.closest(\"td\");\r\n                        $tableElement = $element.closest(\"table\")\r\n                    }\r\n                    return this._getColumnIndexByElementCore($element)\r\n                },\r\n                _getColumnIndexByElementCore: function($element) {\r\n                    var $targetElement = $element.closest(\".\" + ROW_CLASS + \"> td:not(.dx-master-detail-cell)\");\r\n                    return this.getCellIndex($targetElement)\r\n                },\r\n                _editCellByClick: function(e, eventName) {\r\n                    var that = this;\r\n                    var editingController = that._editingController;\r\n                    var $targetElement = (0, _renderer2.default)(e.event.target);\r\n                    var columnIndex = that._getColumnIndexByElement($targetElement);\r\n                    var row = that._dataController.items()[e.rowIndex];\r\n                    var allowUpdating = editingController.allowUpdating({\r\n                        row: row\r\n                    }, eventName) || row && row.isNewRow;\r\n                    var column = that._columnsController.getVisibleColumns()[columnIndex];\r\n                    var allowEditing = allowUpdating && column && (column.allowEditing || editingController.isEditCell(e.rowIndex, columnIndex));\r\n                    var startEditAction = that.option(\"editing.startEditAction\") || \"click\";\r\n                    if (\"down\" === eventName) {\r\n                        return column && column.showEditorAlways && allowEditing && editingController.editCell(e.rowIndex, columnIndex)\r\n                    }\r\n                    if (\"click\" === eventName && \"dblClick\" === startEditAction && !editingController.isEditCell(e.rowIndex, columnIndex)) {\r\n                        editingController.closeEditCell()\r\n                    }\r\n                    if (allowEditing && eventName === startEditAction) {\r\n                        return editingController.editCell(e.rowIndex, columnIndex) || editingController.isEditRow(e.rowIndex)\r\n                    }\r\n                },\r\n                _rowPointerDown: function(e) {\r\n                    var _this14 = this;\r\n                    this._pointerDownTimeout = setTimeout(function() {\r\n                        _this14._editCellByClick(e, \"down\")\r\n                    })\r\n                },\r\n                _rowClick: function(e) {\r\n                    var isEditForm = (0, _renderer2.default)(e.rowElement).hasClass(this.addWidgetPrefix(EDIT_FORM_CLASS));\r\n                    e.event[TARGET_COMPONENT_NAME] = this.component;\r\n                    if (!this._editCellByClick(e, \"click\") && !isEditForm) {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                _rowDblClick: function(e) {\r\n                    if (!this._editCellByClick(e, \"dblClick\")) {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                _cellPrepared: function($cell, parameters) {\r\n                    var editingController = this._editingController;\r\n                    var isCommandCell = !!parameters.column.command;\r\n                    var isEditableCell = parameters.setValue;\r\n                    var isEditing = parameters.isEditing || editingController.isEditRow(parameters.rowIndex) && parameters.column.allowEditing;\r\n                    if (\"data\" === parameters.rowType && !parameters.column.command && (isEditing || parameters.column.showEditorAlways)) {\r\n                        var alignment = parameters.column.alignment;\r\n                        $cell.addClass(EDITOR_CELL_CLASS).toggleClass(this.addWidgetPrefix(READONLY_CLASS), !isEditableCell).toggleClass(CELL_FOCUS_DISABLED_CLASS, !isEditableCell);\r\n                        if (alignment) {\r\n                            $cell.find(EDITORS_INPUT_SELECTOR).first().css(\"textAlign\", alignment)\r\n                        }\r\n                    }\r\n                    if (isEditing) {\r\n                        this._editCellPrepared($cell)\r\n                    }\r\n                    if (parameters.column && !isCommandCell) {\r\n                        editingController.highlightDataCell($cell, parameters)\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                _editCellPrepared: function($cell) {},\r\n                _formItemPrepared: function() {},\r\n                _isFormItem: function(parameters) {\r\n                    var isDetailRow = \"detail\" === parameters.rowType || \"detailAdaptive\" === parameters.rowType;\r\n                    var isPopupEditing = \"data\" === parameters.rowType && \"popup\" === _getEditMode(this);\r\n                    return (isDetailRow || isPopupEditing) && parameters.item\r\n                },\r\n                _updateCell: function($cell, parameters) {\r\n                    if (this._isFormItem(parameters)) {\r\n                        this._formItemPrepared(parameters, $cell)\r\n                    } else {\r\n                        this.callBase($cell, parameters)\r\n                    }\r\n                },\r\n                _update: function(change) {\r\n                    this.callBase(change);\r\n                    if (\"updateSelection\" === change.changeType) {\r\n                        this.getTableElements().children(\"tbody\").children(\".\" + EDIT_ROW).removeClass(ROW_SELECTED)\r\n                    }\r\n                },\r\n                _getCellOptions: function(options) {\r\n                    var cellOptions = this.callBase(options);\r\n                    cellOptions.isEditing = this._editingController.isEditCell(cellOptions.rowIndex, cellOptions.columnIndex);\r\n                    return cellOptions\r\n                },\r\n                _renderCellContent: function($cell, options) {\r\n                    if (\"data\" === options.rowType && _getEditMode(this) === EDIT_MODE_POPUP && false === options.row.visible) {\r\n                        return\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                cellValue: function(rowIndex, columnIdentifier, value, text) {\r\n                    var cellOptions = this.getCellOptions(rowIndex, columnIdentifier);\r\n                    if (cellOptions) {\r\n                        if (void 0 === value) {\r\n                            return cellOptions.value\r\n                        } else {\r\n                            this._editingController.updateFieldValue(cellOptions, value, text, true)\r\n                        }\r\n                    }\r\n                },\r\n                dispose: function() {\r\n                    this.callBase.apply(this, arguments);\r\n                    clearTimeout(this._pointerDownTimeout)\r\n                }\r\n            },\r\n            headerPanel: {\r\n                _getToolbarItems: function() {\r\n                    var items = this.callBase();\r\n                    var editButtonItems = this.getController(\"editing\").prepareEditButtons(this);\r\n                    return editButtonItems.concat(items)\r\n                },\r\n                optionChanged: function(args) {\r\n                    var fullName = args.fullName;\r\n                    switch (args.name) {\r\n                        case \"editing\":\r\n                            var isEditingPopupOption = fullName && 0 === fullName.indexOf(EDITING_POPUP_OPTION_NAME);\r\n                            if (!isEditingPopupOption) {\r\n                                this._invalidate()\r\n                            }\r\n                            this.callBase(args);\r\n                            break;\r\n                        default:\r\n                            this.callBase(args)\r\n                    }\r\n                },\r\n                isVisible: function() {\r\n                    var that = this;\r\n                    var editingOptions = that.getController(\"editing\").option(\"editing\");\r\n                    return that.callBase() || editingOptions && (editingOptions.allowAdding || (editingOptions.allowUpdating || editingOptions.allowDeleting) && editingOptions.mode === EDIT_MODE_BATCH)\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"script"}