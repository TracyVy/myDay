{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/appointmentPopup.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _popup = require(\"../popup\");\n\nvar _popup2 = _interopRequireDefault(_popup);\n\nvar _window = require(\"../../core/utils/window\");\n\nvar _window2 = _interopRequireDefault(_window);\n\nvar _devices = require(\"../../core/devices\");\n\nvar _devices2 = _interopRequireDefault(_devices);\n\nvar _dom = require(\"../../core/utils/dom\");\n\nvar _dom2 = _interopRequireDefault(_dom);\n\nvar _object = require(\"../../core/utils/object\");\n\nvar _object2 = _interopRequireDefault(_object);\n\nvar _date = require(\"../../core/utils/date\");\n\nvar _date2 = _interopRequireDefault(_date);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _message = require(\"../../localization/message\");\n\nvar _message2 = _interopRequireDefault(_message);\n\nvar _uiScheduler = require(\"./ui.scheduler.appointment_form\");\n\nvar _ui = require(\"./ui.loading\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nvar toMs = _date2.default.dateToMilliseconds;\nvar WIDGET_CLASS = \"dx-scheduler\";\nvar APPOINTMENT_POPUP_CLASS = \"\".concat(WIDGET_CLASS, \"-appointment-popup\");\nvar APPOINTMENT_POPUP_WIDTH = 485;\nvar APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE = 970;\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH = 1e3;\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE = 500;\nvar APPOINTMENT_POPUP_WIDTH_MOBILE = 350;\nvar TOOLBAR_ITEM_AFTER_LOCATION = \"after\";\nvar TOOLBAR_ITEM_BEFORE_LOCATION = \"before\";\n\nvar AppointmentPopup = function () {\n  function AppointmentPopup(scheduler) {\n    _classCallCheck(this, AppointmentPopup);\n\n    this.scheduler = scheduler;\n    this._popup = null;\n    this._appointmentForm = null;\n    this.state = {\n      lastEditData: null,\n      saveChangesLocker: false,\n      appointment: {\n        data: null,\n        processTimeZone: false,\n        isEmptyText: false,\n        isEmptyDescription: false\n      }\n    };\n  }\n\n  _createClass(AppointmentPopup, [{\n    key: \"show\",\n    value: function () {\n      var data = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};\n      var isDoneButtonVisible = arguments.length > 1 ? arguments[1] : void 0;\n      var processTimeZone = arguments.length > 2 ? arguments[2] : void 0;\n      this.state.appointment.data = data;\n      this.state.appointment.processTimeZone = processTimeZone;\n\n      if (!this._popup) {\n        var popupConfig = this._createPopupConfig();\n\n        this._popup = this._createPopup(popupConfig);\n      } else {\n        this._updateForm();\n      }\n\n      this._popup.option(\"toolbarItems\", this._createPopupToolbarItems(isDoneButtonVisible));\n\n      this._popup.show();\n    }\n  }, {\n    key: \"hide\",\n    value: function () {\n      this._popup.hide();\n    }\n  }, {\n    key: \"isVisible\",\n    value: function () {\n      return this._popup ? this._popup.option(\"visible\") : false;\n    }\n  }, {\n    key: \"dispose\",\n    value: function () {\n      if (this._$popup) {\n        this._popup.$element().remove();\n\n        this._$popup = null;\n      }\n    }\n  }, {\n    key: \"_createPopup\",\n    value: function (options) {\n      var popupElement = (0, _renderer2.default)(\"<div>\").addClass(APPOINTMENT_POPUP_CLASS).appendTo(this.scheduler.$element());\n      return this.scheduler._createComponent(popupElement, _popup2.default, options);\n    }\n  }, {\n    key: \"_createPopupConfig\",\n    value: function () {\n      var _this = this;\n\n      return {\n        height: \"auto\",\n        maxHeight: \"100%\",\n        showCloseButton: false,\n        showTitle: false,\n        onHiding: function () {\n          _this.scheduler.focus();\n        },\n        contentTemplate: function () {\n          return _this._createPopupContent();\n        },\n        onShowing: this._onShowing.bind(this),\n        defaultOptionsRules: [{\n          device: function () {\n            return _devices2.default.current().android;\n          },\n          options: {\n            showTitle: false\n          }\n        }]\n      };\n    }\n  }, {\n    key: \"_onShowing\",\n    value: function (e) {\n      var _this2 = this;\n\n      var arg = {\n        form: this._appointmentForm,\n        popup: this._popup,\n        appointmentData: this.state.appointment.data,\n        cancel: false\n      };\n\n      this.scheduler._actions.onAppointmentFormOpening(arg);\n\n      this.scheduler._processActionResult(arg, function (canceled) {\n        if (canceled) {\n          e.cancel = true;\n        } else {\n          _this2.updatePopupFullScreenMode();\n        }\n      });\n    }\n  }, {\n    key: \"_createPopupContent\",\n    value: function () {\n      var formElement = (0, _renderer2.default)(\"<div>\");\n      this._appointmentForm = this._createForm(formElement);\n\n      this._updateForm();\n\n      return formElement;\n    }\n  }, {\n    key: \"_createAppointmentFormData\",\n    value: function (appointmentData) {\n      var result = (0, _extend.extend)(true, {\n        repeat: !!appointmentData.recurrenceRule\n      }, appointmentData);\n      (0, _iterator.each)(this.scheduler._resourcesManager.getResourcesFromItem(result, true) || {}, function (name, value) {\n        return result[name] = value;\n      });\n      return result;\n    }\n  }, {\n    key: \"_createForm\",\n    value: function (element) {\n      var expr = this.scheduler._dataAccessors.expr;\n      var resources = this.scheduler.option(\"resources\");\n\n      var allowTimeZoneEditing = this._getAllowTimeZoneEditing();\n\n      var appointmentData = this.state.appointment.data;\n\n      var formData = this._createAppointmentFormData(appointmentData);\n\n      var readOnly = this._isReadOnly(appointmentData);\n\n      _uiScheduler.AppointmentForm.prepareAppointmentFormEditors(expr, this.scheduler, this.triggerResize.bind(this), this.changeSize.bind(this), formData, allowTimeZoneEditing, readOnly);\n\n      if (resources && resources.length) {\n        _uiScheduler.AppointmentForm.concatResources(this.scheduler._resourcesManager.getEditors());\n      }\n\n      return _uiScheduler.AppointmentForm.create(this.scheduler._createComponent.bind(this.scheduler), element, readOnly, formData);\n    }\n  }, {\n    key: \"_getAllowTimeZoneEditing\",\n    value: function () {\n      var scheduler = this.scheduler;\n      return scheduler.option(\"editing.allowTimeZoneEditing\") || scheduler.option(\"editing.allowEditingTimeZones\");\n    }\n  }, {\n    key: \"_isReadOnly\",\n    value: function (data) {\n      if (data && data.disabled) {\n        return true;\n      }\n\n      return this.scheduler._editAppointmentData ? !this.scheduler._editing.allowUpdating : false;\n    }\n  }, {\n    key: \"_updateForm\",\n    value: function () {\n      var _this$state$appointme = this.state.appointment,\n          data = _this$state$appointme.data,\n          processTimeZone = _this$state$appointme.processTimeZone;\n      var allDay = this.scheduler.fire(\"getField\", \"allDay\", data);\n      var startDate = this.scheduler.fire(\"getField\", \"startDate\", data);\n      var endDate = this.scheduler.fire(\"getField\", \"endDate\", data);\n      this.state.appointment.isEmptyText = void 0 === data || void 0 === data.text;\n      this.state.appointment.isEmptyDescription = void 0 === data || void 0 === data.description;\n      var formData = (0, _extend.extend)({}, {\n        text: \"\",\n        description: \"\",\n        recurrenceRule: \"\"\n      }, this._createAppointmentFormData(data));\n\n      if (processTimeZone) {\n        if (startDate) {\n          startDate = this.scheduler.fire(\"convertDateByTimezone\", startDate);\n          this.scheduler.fire(\"setField\", \"startDate\", formData, startDate);\n        }\n\n        if (endDate) {\n          endDate = this.scheduler.fire(\"convertDateByTimezone\", endDate);\n          this.scheduler.fire(\"setField\", \"endDate\", formData, endDate);\n        }\n      }\n\n      var _this$scheduler$_data = this.scheduler._dataAccessors.expr,\n          startDateExpr = _this$scheduler$_data.startDateExpr,\n          endDateExpr = _this$scheduler$_data.endDateExpr,\n          recurrenceRuleExpr = _this$scheduler$_data.recurrenceRuleExpr;\n\n      var recurrenceEditorOptions = this._getEditorOptions(recurrenceRuleExpr, _uiScheduler.APPOINTMENT_FORM_GROUP_NAMES.Recurrence);\n\n      this._setEditorOptions(recurrenceRuleExpr, _uiScheduler.APPOINTMENT_FORM_GROUP_NAMES.Recurrence, (0, _extend.extend)({}, recurrenceEditorOptions, {\n        startDate: startDate\n      }));\n\n      this._appointmentForm.option(\"readOnly\", this._isReadOnly(data));\n\n      _uiScheduler.AppointmentForm.updateFormData(this._appointmentForm, formData);\n\n      _uiScheduler.AppointmentForm.setEditorsType(this._appointmentForm, startDateExpr, endDateExpr, allDay);\n    }\n  }, {\n    key: \"_getEditorOptions\",\n    value: function (name, groupName) {\n      var editor = this._appointmentForm.itemOption(\"\".concat(groupName, \".\").concat(name));\n\n      return editor ? editor.editorOptions : {};\n    }\n  }, {\n    key: \"_setEditorOptions\",\n    value: function (name, groupName, options) {\n      var editorPath = \"\".concat(groupName, \".\").concat(name);\n\n      var editor = this._appointmentForm.itemOption(editorPath);\n\n      editor && this._appointmentForm.itemOption(editorPath, \"editorOptions\", options);\n    }\n  }, {\n    key: \"_isDeviceMobile\",\n    value: function () {\n      return \"desktop\" !== _devices2.default.current().deviceType;\n    }\n  }, {\n    key: \"_isPopupFullScreenNeeded\",\n    value: function () {\n      var width = this._tryGetWindowWidth();\n\n      if (width) {\n        return this._isDeviceMobile() ? width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE : width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"_tryGetWindowWidth\",\n    value: function () {\n      if (_window2.default.hasWindow()) {\n        var window = _window2.default.getWindow();\n\n        return (0, _renderer2.default)(window).width();\n      }\n    }\n  }, {\n    key: \"triggerResize\",\n    value: function () {\n      this._popup && _dom2.default.triggerResizeEvent(this._popup.$element());\n    }\n  }, {\n    key: \"_getMaxWidth\",\n    value: function (isRecurrence) {\n      if (this._isDeviceMobile()) {\n        return APPOINTMENT_POPUP_WIDTH_MOBILE;\n      }\n\n      return isRecurrence ? APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE : APPOINTMENT_POPUP_WIDTH;\n    }\n  }, {\n    key: \"changeSize\",\n    value: function (isRecurrence) {\n      var isFullScreen = this._isPopupFullScreenNeeded();\n\n      this._popup.option({\n        maxWidth: isFullScreen ? \"100%\" : this._getMaxWidth(isRecurrence),\n        fullScreen: isFullScreen\n      });\n    }\n  }, {\n    key: \"updatePopupFullScreenMode\",\n    value: function () {\n      if (!this._appointmentForm) {\n        return;\n      }\n\n      var isRecurrence = _uiScheduler.AppointmentForm.getRecurrenceRule(this._appointmentForm.option(\"formData\"), this.scheduler._dataAccessors.expr);\n\n      if (this.isVisible()) {\n        this.changeSize(isRecurrence);\n      }\n    }\n  }, {\n    key: \"_createPopupToolbarItems\",\n    value: function (isDoneButtonVisible) {\n      var _this3 = this;\n\n      var result = [];\n\n      var isIOs = \"ios\" === _devices2.default.current().platform;\n\n      if (isDoneButtonVisible) {\n        result.push({\n          shortcut: \"done\",\n          options: {\n            text: _message2.default.format(\"Done\")\n          },\n          location: TOOLBAR_ITEM_AFTER_LOCATION,\n          onClick: function (e) {\n            return _this3._doneButtonClickHandler(e);\n          }\n        });\n      }\n\n      result.push({\n        shortcut: \"cancel\",\n        location: isIOs ? TOOLBAR_ITEM_BEFORE_LOCATION : TOOLBAR_ITEM_AFTER_LOCATION\n      });\n      return result;\n    }\n  }, {\n    key: \"saveChanges\",\n    value: function (showLoadPanel) {\n      var _this4 = this;\n\n      var deferred = new _deferred.Deferred();\n\n      var validation = this._appointmentForm.validate();\n\n      var state = this.state.appointment;\n\n      var convert = function (obj, dateFieldName) {\n        var date = new Date(_this4.scheduler.fire(\"getField\", dateFieldName, obj));\n\n        var tzDiff = _this4.scheduler._getTimezoneOffsetByOption() * toMs(\"hour\") + _this4.scheduler.fire(\"getClientTimezoneOffset\", date);\n\n        return new Date(date.getTime() + tzDiff);\n      };\n\n      showLoadPanel && this._showLoadPanel();\n      (0, _deferred.when)(validation && validation.complete || validation).done(function (validation) {\n        if (validation && !validation.isValid) {\n          _this4._hideLoadPanel();\n\n          deferred.resolve(false);\n          return;\n        }\n\n        var formData = _object2.default.deepExtendArraySafe({}, _this4._getFormData(), true);\n\n        var oldData = _this4.scheduler._editAppointmentData;\n        var recData = _this4.scheduler._updatedRecAppointment;\n\n        if (state.isEmptyText && \"\" === formData.text) {\n          delete formData.text;\n        }\n\n        if (state.isEmptyDescription && \"\" === formData.description) {\n          delete formData.description;\n        }\n\n        if (void 0 === state.data.recurrenceRule && \"\" === formData.recurrenceRule) {\n          delete formData.recurrenceRule;\n        }\n\n        if ((0, _type.isDefined)(formData.repeat)) {\n          delete formData.repeat;\n        }\n\n        if (oldData) {\n          _this4.scheduler._convertDatesByTimezoneBack(false, formData);\n        }\n\n        if (oldData && !recData) {\n          _this4.scheduler.updateAppointment(oldData, formData).done(deferred.resolve);\n        } else {\n          if (recData) {\n            _this4.scheduler.updateAppointment(oldData, recData);\n\n            delete _this4.scheduler._updatedRecAppointment;\n\n            if (\"number\" === typeof _this4.scheduler._getTimezoneOffsetByOption()) {\n              _this4.scheduler.fire(\"setField\", \"startDate\", formData, convert.call(_this4, formData, \"startDate\"));\n\n              _this4.scheduler.fire(\"setField\", \"endDate\", formData, convert.call(_this4, formData, \"endDate\"));\n            }\n          }\n\n          _this4.scheduler.addAppointment(formData).done(deferred.resolve);\n        }\n\n        deferred.done(function () {\n          _this4._hideLoadPanel();\n\n          _this4.state.lastEditData = formData;\n        });\n      });\n      return deferred.promise();\n    }\n  }, {\n    key: \"_getFormData\",\n    value: function () {\n      var formData = this._appointmentForm.option(\"formData\");\n\n      var startDate = this.scheduler.fire(\"getField\", \"startDate\", formData);\n      var endDate = this.scheduler.fire(\"getField\", \"endDate\", formData);\n      this.scheduler.fire(\"setField\", \"startDate\", formData, startDate);\n      this.scheduler.fire(\"setField\", \"endDate\", formData, endDate);\n      return formData;\n    }\n  }, {\n    key: \"_doneButtonClickHandler\",\n    value: function (e) {\n      e.cancel = true;\n      this.saveEditData();\n    }\n  }, {\n    key: \"saveEditData\",\n    value: function () {\n      var _this5 = this;\n\n      var deferred = new _deferred.Deferred();\n\n      if (this._tryLockSaveChanges()) {\n        (0, _deferred.when)(this.saveChanges(true)).done(function () {\n          if (_this5.state.lastEditData) {\n            var startDate = _this5.scheduler.fire(\"getField\", \"startDate\", _this5.state.lastEditData);\n\n            _this5.scheduler._workSpace.updateScrollPosition(startDate);\n\n            _this5.state.lastEditData = null;\n          }\n\n          _this5._unlockSaveChanges();\n\n          deferred.resolve();\n        });\n      }\n\n      return deferred.promise();\n    }\n  }, {\n    key: \"_hideLoadPanel\",\n    value: function () {\n      _ui2.default.hide();\n    }\n  }, {\n    key: \"_showLoadPanel\",\n    value: function () {\n      var $overlayContent = this._popup.overlayContent();\n\n      _ui2.default.show({\n        container: $overlayContent,\n        position: {\n          of: $overlayContent\n        }\n      });\n    }\n  }, {\n    key: \"_tryLockSaveChanges\",\n    value: function () {\n      if (false === this.state.saveChangesLocker) {\n        this.state.saveChangesLocker = true;\n        return true;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"_unlockSaveChanges\",\n    value: function () {\n      this.state.saveChangesLocker = false;\n    }\n  }]);\n\n  return AppointmentPopup;\n}();\n\nexports.default = AppointmentPopup;","map":{"version":3,"sources":["/Users/tracyvy/Desktop/calendar/client/node_modules/devextreme/ui/scheduler/appointmentPopup.js"],"names":["Object","defineProperty","exports","value","default","_renderer","require","_renderer2","_interopRequireDefault","_popup","_popup2","_window","_window2","_devices","_devices2","_dom","_dom2","_object","_object2","_date","_date2","_extend","_iterator","_deferred","_type","_message","_message2","_uiScheduler","_ui","_ui2","obj","__esModule","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","_createClass","protoProps","staticProps","prototype","toMs","dateToMilliseconds","WIDGET_CLASS","APPOINTMENT_POPUP_CLASS","concat","APPOINTMENT_POPUP_WIDTH","APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE","APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH","APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE","APPOINTMENT_POPUP_WIDTH_MOBILE","TOOLBAR_ITEM_AFTER_LOCATION","TOOLBAR_ITEM_BEFORE_LOCATION","AppointmentPopup","scheduler","_appointmentForm","state","lastEditData","saveChangesLocker","appointment","data","processTimeZone","isEmptyText","isEmptyDescription","arguments","isDoneButtonVisible","popupConfig","_createPopupConfig","_createPopup","_updateForm","option","_createPopupToolbarItems","show","hide","_$popup","$element","remove","options","popupElement","addClass","appendTo","_createComponent","_this","height","maxHeight","showCloseButton","showTitle","onHiding","focus","contentTemplate","_createPopupContent","onShowing","_onShowing","bind","defaultOptionsRules","device","current","android","e","_this2","arg","form","popup","appointmentData","cancel","_actions","onAppointmentFormOpening","_processActionResult","canceled","updatePopupFullScreenMode","formElement","_createForm","result","extend","repeat","recurrenceRule","each","_resourcesManager","getResourcesFromItem","name","element","expr","_dataAccessors","resources","allowTimeZoneEditing","_getAllowTimeZoneEditing","formData","_createAppointmentFormData","readOnly","_isReadOnly","AppointmentForm","prepareAppointmentFormEditors","triggerResize","changeSize","concatResources","getEditors","create","disabled","_editAppointmentData","_editing","allowUpdating","_this$state$appointme","allDay","fire","startDate","endDate","text","description","_this$scheduler$_data","startDateExpr","endDateExpr","recurrenceRuleExpr","recurrenceEditorOptions","_getEditorOptions","APPOINTMENT_FORM_GROUP_NAMES","Recurrence","_setEditorOptions","updateFormData","setEditorsType","groupName","editor","itemOption","editorOptions","editorPath","deviceType","width","_tryGetWindowWidth","_isDeviceMobile","hasWindow","window","getWindow","triggerResizeEvent","isRecurrence","isFullScreen","_isPopupFullScreenNeeded","maxWidth","_getMaxWidth","fullScreen","getRecurrenceRule","isVisible","_this3","isIOs","platform","push","shortcut","format","location","onClick","_doneButtonClickHandler","showLoadPanel","_this4","deferred","Deferred","validation","validate","convert","dateFieldName","date","Date","tzDiff","_getTimezoneOffsetByOption","getTime","_showLoadPanel","when","complete","done","isValid","_hideLoadPanel","resolve","deepExtendArraySafe","_getFormData","oldData","recData","_updatedRecAppointment","isDefined","_convertDatesByTimezoneBack","updateAppointment","call","addAppointment","promise","saveEditData","_this5","_tryLockSaveChanges","saveChanges","_workSpace","updateScrollPosition","_unlockSaveChanges","$overlayContent","overlayContent","container","position","of"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/scheduler/appointmentPopup.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", {\r\n    value: true\r\n});\r\nexports.default = void 0;\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _popup = require(\"../popup\");\r\nvar _popup2 = _interopRequireDefault(_popup);\r\nvar _window = require(\"../../core/utils/window\");\r\nvar _window2 = _interopRequireDefault(_window);\r\nvar _devices = require(\"../../core/devices\");\r\nvar _devices2 = _interopRequireDefault(_devices);\r\nvar _dom = require(\"../../core/utils/dom\");\r\nvar _dom2 = _interopRequireDefault(_dom);\r\nvar _object = require(\"../../core/utils/object\");\r\nvar _object2 = _interopRequireDefault(_object);\r\nvar _date = require(\"../../core/utils/date\");\r\nvar _date2 = _interopRequireDefault(_date);\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _message = require(\"../../localization/message\");\r\nvar _message2 = _interopRequireDefault(_message);\r\nvar _uiScheduler = require(\"./ui.scheduler.appointment_form\");\r\nvar _ui = require(\"./ui.loading\");\r\nvar _ui2 = _interopRequireDefault(_ui);\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _classCallCheck(instance, Constructor) {\r\n    if (!(instance instanceof Constructor)) {\r\n        throw new TypeError(\"Cannot call a class as a function\")\r\n    }\r\n}\r\n\r\nfunction _defineProperties(target, props) {\r\n    for (var i = 0; i < props.length; i++) {\r\n        var descriptor = props[i];\r\n        descriptor.enumerable = descriptor.enumerable || false;\r\n        descriptor.configurable = true;\r\n        if (\"value\" in descriptor) {\r\n            descriptor.writable = true\r\n        }\r\n        Object.defineProperty(target, descriptor.key, descriptor)\r\n    }\r\n}\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) {\r\n    if (protoProps) {\r\n        _defineProperties(Constructor.prototype, protoProps)\r\n    }\r\n    if (staticProps) {\r\n        _defineProperties(Constructor, staticProps)\r\n    }\r\n    return Constructor\r\n}\r\nvar toMs = _date2.default.dateToMilliseconds;\r\nvar WIDGET_CLASS = \"dx-scheduler\";\r\nvar APPOINTMENT_POPUP_CLASS = \"\".concat(WIDGET_CLASS, \"-appointment-popup\");\r\nvar APPOINTMENT_POPUP_WIDTH = 485;\r\nvar APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE = 970;\r\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH = 1e3;\r\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE = 500;\r\nvar APPOINTMENT_POPUP_WIDTH_MOBILE = 350;\r\nvar TOOLBAR_ITEM_AFTER_LOCATION = \"after\";\r\nvar TOOLBAR_ITEM_BEFORE_LOCATION = \"before\";\r\nvar AppointmentPopup = function() {\r\n    function AppointmentPopup(scheduler) {\r\n        _classCallCheck(this, AppointmentPopup);\r\n        this.scheduler = scheduler;\r\n        this._popup = null;\r\n        this._appointmentForm = null;\r\n        this.state = {\r\n            lastEditData: null,\r\n            saveChangesLocker: false,\r\n            appointment: {\r\n                data: null,\r\n                processTimeZone: false,\r\n                isEmptyText: false,\r\n                isEmptyDescription: false\r\n            }\r\n        }\r\n    }\r\n    _createClass(AppointmentPopup, [{\r\n        key: \"show\",\r\n        value: function() {\r\n            var data = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};\r\n            var isDoneButtonVisible = arguments.length > 1 ? arguments[1] : void 0;\r\n            var processTimeZone = arguments.length > 2 ? arguments[2] : void 0;\r\n            this.state.appointment.data = data;\r\n            this.state.appointment.processTimeZone = processTimeZone;\r\n            if (!this._popup) {\r\n                var popupConfig = this._createPopupConfig();\r\n                this._popup = this._createPopup(popupConfig)\r\n            } else {\r\n                this._updateForm()\r\n            }\r\n            this._popup.option(\"toolbarItems\", this._createPopupToolbarItems(isDoneButtonVisible));\r\n            this._popup.show()\r\n        }\r\n    }, {\r\n        key: \"hide\",\r\n        value: function() {\r\n            this._popup.hide()\r\n        }\r\n    }, {\r\n        key: \"isVisible\",\r\n        value: function() {\r\n            return this._popup ? this._popup.option(\"visible\") : false\r\n        }\r\n    }, {\r\n        key: \"dispose\",\r\n        value: function() {\r\n            if (this._$popup) {\r\n                this._popup.$element().remove();\r\n                this._$popup = null\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_createPopup\",\r\n        value: function(options) {\r\n            var popupElement = (0, _renderer2.default)(\"<div>\").addClass(APPOINTMENT_POPUP_CLASS).appendTo(this.scheduler.$element());\r\n            return this.scheduler._createComponent(popupElement, _popup2.default, options)\r\n        }\r\n    }, {\r\n        key: \"_createPopupConfig\",\r\n        value: function() {\r\n            var _this = this;\r\n            return {\r\n                height: \"auto\",\r\n                maxHeight: \"100%\",\r\n                showCloseButton: false,\r\n                showTitle: false,\r\n                onHiding: function() {\r\n                    _this.scheduler.focus()\r\n                },\r\n                contentTemplate: function() {\r\n                    return _this._createPopupContent()\r\n                },\r\n                onShowing: this._onShowing.bind(this),\r\n                defaultOptionsRules: [{\r\n                    device: function() {\r\n                        return _devices2.default.current().android\r\n                    },\r\n                    options: {\r\n                        showTitle: false\r\n                    }\r\n                }]\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_onShowing\",\r\n        value: function(e) {\r\n            var _this2 = this;\r\n            var arg = {\r\n                form: this._appointmentForm,\r\n                popup: this._popup,\r\n                appointmentData: this.state.appointment.data,\r\n                cancel: false\r\n            };\r\n            this.scheduler._actions.onAppointmentFormOpening(arg);\r\n            this.scheduler._processActionResult(arg, function(canceled) {\r\n                if (canceled) {\r\n                    e.cancel = true\r\n                } else {\r\n                    _this2.updatePopupFullScreenMode()\r\n                }\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_createPopupContent\",\r\n        value: function() {\r\n            var formElement = (0, _renderer2.default)(\"<div>\");\r\n            this._appointmentForm = this._createForm(formElement);\r\n            this._updateForm();\r\n            return formElement\r\n        }\r\n    }, {\r\n        key: \"_createAppointmentFormData\",\r\n        value: function(appointmentData) {\r\n            var result = (0, _extend.extend)(true, {\r\n                repeat: !!appointmentData.recurrenceRule\r\n            }, appointmentData);\r\n            (0, _iterator.each)(this.scheduler._resourcesManager.getResourcesFromItem(result, true) || {}, function(name, value) {\r\n                return result[name] = value\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"_createForm\",\r\n        value: function(element) {\r\n            var expr = this.scheduler._dataAccessors.expr;\r\n            var resources = this.scheduler.option(\"resources\");\r\n            var allowTimeZoneEditing = this._getAllowTimeZoneEditing();\r\n            var appointmentData = this.state.appointment.data;\r\n            var formData = this._createAppointmentFormData(appointmentData);\r\n            var readOnly = this._isReadOnly(appointmentData);\r\n            _uiScheduler.AppointmentForm.prepareAppointmentFormEditors(expr, this.scheduler, this.triggerResize.bind(this), this.changeSize.bind(this), formData, allowTimeZoneEditing, readOnly);\r\n            if (resources && resources.length) {\r\n                _uiScheduler.AppointmentForm.concatResources(this.scheduler._resourcesManager.getEditors())\r\n            }\r\n            return _uiScheduler.AppointmentForm.create(this.scheduler._createComponent.bind(this.scheduler), element, readOnly, formData)\r\n        }\r\n    }, {\r\n        key: \"_getAllowTimeZoneEditing\",\r\n        value: function() {\r\n            var scheduler = this.scheduler;\r\n            return scheduler.option(\"editing.allowTimeZoneEditing\") || scheduler.option(\"editing.allowEditingTimeZones\")\r\n        }\r\n    }, {\r\n        key: \"_isReadOnly\",\r\n        value: function(data) {\r\n            if (data && data.disabled) {\r\n                return true\r\n            }\r\n            return this.scheduler._editAppointmentData ? !this.scheduler._editing.allowUpdating : false\r\n        }\r\n    }, {\r\n        key: \"_updateForm\",\r\n        value: function() {\r\n            var _this$state$appointme = this.state.appointment,\r\n                data = _this$state$appointme.data,\r\n                processTimeZone = _this$state$appointme.processTimeZone;\r\n            var allDay = this.scheduler.fire(\"getField\", \"allDay\", data);\r\n            var startDate = this.scheduler.fire(\"getField\", \"startDate\", data);\r\n            var endDate = this.scheduler.fire(\"getField\", \"endDate\", data);\r\n            this.state.appointment.isEmptyText = void 0 === data || void 0 === data.text;\r\n            this.state.appointment.isEmptyDescription = void 0 === data || void 0 === data.description;\r\n            var formData = (0, _extend.extend)({}, {\r\n                text: \"\",\r\n                description: \"\",\r\n                recurrenceRule: \"\"\r\n            }, this._createAppointmentFormData(data));\r\n            if (processTimeZone) {\r\n                if (startDate) {\r\n                    startDate = this.scheduler.fire(\"convertDateByTimezone\", startDate);\r\n                    this.scheduler.fire(\"setField\", \"startDate\", formData, startDate)\r\n                }\r\n                if (endDate) {\r\n                    endDate = this.scheduler.fire(\"convertDateByTimezone\", endDate);\r\n                    this.scheduler.fire(\"setField\", \"endDate\", formData, endDate)\r\n                }\r\n            }\r\n            var _this$scheduler$_data = this.scheduler._dataAccessors.expr,\r\n                startDateExpr = _this$scheduler$_data.startDateExpr,\r\n                endDateExpr = _this$scheduler$_data.endDateExpr,\r\n                recurrenceRuleExpr = _this$scheduler$_data.recurrenceRuleExpr;\r\n            var recurrenceEditorOptions = this._getEditorOptions(recurrenceRuleExpr, _uiScheduler.APPOINTMENT_FORM_GROUP_NAMES.Recurrence);\r\n            this._setEditorOptions(recurrenceRuleExpr, _uiScheduler.APPOINTMENT_FORM_GROUP_NAMES.Recurrence, (0, _extend.extend)({}, recurrenceEditorOptions, {\r\n                startDate: startDate\r\n            }));\r\n            this._appointmentForm.option(\"readOnly\", this._isReadOnly(data));\r\n            _uiScheduler.AppointmentForm.updateFormData(this._appointmentForm, formData);\r\n            _uiScheduler.AppointmentForm.setEditorsType(this._appointmentForm, startDateExpr, endDateExpr, allDay)\r\n        }\r\n    }, {\r\n        key: \"_getEditorOptions\",\r\n        value: function(name, groupName) {\r\n            var editor = this._appointmentForm.itemOption(\"\".concat(groupName, \".\").concat(name));\r\n            return editor ? editor.editorOptions : {}\r\n        }\r\n    }, {\r\n        key: \"_setEditorOptions\",\r\n        value: function(name, groupName, options) {\r\n            var editorPath = \"\".concat(groupName, \".\").concat(name);\r\n            var editor = this._appointmentForm.itemOption(editorPath);\r\n            editor && this._appointmentForm.itemOption(editorPath, \"editorOptions\", options)\r\n        }\r\n    }, {\r\n        key: \"_isDeviceMobile\",\r\n        value: function() {\r\n            return \"desktop\" !== _devices2.default.current().deviceType\r\n        }\r\n    }, {\r\n        key: \"_isPopupFullScreenNeeded\",\r\n        value: function() {\r\n            var width = this._tryGetWindowWidth();\r\n            if (width) {\r\n                return this._isDeviceMobile() ? width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE : width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH\r\n            }\r\n            return false\r\n        }\r\n    }, {\r\n        key: \"_tryGetWindowWidth\",\r\n        value: function() {\r\n            if (_window2.default.hasWindow()) {\r\n                var window = _window2.default.getWindow();\r\n                return (0, _renderer2.default)(window).width()\r\n            }\r\n        }\r\n    }, {\r\n        key: \"triggerResize\",\r\n        value: function() {\r\n            this._popup && _dom2.default.triggerResizeEvent(this._popup.$element())\r\n        }\r\n    }, {\r\n        key: \"_getMaxWidth\",\r\n        value: function(isRecurrence) {\r\n            if (this._isDeviceMobile()) {\r\n                return APPOINTMENT_POPUP_WIDTH_MOBILE\r\n            }\r\n            return isRecurrence ? APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE : APPOINTMENT_POPUP_WIDTH\r\n        }\r\n    }, {\r\n        key: \"changeSize\",\r\n        value: function(isRecurrence) {\r\n            var isFullScreen = this._isPopupFullScreenNeeded();\r\n            this._popup.option({\r\n                maxWidth: isFullScreen ? \"100%\" : this._getMaxWidth(isRecurrence),\r\n                fullScreen: isFullScreen\r\n            })\r\n        }\r\n    }, {\r\n        key: \"updatePopupFullScreenMode\",\r\n        value: function() {\r\n            if (!this._appointmentForm) {\r\n                return\r\n            }\r\n            var isRecurrence = _uiScheduler.AppointmentForm.getRecurrenceRule(this._appointmentForm.option(\"formData\"), this.scheduler._dataAccessors.expr);\r\n            if (this.isVisible()) {\r\n                this.changeSize(isRecurrence)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_createPopupToolbarItems\",\r\n        value: function(isDoneButtonVisible) {\r\n            var _this3 = this;\r\n            var result = [];\r\n            var isIOs = \"ios\" === _devices2.default.current().platform;\r\n            if (isDoneButtonVisible) {\r\n                result.push({\r\n                    shortcut: \"done\",\r\n                    options: {\r\n                        text: _message2.default.format(\"Done\")\r\n                    },\r\n                    location: TOOLBAR_ITEM_AFTER_LOCATION,\r\n                    onClick: function(e) {\r\n                        return _this3._doneButtonClickHandler(e)\r\n                    }\r\n                })\r\n            }\r\n            result.push({\r\n                shortcut: \"cancel\",\r\n                location: isIOs ? TOOLBAR_ITEM_BEFORE_LOCATION : TOOLBAR_ITEM_AFTER_LOCATION\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"saveChanges\",\r\n        value: function(showLoadPanel) {\r\n            var _this4 = this;\r\n            var deferred = new _deferred.Deferred;\r\n            var validation = this._appointmentForm.validate();\r\n            var state = this.state.appointment;\r\n            var convert = function(obj, dateFieldName) {\r\n                var date = new Date(_this4.scheduler.fire(\"getField\", dateFieldName, obj));\r\n                var tzDiff = _this4.scheduler._getTimezoneOffsetByOption() * toMs(\"hour\") + _this4.scheduler.fire(\"getClientTimezoneOffset\", date);\r\n                return new Date(date.getTime() + tzDiff)\r\n            };\r\n            showLoadPanel && this._showLoadPanel();\r\n            (0, _deferred.when)(validation && validation.complete || validation).done(function(validation) {\r\n                if (validation && !validation.isValid) {\r\n                    _this4._hideLoadPanel();\r\n                    deferred.resolve(false);\r\n                    return\r\n                }\r\n                var formData = _object2.default.deepExtendArraySafe({}, _this4._getFormData(), true);\r\n                var oldData = _this4.scheduler._editAppointmentData;\r\n                var recData = _this4.scheduler._updatedRecAppointment;\r\n                if (state.isEmptyText && \"\" === formData.text) {\r\n                    delete formData.text\r\n                }\r\n                if (state.isEmptyDescription && \"\" === formData.description) {\r\n                    delete formData.description\r\n                }\r\n                if (void 0 === state.data.recurrenceRule && \"\" === formData.recurrenceRule) {\r\n                    delete formData.recurrenceRule\r\n                }\r\n                if ((0, _type.isDefined)(formData.repeat)) {\r\n                    delete formData.repeat\r\n                }\r\n                if (oldData) {\r\n                    _this4.scheduler._convertDatesByTimezoneBack(false, formData)\r\n                }\r\n                if (oldData && !recData) {\r\n                    _this4.scheduler.updateAppointment(oldData, formData).done(deferred.resolve)\r\n                } else {\r\n                    if (recData) {\r\n                        _this4.scheduler.updateAppointment(oldData, recData);\r\n                        delete _this4.scheduler._updatedRecAppointment;\r\n                        if (\"number\" === typeof _this4.scheduler._getTimezoneOffsetByOption()) {\r\n                            _this4.scheduler.fire(\"setField\", \"startDate\", formData, convert.call(_this4, formData, \"startDate\"));\r\n                            _this4.scheduler.fire(\"setField\", \"endDate\", formData, convert.call(_this4, formData, \"endDate\"))\r\n                        }\r\n                    }\r\n                    _this4.scheduler.addAppointment(formData).done(deferred.resolve)\r\n                }\r\n                deferred.done(function() {\r\n                    _this4._hideLoadPanel();\r\n                    _this4.state.lastEditData = formData\r\n                })\r\n            });\r\n            return deferred.promise()\r\n        }\r\n    }, {\r\n        key: \"_getFormData\",\r\n        value: function() {\r\n            var formData = this._appointmentForm.option(\"formData\");\r\n            var startDate = this.scheduler.fire(\"getField\", \"startDate\", formData);\r\n            var endDate = this.scheduler.fire(\"getField\", \"endDate\", formData);\r\n            this.scheduler.fire(\"setField\", \"startDate\", formData, startDate);\r\n            this.scheduler.fire(\"setField\", \"endDate\", formData, endDate);\r\n            return formData\r\n        }\r\n    }, {\r\n        key: \"_doneButtonClickHandler\",\r\n        value: function(e) {\r\n            e.cancel = true;\r\n            this.saveEditData()\r\n        }\r\n    }, {\r\n        key: \"saveEditData\",\r\n        value: function() {\r\n            var _this5 = this;\r\n            var deferred = new _deferred.Deferred;\r\n            if (this._tryLockSaveChanges()) {\r\n                (0, _deferred.when)(this.saveChanges(true)).done(function() {\r\n                    if (_this5.state.lastEditData) {\r\n                        var startDate = _this5.scheduler.fire(\"getField\", \"startDate\", _this5.state.lastEditData);\r\n                        _this5.scheduler._workSpace.updateScrollPosition(startDate);\r\n                        _this5.state.lastEditData = null\r\n                    }\r\n                    _this5._unlockSaveChanges();\r\n                    deferred.resolve()\r\n                })\r\n            }\r\n            return deferred.promise()\r\n        }\r\n    }, {\r\n        key: \"_hideLoadPanel\",\r\n        value: function() {\r\n            _ui2.default.hide()\r\n        }\r\n    }, {\r\n        key: \"_showLoadPanel\",\r\n        value: function() {\r\n            var $overlayContent = this._popup.overlayContent();\r\n            _ui2.default.show({\r\n                container: $overlayContent,\r\n                position: {\r\n                    of: $overlayContent\r\n                }\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_tryLockSaveChanges\",\r\n        value: function() {\r\n            if (false === this.state.saveChangesLocker) {\r\n                this.state.saveChangesLocker = true;\r\n                return true\r\n            }\r\n            return false\r\n        }\r\n    }, {\r\n        key: \"_unlockSaveChanges\",\r\n        value: function() {\r\n            this.state.saveChangesLocker = false\r\n        }\r\n    }]);\r\n    return AppointmentPopup\r\n}();\r\nexports.default = AppointmentPopup;\r\n"]},"metadata":{},"sourceType":"script"}